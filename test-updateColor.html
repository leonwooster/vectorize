<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test updateColor() and replaceColorInSVG()</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h2 {
            margin-top: 0;
        }
        .svg-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .svg-box {
            flex: 1;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
        .svg-box h3 {
            margin-top: 0;
            font-size: 14px;
            color: #666;
        }
        .controls {
            margin: 20px 0;
        }
        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Test updateColor() and replaceColorInSVG() - Tasks 9.1 & 9.2</h1>
    
    <div class="test-section">
        <h2>Test 1: Basic Color Update</h2>
        <p>Change the red rectangle to blue using the color picker.</p>
        
        <div class="controls">
            <div class="color-picker-group">
                <label>Select new color:</label>
                <input type="color" id="colorPicker1" value="#0000ff">
                <button onclick="testBasicUpdate()">Update Color</button>
            </div>
        </div>
        
        <div class="svg-container">
            <div class="svg-box">
                <h3>Original SVG</h3>
                <div id="originalSvg1"></div>
            </div>
            <div class="svg-box">
                <h3>Updated SVG</h3>
                <div id="updatedSvg1"></div>
            </div>
        </div>
        
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Multiple Color Formats</h2>
        <p>Test replacing colors in different formats (hex lowercase, uppercase, RGB).</p>
        
        <div class="controls">
            <div class="color-picker-group">
                <label>Select new color:</label>
                <input type="color" id="colorPicker2" value="#00ff00">
                <button onclick="testMultipleFormats()">Update All Formats</button>
            </div>
        </div>
        
        <div class="svg-container">
            <div class="svg-box">
                <h3>Original SVG (Mixed Formats)</h3>
                <div id="originalSvg2"></div>
            </div>
            <div class="svg-box">
                <h3>Updated SVG</h3>
                <div id="updatedSvg2"></div>
            </div>
        </div>
        
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Complex SVG with Multiple Colors</h2>
        <p>Update one color in an SVG with multiple different colors.</p>
        
        <div class="controls">
            <div class="color-picker-group">
                <label>Color to change:</label>
                <select id="colorSelect">
                    <option value="0">Red (#ff0000)</option>
                    <option value="1">Green (#00ff00)</option>
                    <option value="2">Blue (#0000ff)</option>
                </select>
                <label>New color:</label>
                <input type="color" id="colorPicker3" value="#ffff00">
                <button onclick="testComplexSVG()">Update Selected Color</button>
            </div>
        </div>
        
        <div class="svg-container">
            <div class="svg-box">
                <h3>Original SVG</h3>
                <div id="originalSvg3"></div>
            </div>
            <div class="svg-box">
                <h3>Updated SVG</h3>
                <div id="updatedSvg3"></div>
            </div>
        </div>
        
        <div id="result3" class="result"></div>
    </div>

    <!-- Hidden elements required by SVGColorAnalyzer -->
    <div style="display: none;">
        <div id="uploadArea"></div>
        <input type="file" id="fileInput">
        <div id="mainContent"></div>
        <div id="svgPreview"></div>
        <canvas id="analysisCanvas"></canvas>
        <canvas id="highlightCanvas"></canvas>
        <div id="colorPaletteTop"></div>
        <div id="colorList"></div>
        <span id="originalColorCount">0</span>
        <span id="currentColorCount">0</span>
        <input type="range" id="colorCountSlider" min="2" max="16" value="8">
        <span id="colorCountValue">8</span>
        <button id="reduceBtn">Reduce Colors</button>
        <button id="resetBtn">Reset</button>
        <button id="downloadBtn">Download</button>
        <button id="clearHighlightBtn">Clear Highlight</button>
        <div id="loadingIndicator">Loading...</div>
        <div id="errorMessage"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="app.js"></script>
    <script>
        // Test SVGs
        const testSVG1 = '<svg width="100" height="100"><rect x="10" y="10" width="80" height="80" fill="#ff0000"/></svg>';
        
        const testSVG2 = `<svg width="200" height="100">
            <rect x="10" y="10" width="40" height="80" fill="#ff0000"/>
            <rect x="60" y="10" width="40" height="80" fill="#FF0000"/>
            <rect x="110" y="10" width="40" height="80" fill="rgb(255, 0, 0)"/>
        </svg>`;
        
        const testSVG3 = `<svg width="200" height="100">
            <rect x="10" y="10" width="50" height="80" fill="#ff0000"/>
            <rect x="70" y="10" width="50" height="80" fill="#00ff00"/>
            <rect x="130" y="10" width="50" height="80" fill="#0000ff"/>
        </svg>`;
        
        // Initialize displays
        document.getElementById('originalSvg1').innerHTML = testSVG1;
        document.getElementById('updatedSvg1').innerHTML = testSVG1;
        
        document.getElementById('originalSvg2').innerHTML = testSVG2;
        document.getElementById('updatedSvg2').innerHTML = testSVG2;
        
        document.getElementById('originalSvg3').innerHTML = testSVG3;
        document.getElementById('updatedSvg3').innerHTML = testSVG3;
        
        // Test functions
        function testBasicUpdate() {
            const newColor = document.getElementById('colorPicker1').value;
            const result = document.getElementById('result1');
            
            try {
                // Set up app state
                app.colorData = [
                    { hex: '#ff0000', rgb: { r: 255, g: 0, b: 0 }, count: 100, percentage: 100 }
                ];
                app.currentSVG = testSVG1;
                app.originalSVG = testSVG1;
                
                // Mock displaySVG to update our display
                const originalDisplaySVG = app.displaySVG;
                app.displaySVG = function(svg) {
                    document.getElementById('updatedSvg1').innerHTML = svg;
                };
                
                // Mock updateUI to prevent errors
                app.updateUI = function() {};
                
                // Update color
                app.updateColor(0, newColor);
                
                // Restore original method
                app.displaySVG = originalDisplaySVG;
                
                result.innerHTML = `<span class="success">✓ Success!</span> Color updated from #ff0000 to ${newColor}<br>` +
                    `Updated colorData: ${JSON.stringify(app.colorData[0])}`;
            } catch (error) {
                result.innerHTML = `<span class="error">✗ Error:</span> ${error.message}`;
            }
        }
        
        function testMultipleFormats() {
            const newColor = document.getElementById('colorPicker2').value;
            const result = document.getElementById('result2');
            
            try {
                // Test replaceColorInSVG directly
                const updatedSVG = app.replaceColorInSVG(testSVG2, '#ff0000', newColor);
                
                document.getElementById('updatedSvg2').innerHTML = updatedSVG;
                
                // Check if all formats were replaced
                const hasOldLower = updatedSVG.includes('#ff0000');
                const hasOldUpper = updatedSVG.includes('#FF0000');
                const hasOldRGB = updatedSVG.includes('rgb(255, 0, 0)');
                const hasNewColor = updatedSVG.includes(newColor.toLowerCase());
                
                if (!hasOldLower && !hasOldUpper && !hasOldRGB && hasNewColor) {
                    result.innerHTML = `<span class="success">✓ Success!</span> All color formats replaced correctly<br>` +
                        `Lowercase hex: ✓<br>Uppercase hex: ✓<br>RGB format: ✓`;
                } else {
                    result.innerHTML = `<span class="error">✗ Incomplete replacement</span><br>` +
                        `Lowercase hex remaining: ${hasOldLower}<br>` +
                        `Uppercase hex remaining: ${hasOldUpper}<br>` +
                        `RGB format remaining: ${hasOldRGB}<br>` +
                        `New color present: ${hasNewColor}`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">✗ Error:</span> ${error.message}`;
            }
        }
        
        function testComplexSVG() {
            const colorIndex = parseInt(document.getElementById('colorSelect').value);
            const newColor = document.getElementById('colorPicker3').value;
            const result = document.getElementById('result3');
            
            try {
                // Set up app state with multiple colors
                app.colorData = [
                    { hex: '#ff0000', rgb: { r: 255, g: 0, b: 0 }, count: 100, percentage: 33.33 },
                    { hex: '#00ff00', rgb: { r: 0, g: 255, b: 0 }, count: 100, percentage: 33.33 },
                    { hex: '#0000ff', rgb: { r: 0, g: 0, b: 255 }, count: 100, percentage: 33.33 }
                ];
                app.currentSVG = testSVG3;
                app.originalSVG = testSVG3;
                
                const oldColor = app.colorData[colorIndex].hex;
                
                // Mock displaySVG to update our display
                const originalDisplaySVG = app.displaySVG;
                app.displaySVG = function(svg) {
                    document.getElementById('updatedSvg3').innerHTML = svg;
                };
                
                // Mock updateUI to prevent errors
                app.updateUI = function() {};
                
                // Update color
                app.updateColor(colorIndex, newColor);
                
                // Restore original method
                app.displaySVG = originalDisplaySVG;
                
                // Verify only the selected color was changed
                const hasOldColor = app.currentSVG.includes(oldColor);
                const hasNewColor = app.currentSVG.includes(newColor.toLowerCase());
                
                result.innerHTML = `<span class="success">✓ Success!</span> Color ${oldColor} updated to ${newColor}<br>` +
                    `Old color remaining: ${hasOldColor ? 'Yes (ERROR)' : 'No (correct)'}<br>` +
                    `New color present: ${hasNewColor ? 'Yes (correct)' : 'No (ERROR)'}<br>` +
                    `Updated colorData: ${JSON.stringify(app.colorData[colorIndex])}`;
            } catch (error) {
                result.innerHTML = `<span class="error">✗ Error:</span> ${error.message}`;
            }
        }
    </script>
</body>
</html>
