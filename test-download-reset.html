<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Download & Reset - SVG Color Palette Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h2 {
            margin-top: 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .test-result.pass {
            background-color: #d4edda;
            color: #155724;
        }
        .test-result.fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Download & Reset Functionality Test</h1>
    
    <div class="test-section">
        <h2>Test Setup</h2>
        <p>This page tests the downloadSVG() and resetToOriginal() methods.</p>
        <button id="loadTestSVG">Load Test SVG</button>
        <div id="setupResult" class="test-result" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 1: Modify Colors</h2>
        <p>Click to change the first color to blue.</p>
        <button id="modifyColor">Modify First Color to Blue</button>
        <div id="modifyResult" class="test-result" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Download SVG</h2>
        <p>Click to download the modified SVG. Check that a file named "optimized.svg" is downloaded.</p>
        <button id="testDownload">Download SVG</button>
        <div id="downloadResult" class="test-result" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Reset to Original</h2>
        <p>Click to reset to the original SVG. The color should change back to red.</p>
        <button id="testReset">Reset to Original</button>
        <div id="resetResult" class="test-result" style="display:none;"></div>
    </div>
    
    <div class="test-section">
        <h2>SVG Preview</h2>
        <div id="svgPreview" style="border: 1px solid #ccc; padding: 10px; min-height: 200px;"></div>
    </div>
    
    <!-- Hidden elements required by app.js -->
    <div style="display:none;">
        <div id="uploadArea"></div>
        <input type="file" id="fileInput">
        <div id="mainContent"></div>
        <canvas id="analysisCanvas"></canvas>
        <canvas id="highlightCanvas"></canvas>
        <div id="colorPaletteTop"></div>
        <div id="colorList"></div>
        <span id="originalColorCount">0</span>
        <span id="currentColorCount">0</span>
        <input type="range" id="colorCountSlider" min="2" max="16" value="8">
        <span id="colorCountValue">8</span>
        <button id="reduceBtn">Reduce Colors</button>
        <button id="resetBtn">Reset</button>
        <button id="downloadBtn">Download</button>
        <button id="clearHighlightBtn">Clear Highlight</button>
        <div id="loadingIndicator">Loading...</div>
        <div id="errorMessage"></div>
    </div>
    
    <script src="app.js"></script>
    <script>
        $(document).ready(() => {
            // Test SVG content
            const testSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
    <rect x="10" y="10" width="80" height="80" fill="#ff0000"/>
    <circle cx="50" cy="50" r="20" fill="#00ff00"/>
</svg>`;
            
            // Load test SVG
            $('#loadTestSVG').on('click', async () => {
                try {
                    // Set up the app with test SVG
                    window.app.originalSVG = testSVG;
                    window.app.currentSVG = testSVG;
                    
                    // Analyze and display
                    await window.app.analyzeSVG(testSVG);
                    window.app.displaySVG(testSVG);
                    window.app.updateUI();
                    
                    $('#setupResult')
                        .removeClass('fail').addClass('pass')
                        .text('✓ Test SVG loaded successfully. Original colors: ' + window.app.originalColorCount)
                        .show();
                } catch (error) {
                    $('#setupResult')
                        .removeClass('pass').addClass('fail')
                        .text('✗ Failed to load test SVG: ' + error.message)
                        .show();
                }
            });
            
            // Modify color
            $('#modifyColor').on('click', () => {
                try {
                    if (!window.app.currentSVG) {
                        throw new Error('No SVG loaded. Click "Load Test SVG" first.');
                    }
                    
                    // Change first color (red) to blue
                    window.app.updateColor(0, '#0000ff');
                    
                    $('#modifyResult')
                        .removeClass('fail').addClass('pass')
                        .text('✓ Color modified successfully. First color changed to blue.')
                        .show();
                } catch (error) {
                    $('#modifyResult')
                        .removeClass('pass').addClass('fail')
                        .text('✗ Failed to modify color: ' + error.message)
                        .show();
                }
            });
            
            // Test download
            $('#testDownload').on('click', () => {
                try {
                    if (!window.app.currentSVG) {
                        throw new Error('No SVG loaded. Click "Load Test SVG" first.');
                    }
                    
                    // Call downloadSVG
                    window.app.downloadSVG();
                    
                    $('#downloadResult')
                        .removeClass('fail').addClass('pass')
                        .text('✓ Download triggered. Check your downloads folder for "optimized.svg".')
                        .show();
                } catch (error) {
                    $('#downloadResult')
                        .removeClass('pass').addClass('fail')
                        .text('✗ Failed to download SVG: ' + error.message)
                        .show();
                }
            });
            
            // Test reset
            $('#testReset').on('click', async () => {
                try {
                    if (!window.app.originalSVG) {
                        throw new Error('No SVG loaded. Click "Load Test SVG" first.');
                    }
                    
                    // Call resetToOriginal
                    await window.app.resetToOriginal();
                    
                    // Verify reset worked
                    const isReset = window.app.currentSVG === window.app.originalSVG;
                    
                    if (isReset) {
                        $('#resetResult')
                            .removeClass('fail').addClass('pass')
                            .text('✓ Reset successful. SVG restored to original state.')
                            .show();
                    } else {
                        $('#resetResult')
                            .removeClass('pass').addClass('fail')
                            .text('✗ Reset failed. Current SVG does not match original.')
                            .show();
                    }
                } catch (error) {
                    $('#resetResult')
                        .removeClass('pass').addClass('fail')
                        .text('✗ Failed to reset: ' + error.message)
                        .show();
                }
            });
        });
    </script>
</body>
</html>
