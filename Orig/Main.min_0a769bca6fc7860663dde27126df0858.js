!function(){for(let t of __jqdeferred)$(t);__jqdeferred.length=0;class t{constructor(t){this._css=t}css(){return this._css}$(t){return!t&&this._cache||(this._cache=$(this._css))}join(e,i){return new t(this._css+i+e._css)}or(t){return this.join(t,", ")}and(t){return this.join(t,"")}anscestorOf(t){return this.join(t," ")}parentOf(t){return this.join(t,">")}followedBy(t){return this.join(t,"~")}immediatelyFollowedBy(t){return this.join(t,"+")}withData(e,i){return this.and(new t(`[data-${e}="${i}"]`))}exists(t){return this.$(t).length>0}addClass(t){return this.$().addClass(t.name()),this}addClasses(...t){const e=t.map(t=>t.name()).join(" ");return this.$().addClass(e),this}removeClass(t){return this.$().removeClass(t.name()),this}removeClasses(...t){const e=t.map(t=>t.name()).join(" ");return this.$().removeClass(e),this}setClasses(...t){const e=t.map(t=>t.name()).join(" ");return this.$().attr("class",e),this}toggleClass(t,e){return this.$().toggleClass(t.name(),e),this}toggleClasses(t,...e){const i=e.map(t=>t.name()).join(" ");return this.$().toggleClass(i,t),this}hasClass(t){return this.$().hasClass(t.name())}addAttr(t){return this.$().attr(t,t),this}toggleAttr(t,e){return e?this.$().attr(t,t):this.$().removeAttr(t),this}removeAttr(t){return this.$().removeAttr(t),this}toggleProp(t,e){return this.$().prop(t,e),this}toggleDisabled(t){return this.toggleProp("disabled",t),this.$().toggleClass("disabled",t),this}}class e extends t{tag(){return this.css()}constructor(t){super(t)}}class i extends t{name(){return this._name}constructor(t){super("."+t),this._name=t}elements(){return document.querySelectorAll(this.css())}}class s extends t{name(){return this._name}constructor(t){super("#"+t),this._name=t}el(){return document.getElementById(this._name)}}class o{constructor(t){this.key=t,this.caseSensitive=!0}caseInsensitive(){return this.caseSensitive=!1,this}exists(){return new t("["+this.key+"]")}build(e,i){return new t("["+this.key+e+'"'+i+'"'+(this.caseSensitive?"":" i")+"]")}equals(t){return this.build("=",t)}containsWhitespaceSeparatedToken(t){return this.build("~=",t)}equalsOrPlusDashStartsWith(t){return this.build("|=",t)}startsWith(t){return this.build("^=",t)}endsWidth(t){return this.build("$=",t)}contains(t){return this.build("*=",t)}}var r,n,a,h,l,c,u,d,p,m,g,f,b,w,v,C,x,y,S,A,P,M,k,E,R,T,I,F,O,_,D,B,L,G,N,z,W,U,V,H,X,Y,q,j,Z,Q,J,K,tt,et;!function(r){function n(t){return new o(t)}r.empty=new t(""),r.html=new t("html"),r.body=new t("body"),r.htmlBody=new t("html, body"),r.$window=$(window),r.data=function(t){return n("data-"+t)},r.attr=n,r.id=function(t){return new s(t)},r.c=function(t){return new i(t)},r.tag=function(t){return new e(t)}}(n||(n={})),function(t){t.active=new i("active")}(r||(r={})),function(t){let e,i,s,o,r,n,a,h,l,c,u,d,p,m,g,f,b;t.active_key=t.c("active_key"),t.app_is_visible=t.c("app_is_visible"),t.app_starter=t.c("app_starter"),t.bttn=t.c("bttn"),t.bttn_dark=t.c("bttn_dark"),t.bttn_green=t.c("bttn_green"),t.bttn_icon_left=t.c("bttn_icon_left"),t.bttn_icon_right=t.c("bttn_icon_right"),t.bttn_light=t.c("bttn_light"),t.bttn_red=t.c("bttn_red"),t.bttn_short=t.c("bttn_short"),t.bttn_white=t.c("bttn_white"),t.bttn_wire=t.c("bttn_wire"),t.bttn_wire_white=t.c("bttn_wire_white"),t.cannot_run_app=t.c("cannot_run_app"),t.canvas_container=t.c("canvas_container"),t.chart=t.c("chart"),t.checkmark=t.c("checkmark"),t.checkmark_check=t.c("checkmark_check"),t.ctl_key=t.c("ctl_key"),t.dark_checker=t.c("dark_checker"),t.disabled=t.c("disabled"),t.download=t.c("download"),t.downloadAll=t.c("downloadAll"),t.drop_ready=t.c("drop_ready"),t.dropdown_auto=t.c("dropdown_auto"),t.format_toggle=t.c("format_toggle"),t.grab_closed=t.c("grab_closed"),t.grab_open=t.c("grab_open"),t.isFree=t.c("isFree"),t.isPaid=t.c("isPaid"),t.jsNotInitializedYet=t.c("jsNotInitializedYet"),t.modern_menu=t.c("modern_menu"),t.noselect=t.c("noselect"),t.paste_buttons=t.c("paste_buttons"),t.pasted=t.c("pasted"),t.popup_drop_target_container=t.c("popup_drop_target_container"),t.popup_drop_target_particles_container=t.c("popup_drop_target_particles_container"),t.svgz_toggle=t.c("svgz_toggle"),t.tabLink=t.c("tabLink"),t.v_key=t.c("v_key"),t.viewer_green_button=t.c("viewer_green_button"),t.wrong_shake=t.c("wrong_shake"),function(e){let i,s,o,r,n,a,h;e.App=t.id("App-App"),e.DownloadLink=t.id("App-DownloadLink"),e.ModernizrAlert=t.id("App-ModernizrAlert"),e.ProgressLightbox=t.id("App-ProgressLightbox"),e.appView=t.id("App-appView"),e.cancel_upload=t.c("App-cancel_upload"),e.exit_app=t.c("App-exit_app"),e.feedback_link=t.c("App-feedback_link"),e.force_exit=t.c("App-force_exit"),e.new_from_url_link=t.c("App-new_from_url_link"),e.starter=t.c("App-starter"),function(e){e.Dialog=t.id("App-Error-Dialog"),e.Message=t.id("App-Error-Message"),e.RetryButton=t.id("App-Error-RetryButton")}(i=e.Error||(e.Error={})),function(e){e.Dialog=t.id("App-Feedback-Dialog"),e.DialogShare=t.id("App-Feedback-DialogShare"),e.Message=t.id("App-Feedback-Message"),e.Submit=t.id("App-Feedback-Submit")}(s=e.Feedback||(e.Feedback={})),function(e){e.CanvasContainer=t.id("App-ImageView-CanvasContainer"),e.LeftCanvas=t.id("App-ImageView-LeftCanvas"),e.RightCanvas=t.id("App-ImageView-RightCanvas"),e.single_pane=t.c("App-ImageView-single_pane")}(o=e.ImageView||(e.ImageView={})),function(e){let i,s,o;e.Dialog=t.id("App-Progress-Dialog"),e.bar=t.c("App-Progress-bar"),e.progress=t.c("App-Progress-progress"),function(e){e.Bar=t.id("App-Progress-Download-Bar"),e.Pane=t.id("App-Progress-Download-Pane")}(i||(i={})),e.Download=i,function(e){e.Bar=t.id("App-Progress-Process-Bar"),e.Pane=t.id("App-Progress-Process-Pane")}(s||(s={})),e.Process=s,function(e){e.Bar=t.id("App-Progress-Upload-Bar"),e.Pane=t.id("App-Progress-Upload-Pane")}(o||(o={})),e.Upload=o}(r=e.Progress||(e.Progress={})),function(e){e.Bar=t.id("App-ProgressLightboxBar-Bar"),e.Pane=t.id("App-ProgressLightboxBar-Pane")}(n||(n={})),e.ProgressLightboxBar=n,function(e){let i,s;e.Exit=t.id("App-SubApps-Exit"),e.LightBox=t.id("App-SubApps-LightBox"),e.View=t.id("App-SubApps-View"),e.sidebar=t.id("App-SubApps-sidebar"),function(e){let i,s;e.Cancel=t.id("App-SubApps-Palette-Cancel"),e.Ok=t.id("App-SubApps-Palette-Ok"),e.Reset=t.id("App-SubApps-Palette-Reset"),e.active=t.c("App-SubApps-Palette-active"),e.chosen=t.c("App-SubApps-Palette-chosen"),e.presets_container=t.c("App-SubApps-Palette-presets_container"),e.recommended=t.c("App-SubApps-Palette-recommended"),e.swatch=t.c("App-SubApps-Palette-swatch"),function(e){e.AcceptButton=t.id("App-SubApps-Palette-ColorEditor-AcceptButton"),e.CloseButton=t.id("App-SubApps-Palette-ColorEditor-CloseButton"),e.ColorInput=t.id("App-SubApps-Palette-ColorEditor-ColorInput"),e.ColorInputContainer=t.id("App-SubApps-Palette-ColorEditor-ColorInputContainer"),e.ColorLabel=t.id("App-SubApps-Palette-ColorEditor-ColorLabel"),e.ColorOutput=t.id("App-SubApps-Palette-ColorEditor-ColorOutput"),e.Container=t.id("App-SubApps-Palette-ColorEditor-Container"),e.ControlsContainer=t.id("App-SubApps-Palette-ColorEditor-ControlsContainer"),e.IncludeContainer=t.id("App-SubApps-Palette-ColorEditor-IncludeContainer"),e.IncludeInput=t.id("App-SubApps-Palette-ColorEditor-IncludeInput"),e.IncludeLabel=t.id("App-SubApps-Palette-ColorEditor-IncludeLabel"),e.OpacityInput=t.id("App-SubApps-Palette-ColorEditor-OpacityInput"),e.OpacityInputContainer=t.id("App-SubApps-Palette-ColorEditor-OpacityInputContainer"),e.Prompt=t.id("App-SubApps-Palette-ColorEditor-Prompt"),e.RevertButton=t.id("App-SubApps-Palette-ColorEditor-RevertButton"),e.disabled=t.c("App-SubApps-Palette-ColorEditor-disabled")}(i=e.ColorEditor||(e.ColorEditor={})),function(e){e.Container=t.id("App-SubApps-Palette-Editor-Container"),e.InnerColorShadowDark=t.id("App-SubApps-Palette-Editor-InnerColorShadowDark"),e.InnerColorShadowLight=t.id("App-SubApps-Palette-Editor-InnerColorShadowLight"),e.OuterColorShadow=t.id("App-SubApps-Palette-Editor-OuterColorShadow"),e.checker=t.c("App-SubApps-Palette-Editor-checker"),e.dark=t.c("App-SubApps-Palette-Editor-dark"),e.drop_target=t.c("App-SubApps-Palette-Editor-drop_target"),e.fill=t.c("App-SubApps-Palette-Editor-fill"),e.inner_color=t.c("App-SubApps-Palette-Editor-inner_color"),e.light=t.c("App-SubApps-Palette-Editor-light"),e.outer_color=t.c("App-SubApps-Palette-Editor-outer_color"),e.selected=t.c("App-SubApps-Palette-Editor-selected"),e.selector=t.c("App-SubApps-Palette-Editor-selector"),e.singleton=t.c("App-SubApps-Palette-Editor-singleton")}(s=e.Editor||(e.Editor={}))}(i=e.Palette||(e.Palette={})),function(e){e.Accept=t.id("App-SubApps-Toolbar-Accept"),e.Close=t.id("App-SubApps-Toolbar-Close"),e.NumColors=t.id("App-SubApps-Toolbar-NumColors"),e.Redo=t.id("App-SubApps-Toolbar-Redo"),e.Undo=t.id("App-SubApps-Toolbar-Undo"),e.ZoomIn=t.id("App-SubApps-Toolbar-ZoomIn"),e.ZoomOut=t.id("App-SubApps-Toolbar-ZoomOut"),e.ZoomToFit=t.id("App-SubApps-Toolbar-ZoomToFit")}(s=e.Toolbar||(e.Toolbar={}))}(a=e.SubApps||(e.SubApps={})),function(e){e.Exit=t.id("App-Toolbar-Exit"),e.NumPanesGroup=t.id("App-Toolbar-NumPanesGroup"),e.Palette=t.id("App-Toolbar-Palette"),e.PaletteNumColors=t.id("App-Toolbar-PaletteNumColors"),e.ThumbsDown=t.id("App-Toolbar-ThumbsDown"),e.ThumbsUp=t.id("App-Toolbar-ThumbsUp"),e.ThumbsUpDown=t.id("App-Toolbar-ThumbsUpDown"),e.ViewBitmap=t.id("App-Toolbar-ViewBitmap"),e.ViewSingle=t.id("App-Toolbar-ViewSingle"),e.ViewSplit=t.id("App-Toolbar-ViewSplit"),e.Zoom1To1=t.id("App-Toolbar-Zoom1To1"),e.ZoomIn=t.id("App-Toolbar-ZoomIn"),e.ZoomOut=t.id("App-Toolbar-ZoomOut"),e.ZoomToFit=t.id("App-Toolbar-ZoomToFit")}(h=e.Toolbar||(e.Toolbar={}))}(e=t.App||(t.App={})),function(e){e.container=t.c("BeforeAfter-container"),e.divider=t.c("BeforeAfter-divider"),e.second_row=t.c("BeforeAfter-second_row"),e.try_this_btn=t.c("BeforeAfter-try_this_btn")}(i=t.BeforeAfter||(t.BeforeAfter={})),function(e){e.indicator=t.c("BinaryToggle-indicator"),e.indicator_inner=t.c("BinaryToggle-indicator_inner"),e.option=t.c("BinaryToggle-option"),e.option_left=t.c("BinaryToggle-option_left"),e.option_right=t.c("BinaryToggle-option_right"),e.toggle=t.c("BinaryToggle-toggle")}(s=t.BinaryToggle||(t.BinaryToggle={})),function(e){e.grab_closed=t.c("Cursor-grab_closed"),e.move=t.c("Cursor-move"),e.resize_ew=t.c("Cursor-resize_ew"),e.resize_nesw=t.c("Cursor-resize_nesw"),e.resize_ns=t.c("Cursor-resize_ns"),e.resize_nwse=t.c("Cursor-resize_nwse")}(o=t.Cursor||(t.Cursor={})),function(e){e.Dialog=t.id("FatalError-Dialog"),e.Message=t.id("FatalError-Message")}(r=t.FatalError||(t.FatalError={})),function(e){let i;e.Field=t.id("FileInput-Field"),e.PasteTarget=t.id("FileInput-PasteTarget"),e.click_to_upload=t.c("FileInput-click_to_upload"),function(e){e.Dialog=t.id("FileInput-UploadFromWeb-Dialog"),e.DialogButton=t.id("FileInput-UploadFromWeb-DialogButton"),e.DialogInput=t.id("FileInput-UploadFromWeb-DialogInput"),e.MainButton=t.id("FileInput-UploadFromWeb-MainButton"),e.MainInput=t.id("FileInput-UploadFromWeb-MainInput"),e.show_dialog=t.c("FileInput-UploadFromWeb-show_dialog")}(i=e.UploadFromWeb||(e.UploadFromWeb={}))}(n=t.FileInput||(t.FileInput={})),function(e){e.Id=t.id("Hurricane-Id"),e.Labels=t.id("Hurricane-Labels"),e.Line=t.id("Hurricane-Line"),e.Outlines=t.id("Hurricane-Outlines"),e.Shapes=t.id("Hurricane-Shapes"),e.transformable=t.c("Hurricane-transformable")}(a||(a={})),t.Hurricane=a,function(e){e.outer_container=t.c("ImageList-outer_container")}(h=t.ImageList||(t.ImageList={})),function(e){e.capture=t.c("LevelSlider-capture"),e.hover=t.c("LevelSlider-hover"),e.label=t.c("LevelSlider-label"),e.left_btn=t.c("LevelSlider-left_btn"),e.line=t.c("LevelSlider-line"),e.rect=t.c("LevelSlider-rect"),e.right_btn=t.c("LevelSlider-right_btn"),e.selected=t.c("LevelSlider-selected"),e.tic=t.c("LevelSlider-tic"),e.zone=t.c("LevelSlider-zone")}(l=t.LevelSlider||(t.LevelSlider={})),function(e){let i,s,o,r,n,a,h,l,c,u,d,p,m,g,f;e.ResetForm=t.id("Options-ResetForm"),e.container=t.c("Options-container"),e.form_row=t.c("Options-form_row"),function(e){let i,s,o,r;e.group=t.c("Options-AllowedCurveTypesGroup-group"),function(e){e.attribute=t.c("Options-AllowedCurveTypesGroup-Bezier-attribute"),e.input=t.c("Options-AllowedCurveTypesGroup-Bezier-input"),e.row=t.c("Options-AllowedCurveTypesGroup-Bezier-row")}(i||(i={})),e.Bezier=i,function(e){e.attribute=t.c("Options-AllowedCurveTypesGroup-CircularArc-attribute"),e.input=t.c("Options-AllowedCurveTypesGroup-CircularArc-input"),e.row=t.c("Options-AllowedCurveTypesGroup-CircularArc-row")}(s||(s={})),e.CircularArc=s,function(e){e.attribute=t.c("Options-AllowedCurveTypesGroup-EllipticalArc-attribute"),e.input=t.c("Options-AllowedCurveTypesGroup-EllipticalArc-input"),e.row=t.c("Options-AllowedCurveTypesGroup-EllipticalArc-row")}(o||(o={})),e.EllipticalArc=o,function(e){e.attribute=t.c("Options-AllowedCurveTypesGroup-Quad-attribute"),e.input=t.c("Options-AllowedCurveTypesGroup-Quad-input"),e.row=t.c("Options-AllowedCurveTypesGroup-Quad-row")}(r||(r={})),e.Quad=r}(i||(i={})),e.AllowedCurveTypesGroup=i,function(e){let i,s,o;e.group=t.c("Options-DrawStyleGroup-group"),function(e){e.attribute=t.c("Options-DrawStyleGroup-FillShapes-attribute"),e.input=t.c("Options-DrawStyleGroup-FillShapes-input"),e.row=t.c("Options-DrawStyleGroup-FillShapes-row")}(i||(i={})),e.FillShapes=i,function(e){e.attribute=t.c("Options-DrawStyleGroup-StrokeEdges-attribute"),e.input=t.c("Options-DrawStyleGroup-StrokeEdges-input"),e.row=t.c("Options-DrawStyleGroup-StrokeEdges-row")}(s||(s={})),e.StrokeEdges=s,function(e){e.attribute=t.c("Options-DrawStyleGroup-StrokeShapes-attribute"),e.input=t.c("Options-DrawStyleGroup-StrokeShapes-input"),e.row=t.c("Options-DrawStyleGroup-StrokeShapes-row")}(o||(o={})),e.StrokeShapes=o}(s||(s={})),e.DrawStyleGroup=s,function(e){let i,s,o;e.group=t.c("Options-DxfCompatibilityGroup-group"),function(e){e.attribute=t.c("Options-DxfCompatibilityGroup-LinesAndArcs-attribute"),e.input=t.c("Options-DxfCompatibilityGroup-LinesAndArcs-input"),e.row=t.c("Options-DxfCompatibilityGroup-LinesAndArcs-row")}(i||(i={})),e.LinesAndArcs=i,function(e){e.attribute=t.c("Options-DxfCompatibilityGroup-LinesArcsAndSplines-attribute"),e.input=t.c("Options-DxfCompatibilityGroup-LinesArcsAndSplines-input"),e.row=t.c("Options-DxfCompatibilityGroup-LinesArcsAndSplines-row")}(s||(s={})),e.LinesArcsAndSplines=s,function(e){e.attribute=t.c("Options-DxfCompatibilityGroup-LinesOnly-attribute"),e.input=t.c("Options-DxfCompatibilityGroup-LinesOnly-input"),e.row=t.c("Options-DxfCompatibilityGroup-LinesOnly-row")}(o||(o={})),e.LinesOnly=o}(o||(o={})),e.DxfCompatibilityGroup=o,function(e){let i,s,o,r,n;e.group=t.c("Options-FileFormatGroup-group"),function(e){e.attribute=t.c("Options-FileFormatGroup-Dxf-attribute"),e.input=t.c("Options-FileFormatGroup-Dxf-input"),e.row=t.c("Options-FileFormatGroup-Dxf-row")}(i||(i={})),e.Dxf=i,function(e){e.attribute=t.c("Options-FileFormatGroup-Eps-attribute"),e.input=t.c("Options-FileFormatGroup-Eps-input"),e.row=t.c("Options-FileFormatGroup-Eps-row")}(s||(s={})),e.Eps=s,function(e){e.attribute=t.c("Options-FileFormatGroup-Pdf-attribute"),e.input=t.c("Options-FileFormatGroup-Pdf-input"),e.row=t.c("Options-FileFormatGroup-Pdf-row")}(o||(o={})),e.Pdf=o,function(e){e.attribute=t.c("Options-FileFormatGroup-Png-attribute"),e.input=t.c("Options-FileFormatGroup-Png-input"),e.row=t.c("Options-FileFormatGroup-Png-row")}(r||(r={})),e.Png=r,function(e){e.attribute=t.c("Options-FileFormatGroup-Svg-attribute"),e.input=t.c("Options-FileFormatGroup-Svg-input"),e.row=t.c("Options-FileFormatGroup-Svg-row")}(n||(n={})),e.Svg=n}(r||(r={})),e.FileFormatGroup=r,function(e){let i,s,o,r;e.group=t.c("Options-GapFillerGroup-group"),function(e){e.attribute=t.c("Options-GapFillerGroup-Clip-attribute"),e.input=t.c("Options-GapFillerGroup-Clip-input"),e.row=t.c("Options-GapFillerGroup-Clip-row")}(i||(i={})),e.Clip=i,function(e){e.attribute=t.c("Options-GapFillerGroup-Enable-attribute"),e.input=t.c("Options-GapFillerGroup-Enable-input"),e.row=t.c("Options-GapFillerGroup-Enable-row")}(s||(s={})),e.Enable=s,function(e){e.attribute=t.c("Options-GapFillerGroup-NonScalingStroke-attribute"),e.input=t.c("Options-GapFillerGroup-NonScalingStroke-input"),e.row=t.c("Options-GapFillerGroup-NonScalingStroke-row")}(o||(o={})),e.NonScalingStroke=o,function(e){e.attribute=t.c("Options-GapFillerGroup-StrokeWidth-attribute"),e.input=t.c("Options-GapFillerGroup-StrokeWidth-input"),e.row=t.c("Options-GapFillerGroup-StrokeWidth-row")}(r||(r={})),e.StrokeWidth=r}(n||(n={})),e.GapFillerGroup=n,function(e){let i,s,o,r;e.group=t.c("Options-GroupByGroup-group"),function(e){e.attribute=t.c("Options-GroupByGroup-Color-attribute"),e.input=t.c("Options-GroupByGroup-Color-input"),e.row=t.c("Options-GroupByGroup-Color-row")}(i||(i={})),e.Color=i,function(e){e.attribute=t.c("Options-GroupByGroup-Layer-attribute"),e.input=t.c("Options-GroupByGroup-Layer-input"),e.row=t.c("Options-GroupByGroup-Layer-row")}(s||(s={})),e.Layer=s,function(e){e.attribute=t.c("Options-GroupByGroup-None-attribute"),e.input=t.c("Options-GroupByGroup-None-input"),e.row=t.c("Options-GroupByGroup-None-row")}(o||(o={})),e.None=o,function(e){e.attribute=t.c("Options-GroupByGroup-Parent-attribute"),e.input=t.c("Options-GroupByGroup-Parent-input"),e.row=t.c("Options-GroupByGroup-Parent-row")}(r||(r={})),e.Parent=r}(a||(a={})),e.GroupByGroup=a,function(e){e.group=t.c("Options-LineFitGroup-group")}(h||(h={})),e.LineFitGroup=h,function(e){let i,s,o,r,n,a;e.group=t.c("Options-OutputUnitGroup-group"),function(e){e.attribute=t.c("Options-OutputUnitGroup-Cm-attribute"),e.input=t.c("Options-OutputUnitGroup-Cm-input"),e.row=t.c("Options-OutputUnitGroup-Cm-row")}(i||(i={})),e.Cm=i,function(e){e.attribute=t.c("Options-OutputUnitGroup-Inches-attribute"),e.input=t.c("Options-OutputUnitGroup-Inches-input"),e.row=t.c("Options-OutputUnitGroup-Inches-row")}(s||(s={})),e.Inches=s,function(e){e.attribute=t.c("Options-OutputUnitGroup-Mm-attribute"),e.input=t.c("Options-OutputUnitGroup-Mm-input"),e.row=t.c("Options-OutputUnitGroup-Mm-row")}(o||(o={})),e.Mm=o,function(e){e.attribute=t.c("Options-OutputUnitGroup-None-attribute"),e.input=t.c("Options-OutputUnitGroup-None-input"),e.row=t.c("Options-OutputUnitGroup-None-row")}(r||(r={})),e.None=r,function(e){e.attribute=t.c("Options-OutputUnitGroup-Pt-attribute"),e.input=t.c("Options-OutputUnitGroup-Pt-input"),e.row=t.c("Options-OutputUnitGroup-Pt-row")}(n||(n={})),e.Pt=n,function(e){e.attribute=t.c("Options-OutputUnitGroup-Px-attribute"),e.input=t.c("Options-OutputUnitGroup-Px-input"),e.row=t.c("Options-OutputUnitGroup-Px-row")}(a||(a={})),e.Px=a}(l||(l={})),e.OutputUnitGroup=l,function(e){let i;e.group=t.c("Options-ParameterizedShapesGroup-group"),function(e){e.attribute=t.c("Options-ParameterizedShapesGroup-Flatten-attribute"),e.input=t.c("Options-ParameterizedShapesGroup-Flatten-input"),e.row=t.c("Options-ParameterizedShapesGroup-Flatten-row")}(i||(i={})),e.Flatten=i}(c||(c={})),e.ParameterizedShapesGroup=c,function(e){let i,s;e.group=t.c("Options-PdfCompressionModeGroup-group"),function(e){e.attribute=t.c("Options-PdfCompressionModeGroup-Deflate-attribute"),e.input=t.c("Options-PdfCompressionModeGroup-Deflate-input"),e.row=t.c("Options-PdfCompressionModeGroup-Deflate-row")}(i||(i={})),e.Deflate=i,function(e){e.attribute=t.c("Options-PdfCompressionModeGroup-None-attribute"),e.input=t.c("Options-PdfCompressionModeGroup-None-input"),e.row=t.c("Options-PdfCompressionModeGroup-None-row")}(s||(s={})),e.None=s}(u||(u={})),e.PdfCompressionModeGroup=u,function(e){let i,s;e.group=t.c("Options-ShapeStackingGroup-group"),function(e){e.attribute=t.c("Options-ShapeStackingGroup-Cutouts-attribute"),e.input=t.c("Options-ShapeStackingGroup-Cutouts-input"),e.row=t.c("Options-ShapeStackingGroup-Cutouts-row")}(i||(i={})),e.Cutouts=i,function(e){e.attribute=t.c("Options-ShapeStackingGroup-Stacked-attribute"),e.input=t.c("Options-ShapeStackingGroup-Stacked-input"),e.row=t.c("Options-ShapeStackingGroup-Stacked-row")}(s||(s={})),e.Stacked=s}(d||(d={})),e.ShapeStackingGroup=d,function(e){let i,s,o,r;e.group=t.c("Options-SizeGroup-group"),function(e){e.attribute=t.c("Options-SizeGroup-Height-attribute"),e.input=t.c("Options-SizeGroup-Height-input"),e.row=t.c("Options-SizeGroup-Height-row")}(i||(i={})),e.Height=i,function(e){e.attribute=t.c("Options-SizeGroup-OutputDpi-attribute"),e.input=t.c("Options-SizeGroup-OutputDpi-input"),e.row=t.c("Options-SizeGroup-OutputDpi-row")}(s||(s={})),e.OutputDpi=s,function(e){e.attribute=t.c("Options-SizeGroup-Scale-attribute"),e.input=t.c("Options-SizeGroup-Scale-input"),e.row=t.c("Options-SizeGroup-Scale-row")}(o||(o={})),e.Scale=o,function(e){e.attribute=t.c("Options-SizeGroup-Width-attribute"),e.input=t.c("Options-SizeGroup-Width-input"),e.row=t.c("Options-SizeGroup-Width-row")}(r||(r={})),e.Width=r}(p||(p={})),e.SizeGroup=p,function(e){let i,s,o,r;e.group=t.c("Options-StrokeStyleGroup-group"),function(e){e.attribute=t.c("Options-StrokeStyleGroup-Color-attribute"),e.input=t.c("Options-StrokeStyleGroup-Color-input"),e.row=t.c("Options-StrokeStyleGroup-Color-row")}(i||(i={})),e.Color=i,function(e){e.attribute=t.c("Options-StrokeStyleGroup-NonScalingStroke-attribute"),e.input=t.c("Options-StrokeStyleGroup-NonScalingStroke-input"),e.row=t.c("Options-StrokeStyleGroup-NonScalingStroke-row")}(s||(s={})),e.NonScalingStroke=s,function(e){e.attribute=t.c("Options-StrokeStyleGroup-StrokeWidth-attribute"),e.input=t.c("Options-StrokeStyleGroup-StrokeWidth-input"),e.row=t.c("Options-StrokeStyleGroup-StrokeWidth-row")}(o||(o={})),e.StrokeWidth=o,function(e){e.attribute=t.c("Options-StrokeStyleGroup-UseOverrideColor-attribute"),e.input=t.c("Options-StrokeStyleGroup-UseOverrideColor-input"),e.row=t.c("Options-StrokeStyleGroup-UseOverrideColor-row")}(r||(r={})),e.UseOverrideColor=r}(m||(m={})),e.StrokeStyleGroup=m,function(e){let i,s;e.group=t.c("Options-SvgOptionsGroup-group"),function(e){e.attribute=t.c("Options-SvgOptionsGroup-AdobeCompatibilityMode-attribute"),e.input=t.c("Options-SvgOptionsGroup-AdobeCompatibilityMode-input"),e.row=t.c("Options-SvgOptionsGroup-AdobeCompatibilityMode-row")}(i||(i={})),e.AdobeCompatibilityMode=i,function(e){e.attribute=t.c("Options-SvgOptionsGroup-FixedSize-attribute"),e.input=t.c("Options-SvgOptionsGroup-FixedSize-input"),e.row=t.c("Options-SvgOptionsGroup-FixedSize-row")}(s||(s={})),e.FixedSize=s}(g||(g={})),e.SvgOptionsGroup=g,function(e){let i,s,o;e.group=t.c("Options-SvgVersionGroup-group"),function(e){e.attribute=t.c("Options-SvgVersionGroup-Svg_1_0-attribute"),e.input=t.c("Options-SvgVersionGroup-Svg_1_0-input"),e.row=t.c("Options-SvgVersionGroup-Svg_1_0-row")}(i||(i={})),e.Svg_1_0=i,function(e){e.attribute=t.c("Options-SvgVersionGroup-Svg_1_1-attribute"),e.input=t.c("Options-SvgVersionGroup-Svg_1_1-input"),e.row=t.c("Options-SvgVersionGroup-Svg_1_1-row")}(s||(s={})),e.Svg_1_1=s,function(e){e.attribute=t.c("Options-SvgVersionGroup-Svg_Tiny_1_2-attribute"),e.input=t.c("Options-SvgVersionGroup-Svg_Tiny_1_2-input"),e.row=t.c("Options-SvgVersionGroup-Svg_Tiny_1_2-row")}(o||(o={})),e.Svg_Tiny_1_2=o}(f||(f={})),e.SvgVersionGroup=f}(c=t.Options||(t.Options={})),function(e){let i;e.App=t.id("PreCrop-App"),e.ViewContainer=t.id("PreCrop-ViewContainer"),function(e){let i;e.cancel_button=t.c("PreCrop-Sidebar-cancel_button"),e.crop_button=t.c("PreCrop-Sidebar-crop_button"),e.cropped_image_aspect_ratio_display=t.c("PreCrop-Sidebar-cropped_image_aspect_ratio_display"),e.cropped_image_megapixels_display=t.c("PreCrop-Sidebar-cropped_image_megapixels_display"),e.cropped_image_size_display=t.c("PreCrop-Sidebar-cropped_image_size_display"),e.cropped_image_success=t.c("PreCrop-Sidebar-cropped_image_success"),e.cropped_image_warning=t.c("PreCrop-Sidebar-cropped_image_warning"),e.input_image_aspect_ratio_display=t.c("PreCrop-Sidebar-input_image_aspect_ratio_display"),e.input_image_megapixels_display=t.c("PreCrop-Sidebar-input_image_megapixels_display"),e.input_image_size_display=t.c("PreCrop-Sidebar-input_image_size_display"),e.lock_aspect_ratio_button=t.c("PreCrop-Sidebar-lock_aspect_ratio_button"),function(e){e.container=t.c("PreCrop-Sidebar-MaxNumMegapixels-container"),e.decrease=t.c("PreCrop-Sidebar-MaxNumMegapixels-decrease"),e.display=t.c("PreCrop-Sidebar-MaxNumMegapixels-display"),e.increase=t.c("PreCrop-Sidebar-MaxNumMegapixels-increase"),e.reset=t.c("PreCrop-Sidebar-MaxNumMegapixels-reset")}(i||(i={})),e.MaxNumMegapixels=i}(i=e.Sidebar||(e.Sidebar={}))}(u=t.PreCrop||(t.PreCrop={})),function(e){e.Body=t.id("RetryDialog-Body"),e.Countdown=t.id("RetryDialog-Countdown"),e.Dialog=t.id("RetryDialog-Dialog"),e.RetryNowButton=t.id("RetryDialog-RetryNowButton")}(d=t.RetryDialog||(t.RetryDialog={})),function(e){e.ImageList=t.id("Sidebar-ImageList"),e.download=t.c("Sidebar-download"),e.edit_icon=t.c("Sidebar-edit_icon"),e.filename=t.c("Sidebar-filename"),e.image=t.c("Sidebar-image"),e.main_row=t.c("Sidebar-main_row"),e.mode=t.c("Sidebar-mode"),e.mode_icon=t.c("Sidebar-mode_icon"),e.mode_label=t.c("Sidebar-mode_label"),e.mode_row=t.c("Sidebar-mode_row"),e.polish=t.c("Sidebar-polish"),e.remove=t.c("Sidebar-remove"),e.rest=t.c("Sidebar-rest"),e.slider=t.c("Sidebar-slider"),e.slider_label=t.c("Sidebar-slider_label"),e.smooth=t.c("Sidebar-smooth"),e.thumbnail=t.c("Sidebar-thumbnail"),e.title=t.c("Sidebar-title")}(p=t.Sidebar||(t.Sidebar={})),function(e){e.Dialog=t.id("Signon-Dialog"),e.Header=t.id("Signon-Header"),e.IframeContainer=t.id("Signon-IframeContainer"),e.LoadingIndicator=t.id("Signon-LoadingIndicator"),e.preload=t.c("Signon-preload"),e.trigger=t.c("Signon-trigger")}(m=t.Signon||(t.Signon={})),function(e){e.details_container=t.c("Totals-details_container"),e.image_count=t.c("Totals-image_count"),e.original_size=t.c("Totals-original_size"),e.outer_container=t.c("Totals-outer_container"),e.progress=t.c("Totals-progress"),e.reduction=t.c("Totals-reduction"),e.reduction_container=t.c("Totals-reduction_container"),e.result_size=t.c("Totals-result_size"),e.result_size_container=t.c("Totals-result_size_container"),e.save_all_btn=t.c("Totals-save_all_btn"),e.save_all_icon=t.c("Totals-save_all_icon"),e.save_all_spinner=t.c("Totals-save_all_spinner"),e.unit=t.c("Totals-unit")}(g=t.Totals||(t.Totals={})),function(e){e.Canvas=t.id("Viewer-Canvas"),e.CanvasContainer=t.id("Viewer-CanvasContainer"),e.CurrentImageDecrement=t.id("Viewer-CurrentImageDecrement"),e.CurrentImageDetails=t.id("Viewer-CurrentImageDetails"),e.CurrentImageIncrement=t.id("Viewer-CurrentImageIncrement"),e.DownloadCurrent=t.id("Viewer-DownloadCurrent"),e.DownloadCurrentIcon=t.id("Viewer-DownloadCurrentIcon"),e.DownloadCurrentSpinner=t.id("Viewer-DownloadCurrentSpinner"),e.ImageControlGroup=t.id("Viewer-ImageControlGroup"),e.ImageName=t.id("Viewer-ImageName"),e.LoadingIndicator=t.id("Viewer-LoadingIndicator"),e.LoadingIndicatorOver=t.id("Viewer-LoadingIndicatorOver"),e.LoadingIndicatorOverShade=t.id("Viewer-LoadingIndicatorOverShade"),e.NextImage=t.id("Viewer-NextImage"),e.PrevImage=t.id("Viewer-PrevImage"),e.ViewCompressedButton=t.id("Viewer-ViewCompressedButton"),e.ViewDifferenceButton=t.id("Viewer-ViewDifferenceButton"),e.ViewOriginalButton=t.id("Viewer-ViewOriginalButton"),e.backdrop=t.c("Viewer-backdrop"),e.blue_button=t.c("Viewer-blue_button"),e.cancel_button=t.c("Viewer-cancel_button"),e.clear_button=t.c("Viewer-clear_button"),e.container=t.c("Viewer-container"),e.highlight=t.c("Viewer-highlight"),e.layer_button=t.c("Viewer-layer_button"),e.pane_control_button=t.c("Viewer-pane_control_button"),e.toolbar=t.c("Viewer-toolbar"),e.underline_button=t.c("Viewer-underline_button"),e.zoom_1_to_1_button=t.c("Viewer-zoom_1_to_1_button"),e.zoom_in_button=t.c("Viewer-zoom_in_button"),e.zoom_out_button=t.c("Viewer-zoom_out_button"),e.zoom_to_fit_button=t.c("Viewer-zoom_to_fit_button")}(f=t.Viewer||(t.Viewer={})),function(e){e.AcceptTerms=t.id("merchant-AcceptTerms"),e.AcceptTermsWrapper=t.id("merchant-AcceptTermsWrapper"),e.BraintreeDropinContainer=t.id("merchant-BraintreeDropinContainer"),e.CantPaypal=t.id("merchant-CantPaypal"),e.Cents=t.id("merchant-Cents"),e.CreditCardProcessorForm=t.id("merchant-CreditCardProcessorForm"),e.DefaultPaymentMethod=t.id("merchant-DefaultPaymentMethod"),e.FailedToLoadPaymentBackendJs=t.id("merchant-FailedToLoadPaymentBackendJs"),e.InitializingIndicator=t.id("merchant-InitializingIndicator"),e.PaymentError=t.id("merchant-PaymentError"),e.PaymentForm=t.id("merchant-PaymentForm"),e.PaymentMethodForm=t.id("merchant-PaymentMethodForm"),e.PaymentMethodFormSubmit=t.id("merchant-PaymentMethodFormSubmit"),e.RadioBraintree=t.id("paymentMethod_braintree"),e.RadioPaypal=t.id("paymentMethod_paypal"),e.RadioStripe=t.id("paymentMethod_stripe"),e.ShowWhenCreatingPm=t.id("merchant-ShowWhenCreatingPm"),e.ShowWhenMinibrowsing=t.id("merchant-ShowWhenMinibrowsing"),e.ShowWhenSubmitting=t.id("merchant-ShowWhenSubmitting"),e.StreamlexPaymentToken=t.id("merchant-StreamlexPaymentToken"),e.StripeCardElement=t.id("merchant-StripeCardElement"),e.StripeCardErrors=t.id("merchant-StripeCardErrors"),e.StripeNameElement=t.id("merchant-StripeNameElement"),e.StripeNameErrors=t.id("merchant-StripeNameErrors"),e.StripePaymentError=t.id("merchant-StripePaymentError"),e.SubmitSection=t.id("merchant-SubmitSection"),e.TaxLocationPostalCode=t.id("merchant-TaxLocationPostalCode"),e.TaxPostalCode=t.id("merchant-TaxPostalCode"),e.TaxPostalCodeFormGroup=t.id("merchant-TaxPostalCodeFormGroup"),e.TaxSection=t.id("merchant-TaxSection"),e.has_error=t.c("has-error"),e.radio_paymentMethod=t.c("radio_paymentMethod")}(b=t.merchant||(t.merchant={}))}(n||(n={})),function(t){const e=n.Signon.Dialog.anscestorOf(new i("modal-header")),s="message.signup",o=[];let r=null;function a(t){const e=t.originalEvent,i=function(t){for(let e of o)if(e.contentWindow==t)return e;return null}(e.source);if(i){let t=parseInt(e.data);t>10&&(i.height=t+"px"),i.hasLoaded||(i.hasLoaded=!0,c())}}function h(){l($(this))}function l(t){const e=t.data("url");if(null==r||r.src!=e){r=function(t){for(let e of o)if(e.src==t)return e;return null}(e)||function(t){let e=document.createElement("iframe");return e.setAttribute("seamless","seamless"),e.frameBorder="0",e.width="100%",e.height="650px",e.style.backgroundColor="#fff",e.hasLoaded=!1,e.onload=function(t){e.hasLoaded=!0,c()},e.src=t,o.push(e),n.Signon.IframeContainer.$().prepend(e),e}(e),r.style.display="block";for(let t of o)t!=r&&(t.style.display="none")}c()}function c(){n.Signon.LoadingIndicator.$().toggle(!(r&&r.hasLoaded))}function u(){const t=$(this);l(t),n.$window.on(s,a);const i=t.data("header");return i?(n.Signon.Header.$().text(i).show(),e.$().css("border-bottom","")):(n.Signon.Header.$().hide(),e.$().css("border-bottom","none")),n.Signon.Dialog.$().modal(),!1}t.checkInit=function(){n.Signon.Dialog.$().length>0&&n.Signon.trigger.$().length>0&&(n.Signon.Dialog.$().on("hide.bs.modal",function(){n.$window.off(s)}),n.Signon.trigger.elements().forEach(t=>{t.addEventListener("touchstart",h,{passive:!0}),t.addEventListener("mouseover",h,{passive:!0})}),n.Signon.trigger.$().click(u),n.Signon.preload.$().each(h))}}(a||(a={})),function(t){function e(t,e){return t[e]}t.get=e,t.getOrElse=function(t,i,s){var o=e(t,i);return void 0===o?s:o},t.set=function(t,e,i){return t[e]=i},t.cast=function(t){return t}}(h||(h={})),function(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[],s=new Uint8Array(256);for(var o=0;o<64;o++)i[o]=e.charAt(o),s[e.charCodeAt(o)]=o;function r(t,e){return s[0|t.charCodeAt(e)]}function n(t){return i[63&t]}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63,t.decode=function(t){if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4. ");var e,i,s=t.length,o="="===t.charAt(s-2)?2:"="===t.charAt(s-1)?1:0,n=new Uint8Array(3*t.length/4-o),a=o>0?t.length-4:t.length,h=0;function l(t){n[h++]=255&t}for(e=0;e<a;e+=4)l((i=r(t,e)<<18|r(t,e+1)<<12|r(t,e+2)<<6|r(t,e+3))>>16),l(i>>8),l(i);return 2===o?l(i=r(t,e)<<2|r(t,e+1)>>4):1===o&&(l((i=r(t,e)<<10|r(t,e+1)<<4|r(t,e+2)>>2)>>8),l(i)),n},t.decodeString=function(t,e){try{return atob(t)}catch(t){}return e},t.encode=function(t,e){if(t instanceof Uint8Array){const r=(e=e||t.length)%3;var i,s="";const a=e-r;for(var o=0;o<a;o+=3)s+=n((i=(t[o]<<16)+(t[o+1]<<8)+t[o+2])>>18),s+=n(i>>12),s+=n(i>>6),s+=n(i);return 1==r?(s+=n((i=t[a])>>2),s+=n(i<<4),s+="=="):2==r&&(s+=n((i=(t[a]<<8)+t[a+1])>>10),s+=n(i>>4),s+=n(i<<2),s+="="),s.replace(/\!/,"!")}return btoa(h.cast(t))}}(l||(l={})),function(t){const e=[0];function i(t,e){return t.toFixed(e).replace(/\.?0+$/,"")}function s(t,e){"use strict";if(null==t)throw new TypeError("can't convert "+t+" to object");if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e==1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0==t.length||0==e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var i="",s=0;s<e;s++)i+=t;return i}function o(t){if(!t)return null;const e=t.match(/data:(.*?)(;base64)?,(.*)/);if(!e)return null;const i=e[1]||"text/plain",s=!!e[2],o=decodeURIComponent(e[3].trim());if(s){const t=l.decode(o);let e=new Blob([t],{type:i});return e.size!=t.length&&(e=new Blob([t.buffer],{type:i})),e}return new Blob([o],{type:i})}function r(t,e,i){return new File([t],e,{type:t.type,lastModified:i||Date.now()})}function n(t){switch(t){case"image/jpeg":return"jpg";case"image/png":return"png";case"image/gif":return"gif";case"image/svg+xml":return"svg";default:return}}function a(t){let e=t.lastIndexOf(".");return e>=0?{base:t.substr(0,e),extension:t.substr(e+1)}:{base:t,extension:""}}t.tic=function(){e.push(Date.now())},t.toc=function(t){Date.now(),e.pop()},t.toFixed=i,t.formatAspectRatio=function(t){return i(t.w,3)+":"+i(t.h,3)},t.hex=function(t,e){return("000000000"+t.toString(16)).slice(-e)},t.fuzzyAspectRatioEx=function(t,e){for(var i=t.w/t.h,s=0;s<e.length;s++){var o=e[s],r=o.w/o.h;if(Math.abs((i-r)/r)<.01)return o}return t.w>t.h?{w:t.w/t.h,h:1}:{w:1,h:t.h/t.w}},t.roundTo=function(t,e){return parseFloat(t.toFixed(e))},t.empty=function(){},t.sign=function(t){return 0==t?0:t>0?1:-1},t.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},t.log10=function(t){return Math.log(t)/Math.LN10},t.parseIntWithAlt=function(t,e,i){const s=parseInt(t,e);return isNaN(s)?i:s},t.padStart=function(t,e,i){return e|=0,i=String(void 0!==i?i:" "),t.length>e?String(t):((e-=t.length)>i.length&&(i+=s(i,e/i.length)),i.slice(0,e)+String(t))},t.repeat=s,t.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},t.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)>=0},t.blobToArrayBuffer=function(t,e,i){var s=new FileReader;s.onerror=s.onabort=i,s.onloadend=function(t){e(h.cast(s.result))},s.readAsArrayBuffer(t)},t.blobToString=function(t,e,i){var s=new FileReader;s.onerror=s.onabort=i,s.onloadend=function(t){e(h.cast(s.result))},s.readAsText(t)},t.dataUrlToBlob=o,t.dataUrlToFile=function(t,e){return r(o(t),e)},t.blobToFile=r,t.mimeTypeToExtension=n,t.changeFileTypeAndExtension=function(t,e){if(t.type!=e){let i=t.name,s=n(e);if(s){i=a(i).base+"."+s}return new File([t],i,{type:e,lastModified:t.lastModified})}return t},t.svgStringToDataUrl=function(t){return"data:image/svg+xml;base64,"+btoa(t)},t.toDataUrl=function(t,e){return"data:"+e+";base64,"+l.encode(t)},t.min=function(t){return Math.min.apply(null,t)},t.max=function(t){return Math.max.apply(null,t)},t.minBy=function(t,e){if(0!=t.length){let i=0,s=t[0],o=e(s);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a<o&&(s=n,o=a,i=r)}return{min:s,value:o,index:i}}},t.maxBy=function(t,e){if(0!=t.length){let i=0,s=t[0],o=e(s);for(let r=1;r<t.length;r++){let n=t[r],a=e(n);a>o&&(s=n,o=a,i=r)}return{max:s,value:o,index:i}}},t.signedNumber=function(t){return 0==t?"0":t>0?"+"+t:""+t},t.splitExtensionFromFilename=a,t.dropExtension=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(0,e):t},t.getExtensionWithDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e):""},t.getExtensionNoDot=function(t){let e=t.lastIndexOf(".");return e>=0?t.substr(e+1):""},t.parsePx=function(t){try{return parseInt(t)}catch(t){return 0}},t.colorBytesToRgbaCss=function(t){return"rgba("+t.join(",")+")"},t.colorBytesToAbgr32=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},t.colorBytesToRgba32=function(t){return t[0]<<24|t[1]<<16|t[2]<<8|t[3]},t.spliterate=function(t,e,i){for(var s,o=0;(s=t.indexOf(e,o))>=0;)i(t.substring(o,s)),o=s+e.length;o<t.length-1&&i(t.substring(o,t.length))},t.stringify=function(t){if(void 0===t)return"undefined";if(null==t)return"null";if(t.hasOwnProperty("message"))return t.message||"[No message]";if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t.toString()}},t.join16=function(t,e){return t.map(t=>(0|t).toString(16)).join(e)},t.uint8ArrayToString=function(t){for(var e="",i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return e},t.randomInt=function(t){return Math.floor(Math.random()*t)},t.randomInt2=function(t,e){return Math.floor(Math.random()*(e-t)+t)},t.centerElide=function(t,e){if(t&&t.length>=e){let i=Math.floor((e-4)/2);return t.substring(0,i)+"..."+t.substring(t.length-i)}return t},t.elide=function(t,e){return t&&t.length>=e?t.substring(0,e-3)+"...":t},t.sqr=function(t){return t*t},t.cube=function(t){return t*t*t},t.safeDiv=function(t,e,i=0){return 0==e?i:t/e},t.find=function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return t[i];return null},t.setEquals=function(t,e){if(t.size!=e.size)return!1;for(let i of t)if(!e.has(i))return!1;return!0},t.setAssign=function(t,e){t.clear(),e.forEach(e=>t.add(e))},t.mapEquals=function(t,e){if(t.size!=e.size)return!1;for(let[i,s]of t)if(e.get(i)!==s)return!1;return!0},t.mapAssign=function(t,e){t.clear(),e.forEach((e,i)=>t.set(i,e))}}(F||(F={})),function(t){function e(t){return"undefined"==typeof csrfToken?t:t+(t.indexOf("?")<0?"?":"&")+csrfToken.name+"="+csrfToken.value}t.csrf=e,t.ajax=function(t){if("undefined"!=typeof csrfToken){"GET"!=(t.method||t.type||"GET").toUpperCase()&&(t.url=e(t.url||""))}return $.ajax(t)}}(c||(c={})),function(t){const e=/(''|[^']|^){(\d+)(,number,[^}]*)?}/g,i=/(''|[^']|^){(\d+),plural,\s*(one\s*{([^}]*)})?\s*(few\s*{([^}]*)})?\s*other\s*{([^}]*)}\s*}/g;function s(t,e,i=void 0){return`{${t},plural,one{${e}}other{${i||e+"s"}}}`}let o;t.pluralWithoutNumber=s,t.plural=function(t,e,i=void 0){return function(t){return`{${t},number,integer}`}(t)+" "+s(t,e,i)},t.s=function(t,...s){if(0==t.length)return"";const o=t;for(var r=t.length,n=0;n<r&&o.charCodeAt(n)<=32;)n++;for(;n<r&&o.charCodeAt(r-1)<=32;)r--;const a=0==n?"":o.substring(0,n);t=0==n&&r==o.length?o:o.substring(n,r);const h=r==o.length?"":o.substring(r,o.length);var l=window.I18nPhrases[t];return void 0===l&&(!function(t,e){if(window.I18nPhrases[t]=t,!window.I18nPhrases.__translations_disabled__){const s={en:t,args:e};c.ajax({url:"/logMissingI18nPhrase",method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(s)});const o=window.I18nPhrases||{};for(var i in o)o.hasOwnProperty(i)}}(t,s),l=t),s.length>0&&(l=(l=l.replace(e,function(t,e,i,o){"''"==e&&(e="'");let r=s[parseInt(i,10)];return",number,integer"==o&&(r=p(r)),e+r})).replace(i,function(t,e,i,o,r,n,a,h){"''"==e&&(e="'");const l=s[parseInt(i,10)];return e+(function(t,e,i){switch(GlobalsShared.locale.split("-")[0]){case"zh":case"ja":case"ko":case"tr":case"th":case"id":return;case"ru":return t%10==1&&t%100!=11?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?i:void 0;case"po":return 1==t?e:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?i:void 0;case"fr":case"pt":return t>1?e:void 0;default:return 1==t?e:void 0}}(parseInt(l),r,a)||h)})),a&&(l=a+l),h&&(l+=h),l},t.commaList=function(t){return t.join(", ")},function(t){t.format=function(t){return"$"+t.toFixed(2)}}(o||(o={}));class r{constructor(t){this.currency=t}format(t){return this.currency+t.toFixed(2)}}const n={};function a(t,e,i=GlobalsShared.locale){const s=i+"-"+t,a=n[s]||(n[s]=function(t,e){try{return new Intl.NumberFormat(e,{style:"currency",currency:t})}catch(e){return"USD"==t?o:new r(t)}}(t,i));return a.format(e/100)}let h;t.dollars=function(t,e=GlobalsShared.locale){return a("USD",t,e)},t.currencyAmount=a,function(t){t.format=function(t){return(100*t).toFixed(0)+"%"}}(h||(h={}));const l={};t.percent=function(t,e=GlobalsShared.locale){return(l[e]||(l[e]=function(t){try{return new Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:0})}catch(t){return h}}(e))).format(t/100)};class u{constructor(t){this.precision=t}format(t){return t.toFixed(this.precision)}}const d={};function p(t,e=GlobalsShared.locale){return t.toLocaleString(e)}t.double=function(t,e=2,i=GlobalsShared.locale){const s=i+"-"+e;return(d[s]||(d[s]=function(t,e){try{return new Intl.NumberFormat(e,{minimumFractionDigits:t,maximumFractionDigits:t})}catch(e){return new u(t)}}(e,i))).format(t)},t.int=p}(u||(u={}));class it{constructor(t){this.data=new Uint8Array(t),this.offsetCount=0}length(){return this.data.length}hasMore(){return this.offsetCount<this.data.length}skip(t){this.offsetCount+=t}nonEmpty(){return this.data.length>0}readInt8(){return this.data[this.offsetCount++]}readInt8s(t){var e=this.data.slice(this.offsetCount,this.offsetCount+t);return this.offsetCount+=t,e}readInt16(){return 256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt24(){return 256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readInt32(){return 256*this.data[this.offsetCount++]*256*256+256*this.data[this.offsetCount++]*256+256*this.data[this.offsetCount++]+this.data[this.offsetCount++]}readSignedInt16(){var t=this.readInt16();return t>=32768&&(t-=65536),t}}!function(t){const e={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},s={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},o={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};const r={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function n(t,e,i){for(var s,o,n,a,h=new DataView(t),c={},u=e;u<e+i;)28===h.getUint8(u)&&2===h.getUint8(u+1)&&(a=h.getUint8(u+2))in r&&((n=h.getInt16(u+3))+5,o=r[a],s=l(h,u+5,n),c.hasOwnProperty(o)?c[o]instanceof Array?c[o].push(s):c[o]=[c[o],s]:c[o]=s),u++;return c}function a(t,e,i,s,o){var r,n,a=t.getUint16(i,!o),l={};for(n=0;n<a;n++)r=i+12*n+2,l[s[t.getUint16(r,!o)]]=h(t,r,e,i,o);return l}function h(t,e,i,s,o){var r,n,a,h,c,u,d=t.getUint16(e+2,!o),p=t.getUint32(e+4,!o),m=t.getUint32(e+8,!o)+i;switch(d){case 1:case 7:if(1==p)return t.getUint8(e+8);for(r=p>4?m:e+8,n=[],h=0;h<p;h++)n[h]=t.getUint8(r+h);return n;case 2:return l(t,r=p>4?m:e+8,p-1);case 3:if(1==p)return t.getUint16(e+8,!o);for(r=p>2?m:e+8,n=[],h=0;h<p;h++)n[h]=t.getUint16(r+2*h,!o);return n;case 4:if(1==p)return t.getUint32(e+8,!o);for(n=[],h=0;h<p;h++)n[h]=t.getUint32(m+4*h,!o);return n;case 5:if(1==p)return c=t.getUint32(m,!o),u=t.getUint32(m+4,!o),(a=new Number(c/u)).numerator=c,a.denominator=u,a;for(n=[],h=0;h<p;h++)c=t.getUint32(m+8*h,!o),u=t.getUint32(m+4+8*h,!o),n[h]=new Number(c/u),n[h].numerator=c,n[h].denominator=u;return n;case 9:if(1==p)return t.getInt32(e+8,!o);for(n=[],h=0;h<p;h++)n[h]=t.getInt32(m+4*h,!o);return n;case 10:if(1==p)return t.getInt32(m,!o)/t.getInt32(m+4,!o);for(n=[],h=0;h<p;h++)n[h]=t.getInt32(m+8*h,!o)/t.getInt32(m+4+8*h,!o);return n}}function l(t,e,i){for(var s="",o=e;o<e+i;o++)s+=String.fromCharCode(t.getUint8(o));return s}function c(t,r,n){if("Exif"!=l(t,r,4))return!1;var h,c,u,d,p,m=r+6;if(18761==t.getUint16(m))h=!1;else{if(19789!=t.getUint16(m))return!1;h=!0}if(42!=t.getUint16(m+2,!h))return!1;var g=t.getUint32(m+4,!h);if(g<8)return!1;if((c=a(t,m,m+g,i,h)).ExifIFDPointer)for(u in d=a(t,m,m+c.ExifIFDPointer,e,h)){switch(u){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":d[u]=o[u][d[u]];break;case"ExifVersion":case"FlashpixVersion":d[u]=String.fromCharCode(d[u][0],d[u][1],d[u][2],d[u][3]);break;case"ComponentsConfiguration":d[u]=o.Components[d[u][0]]+o.Components[d[u][1]]+o.Components[d[u][2]]+o.Components[d[u][3]]}c[u]=d[u]}if(c.GPSInfoIFDPointer)for(u in p=a(t,m,m+c.GPSInfoIFDPointer,s,h)){if("GPSVersionID"===u)p[u]=p[u][0]+"."+p[u][1]+"."+p[u][2]+"."+p[u][3];c[u]=p[u]}return c}t.readFromBinaryFile=function(t){const e=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var i=2,s=t.byteLength,o=function(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)};i<s;){if(o(e,i)){var r=e.getUint8(i+7);return r%2!=0&&(r+=1),0===r&&(r=4),n(t,i+8+r,e.getUint16(i+6+r))}i++}}(t),i=function(t){var e=new DataView(t);if(255!=e.getUint8(0)||216!=e.getUint8(1))return!1;for(var i=2,s=t.byteLength;i<s;){if(255!=e.getUint8(i))return!1;if(225==e.getUint8(i+1))return c(e,i+4,e.getUint16(i+2));i+=2+e.getUint16(i+2)}}(t);return{iptc:e,exif:i}}}(d||(d={})),function(t){t[t.Undefined=0]="Undefined",t[t.R0=1]="R0",t[t.R90=2]="R90",t[t.R180=3]="R180",t[t.R270=4]="R270"}(p||(p={})),function(t){t[t.Undefined=0]="Undefined",t[t.Uncalibrated=1]="Uncalibrated",t[t.sRgb=2]="sRgb",t[t.adobeRgb=3]="adobeRgb"}(m||(m={})),function(t){t[t.Success=0]="Success",t[t.ErrorFileReader=1]="ErrorFileReader",t[t.ErrorParse=2]="ErrorParse",t[t.ErrorException=3]="ErrorException"}(g||(g={})),function(t){t[t.Undefined=0]="Undefined",t[t.None=1]="None",t[t.Inch=2]="Inch",t[t.Centimeter=3]="Centimeter",t[t.Meter=4]="Meter"}(f||(f={}));class st{constructor(t,e,i,s,o,r,n,a,h){this.statusCode=t,this.width=e,this.height=i,this.orientation=s,this.resolutionUnits=o,this.resolutionX=r,this.resolutionY=n,this.colorSpace=a,this.type=h,this.wasRotated=!1}applyOrientation(){if(this.orientation==p.R90||this.orientation==p.R270){let t=this.width;this.width=this.height,this.height=t}this.wasRotated=!0}checkFixType(t){return this.type!=t.type?F.changeFileTypeAndExtension(t,this.type):t}getRawDpi(){let t=this.resolutionX.valueOf();if(t<=0)return 72;switch(this.resolutionUnits){case f.Inch:return t;case f.Centimeter:return 2.54*t;case f.Meter:return 2.54*t/100;default:return 72}}dpi(){let t=this.getRawDpi(),e=Math.round(t),i=Math.abs(t-e);return 0<i&&i<.01?e:t}}!function(t){const e=[137,80,78,71,13,10,26,10],i=new Number(0);function s(t,e){return new st(t,0,0,p.Undefined,f.Undefined,0,0,m.Undefined,e)}function o(t,e){try{let i=new it(t),s=Math.min(12,i.length()),o=i.readInt8s(s),r="";return r=s>=8&&137===o[0]&&80===o[1]&&78===o[2]&&71===o[3]&&13===o[4]&&10===o[5]&&26===o[6]&&10===o[7]?"image/png":s>=2&&255===o[0]&&216===o[1]?"image/jpeg":s>=6&&71===o[0]&&73===o[1]&&70===o[2]&&56===o[3]&&(55===o[4]||57===o[4])&&97===o[5]?"image/gif":s>=2&&66===o[0]&&77===o[1]?"image/bmp":s>=12&&82===o[0]&&73===o[1]&&70===o[2]&&70===o[3]&&87===o[8]&&69===o[9]&&66===o[10]&&80===o[11]?"image/webp":s>=4&&(73===o[0]&&73===o[1]&&42===o[2]&&0===o[3]||77===o[0]&&77===o[1]&&0===o[2]&&42===o[3])?"image/tiff":s>=4&&0===o[0]&&0===o[1]&&1===o[2]&&0===o[3]?"image/x-icon":e||"application/octet-stream",r}catch(t){return e}}t.inverseOrientation=function(t){switch(t){default:case p.Undefined:return p.Undefined;case p.R0:return p.R0;case p.R90:return p.R270;case p.R180:return p.R180;case p.R270:return p.R90}},t.sniffType=function(t,e){F.blobToArrayBuffer(t,function(i){e(o(i,t.type))},function(i){e(t.type)})},t.sniffTypeBuf=o,t.get=function(t,r){F.blobToArrayBuffer(t,function(n){let a=o(n,t.type);try{let t,o=new it(n);switch(a){case"image/png":t=function(t,i){for(let o=0;o<e.length&&t.hasMore();o++)if(e[o]!=t.readInt8())return s(g.ErrorParse,i);let o=0,r=0,n=0,a=0,h=f.Undefined,l=m.Undefined,c=p.Undefined;for(;t.hasMore();){let e=t.readInt32(),i=F.uint8ArrayToString(t.readInt8s(4));if("pHYs"==i){o=t.readInt32(),r=t.readInt32();let e=t.readInt8();h=0==e?f.None:1==e?f.Meter:f.Undefined}else if("IHDR"==i){let i=t.offsetCount;n=t.readInt32(),a=t.readInt32(),t.offsetCount=i,t.readInt8s(e)}else if("iCCP"==i){let i=t.offsetCount,s="",o=t.readInt8(),r=0;for(;0!=o&&r<79;)s+=String.fromCharCode(o),o=t.readInt8(),r++;t.readInt8s(e-(t.offsetCount-i))}else t.readInt8s(e);t.readInt32()}return new st(g.Success,n,a,c,h,o,r,l,i)}(o,a);break;case"image/jpg":case"image/jpeg":t=function(t,e){let s=i,o=i,r=0,n=0,a=f.Undefined,l=m.Undefined,c=p.Undefined,u=d.readFromBinaryFile(t.data.buffer);if(u.exif){s=h.getOrElse(u.exif,"XResolution",i),o=h.getOrElse(u.exif,"YResolution",i),r=h.getOrElse(u.exif,"ImageWidth",0),n=h.getOrElse(u.exif,"ImageHeight",0);let t=h.getOrElse(u.exif,"ResolutionUnit",0);a=3==t?f.Centimeter:2==t?f.Inch:1==t?f.None:f.Undefined;let e=h.getOrElse(u.exif,"ColorSpace",0);l=65535==e?m.Uncalibrated:1==e?m.sRgb:m.Undefined;let d=h.getOrElse(u.exif,"Orientation",0);c=1==d?p.R0:3==d?p.R180:6==d?p.R90:8==d?p.R270:p.Undefined}return new st(g.Success,r,n,c,a,s,o,l,e)}(o,a);break;case"image/gif":t=function(t,e){return s(g.ErrorParse,e)}(0,a);break;default:t=s(g.ErrorParse,a)}r(t)}catch(t){r(s(g.ErrorException,a))}},function(e){r(s(g.ErrorFileReader,t.type))})}}(b||(b={}));class ot{constructor(t,e){this.x=t,this.y=e}static empty(){return new ot(0,0)}static zero(){return new ot(0,0)}static nan(){return new ot(Number.NaN,Number.NaN)}static from(t){return new ot(t.x,t.y)}toString(){return"("+this.x+", "+this.y+")"}inFinite(){return this.isFinite()}isFinite(){return isFinite(this.x)&&isFinite(this.y)}isNaN(){return isNaN(this.x)||isNaN(this.y)}interpolate(t,e){return new ot(this.x*(1-e)+t.x*e,this.y*(1-e)+t.y*e)}setInterpolated(t,e,i){return this.setXy(t.x*(1-i)+e.x*i,t.y*(1-i)+e.y*i)}distanceSqrTo(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}distanceTo(t){return Math.sqrt(this.distanceSqrTo(t))}offset(t,e){return new ot(this.x+t,this.y+e)}set(t){return this.x=t.x,this.y=t.y,this}setScaled(t,e){return this.x=t.x*e,this.y=t.y*e,this}setXy(t,e){return this.x=t,this.y=e,this}setNan(){return this.setXy(Number.NaN,Number.NaN)}round(){return new ot(Math.round(this.x),Math.round(this.y))}floor(){return new ot(Math.floor(this.x),Math.floor(this.y))}snap(t=.5,e=.5){return new ot(Math.floor(this.x)+t,Math.floor(this.y)+e)}rotateInPlace(t,e){const i=Math.sin(t),s=Math.cos(t),o=this.x-e.x,r=this.y-e.y;return this.setXy(e.x+s*o-i*r,e.y+i*o+s*r),this}rotateInto(t,e,i,s,o){const r=this.x-i,n=this.y-s;o.setXy(i+t*r-e*n,s+e*r+t*n)}rotate(t,e){const i=Math.sin(t),s=Math.cos(t),o=this.x-e.x,r=this.y-e.y;return new ot(e.x+s*o-i*r,e.y+i*o+s*r)}plusEquals(t){return this.x+=t.x,this.y+=t.y,this}plusEqualsXy(t,e){return this.x+=t,this.y+=e,this}plusEqualsScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}equals(t){return t&&this.x==t.x&&this.y==t.y}notEquals(t){return!this.equals(t)}minusEquals(t){return this.x-=t.x,this.y-=t.y,this}minusXyEquals(t,e){return this.x-=t,this.y-=e,this}minus(t){return new ot(this.x-t.x,this.y-t.y)}plus(t){return new ot(this.x+t.x,this.y+t.y)}times(t){return new ot(t*this.x,t*this.y)}timesEquals(t){return this.x*=t,this.y*=t,this}cross(t){return this.x*t.y-this.y*t.x}ortho(){return new ot(this.y,-this.x)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}capLength(t){let e=this.length();return e>t&&this.timesEquals(t/e),this}dup(){return ot.from(this)}}!function(t){t[t.TopLeft=0]="TopLeft",t[t.Top=1]="Top",t[t.TopRight=2]="TopRight",t[t.Right=3]="Right",t[t.BottomRight=4]="BottomRight",t[t.Bottom=5]="Bottom",t[t.BottomLeft=6]="BottomLeft",t[t.Left=7]="Left",t[t.Center=8]="Center"}(w||(w={})),function(t){t.opposite=function(e){switch(e){case t.TopLeft:return t.BottomRight;case t.Top:return t.Bottom;case t.TopRight:return t.BottomLeft;case t.Right:return t.Left;case t.BottomRight:return t.TopLeft;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipX=function(e){switch(e){case t.TopLeft:return t.TopRight;case t.Top:return t.Top;case t.TopRight:return t.TopLeft;case t.Right:return t.Left;case t.BottomRight:return t.BottomLeft;case t.Bottom:return t.Bottom;case t.BottomLeft:return t.BottomRight;case t.Left:return t.Right;case t.Center:return t.Center}return t.Center},t.flipY=function(e){switch(e){case t.TopLeft:return t.BottomLeft;case t.Top:return t.Bottom;case t.TopRight:return t.BottomRight;case t.Right:return t.Right;case t.BottomRight:return t.TopRight;case t.Bottom:return t.Top;case t.BottomLeft:return t.TopLeft;case t.Left:return t.Left;case t.Center:return t.Center}return t.Center},t.interpolationCoefficientsFor=function(e){switch(e){case t.TopLeft:return{tx:0,ty:0};case t.Top:return{tx:.5,ty:0};case t.TopRight:return{tx:1,ty:0};case t.Right:return{tx:1,ty:.5};case t.BottomRight:return{tx:1,ty:1};case t.Bottom:return{tx:.5,ty:1};case t.BottomLeft:return{tx:0,ty:1};case t.Left:return{tx:0,ty:.5};case t.Center:return{tx:.5,ty:.5}}return{tx:.5,ty:.5}}}(w||(w={}));class rt{constructor(t,e,i,s){this.p0=t,this.p1=e,this.p2=i,this.p3=s,this.points=[],this.points.push(t,e,i,s)}static empty(){return new rt(ot.empty(),ot.empty(),ot.empty(),ot.empty())}set(t){return this.p0.set(t.p0),this.p1.set(t.p1),this.p2.set(t.p2),this.p3.set(t.p3),this}dup(){return new rt(this.p0.dup(),this.p1.dup(),this.p2.dup(),this.p3.dup())}contains(t,e){var i=!1;const s=this.points.length;for(var o=0;o<s;o++){var r=this.points[o],n=this.points[(o+1)%s];(n.y<e&&r.y>=e||r.y<e&&n.y>=e)&&n.x+(e-n.y)/(r.y-n.y)*(r.x-n.x)<t&&(i=!i)}return i}isConvex(){function t(t){return t<0?-1:t>0?1:0}var e=this.p1.minus(this.p0),i=this.p2.minus(this.p1),s=this.p3.minus(this.p2),o=this.p0.minus(this.p3),r=t(e.cross(i)),n=t(i.cross(s)),a=t(s.cross(o)),h=t(o.cross(e));return r==n&&r==a&&r==h}rotateInPlace(t,e){return this.p0.rotateInPlace(t,e),this.p1.rotateInPlace(t,e),this.p2.rotateInPlace(t,e),this.p3.rotateInPlace(t,e),this}rotate(t,e){return this.dup().rotateInPlace(t,e)}}class nt{constructor(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s}static zero(){return new nt(0,0,0,0)}static empty(){return new nt(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}static unit(){return new nt(0,0,1,1)}static ofSize(t,e,i,s){return new nt(t,e,t+i,e+s)}static fromBoundingRect(t){return new nt(t[0],t[1],t[2],t[3])}static fromCropRect(t){return new nt(t.left0,t.top0,t.right0,t.bottom0)}static fromPoints(t){if(0==t.length)return null;for(var e=t[0],i=new nt(e.x,e.y,e.x,e.y),s=1;s<t.length;s++)i.addPoint(t[s]);return i}static fromQuad(t){return nt.fromPoints(t.points)}toString(){return"Rect("+this.left+", "+this.top+", "+this.right+", "+this.bottom+")"}equals(t){return this.left==t.left&&this.top==t.top&&this.right==t.right&&this.bottom==t.bottom}dup(){return new nt(this.left,this.top,this.right,this.bottom)}setNull(){return this.set(null,null,null,null)}setFrom(t){return this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom,this}set(t,e,i,s){return this.left=t,this.top=e,this.right=i,this.bottom=s,this}scale(t){return this.left*=t,this.top*=t,this.right*=t,this.bottom*=t,this}fromCropRect(t){return this.set(t.left0,t.top0,t.right0,t.bottom0)}contains(t,e){return this.left<=t&&t<=this.right&&this.top<=e&&e<=this.bottom}containsPoint(t){return this.contains(t.x,t.y)}intersects(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}intersectionWith(t){return this.left=Math.max(this.left,t.left),this.top=Math.max(this.top,t.top),this.right=Math.min(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this}unionWith(t){return this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.right=Math.max(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this}leftCenter(){return new ot(this.left,.5*(this.top+this.bottom))}topLeft(){return new ot(this.left,this.top)}topCenter(){return new ot(.5*(this.left+this.right),this.top)}topRight(){return new ot(this.right,this.top)}rightCenter(){return new ot(this.right,.5*(this.top+this.bottom))}bottomLeft(){return new ot(this.left,this.bottom)}bottomCenter(){return new ot(.5*(this.left+this.right),this.bottom)}bottomRight(){return new ot(this.right,this.bottom)}center(){return new ot(.5*(this.left+this.right),.5*(this.top+this.bottom))}translate(t,e){return this.top+=e,this.bottom+=e,this.left+=t,this.right+=t,this}point(t){switch(t){case w.TopLeft:return this.interpolate(0,0);case w.Top:return this.interpolate(.5,0);case w.TopRight:return this.interpolate(1,0);case w.Right:return this.interpolate(1,.5);case w.BottomRight:return this.interpolate(1,1);case w.Bottom:return this.interpolate(.5,1);case w.BottomLeft:return this.interpolate(0,1);case w.Left:return this.interpolate(0,.5);case w.Center:return this.interpolate(.5,.5)}return this.interpolate(.5,.5)}setAnchorPoint(t,e){switch(t){case w.TopLeft:this.left=e.x,this.top=e.y;break;case w.Top:this.top=e.y;break;case w.TopRight:this.top=e.y,this.right=e.x;break;case w.Right:this.right=e.x;break;case w.BottomRight:this.right=e.x,this.bottom=e.y;break;case w.Bottom:this.bottom=e.y;break;case w.BottomLeft:this.left=e.x,this.bottom=e.y;break;case w.Left:this.left=e.x;case w.Center:}return this}moveAnchorTo(t,e){let i=this.point(t);return this.translate(e.x-i.x,e.y-i.y),this}moveAnchor(t,e){switch(t){case w.TopLeft:this.left=Math.min(this.left+e.x,this.right),this.top=Math.min(this.top+e.y,this.bottom);break;case w.Top:this.top=Math.min(this.top+e.y,this.bottom);break;case w.TopRight:this.top=Math.min(this.top+e.y,this.bottom),this.right=Math.max(this.right+e.x,this.left);break;case w.Right:this.right=Math.max(this.right+e.x,this.left);break;case w.BottomRight:this.right=Math.max(this.right+e.x,this.left),this.bottom=Math.max(this.bottom+e.y,this.top);break;case w.Bottom:this.bottom=Math.max(this.bottom+e.y,this.top);break;case w.BottomLeft:this.left=Math.min(this.left+e.x,this.right),this.bottom=Math.max(this.bottom+e.y,this.top);break;case w.Left:this.left=Math.min(this.left+e.x,this.right);break;case w.Center:this.left+=e.x,this.top+=e.y,this.right+=e.x,this.bottom+=e.y}return this}moveAnchorToMinSize(t,e,i){var s=Math.max(0,e-this.width()),o=Math.max(0,i-this.height());switch(t){case w.TopLeft:this.left-=s,this.top-=o;break;case w.Top:this.top-=o;break;case w.TopRight:this.top-=o,this.right+=s;break;case w.Right:this.right+=s;break;case w.BottomRight:this.right+=s,this.bottom+=o;break;case w.Bottom:this.bottom+=o;break;case w.BottomLeft:this.left-=s,this.bottom+=o;break;case w.Left:this.left-=s;break;case w.Center:s*=.5,o*=.5,this.left-=s,this.right+=s,this.top-=o,this.bottom+=o}return this}forceAspectRatio(t,e){const i=t*this.width();var s=0,o=0;e==w.TopLeft||e==w.TopRight||e==w.BottomRight||e==w.BottomLeft?i>this.height()?s=i-this.height():o=this.height()/t-this.width():e==w.Top||e==w.Bottom?o=this.height()/t-this.width():s=i-this.height();const r=.5*o,n=.5*s;switch(e){case w.Top:this.bottom+=s,this.left-=r,this.right+=r;break;case w.Left:this.right+=o,this.top-=n,this.bottom+=n;break;case w.Bottom:this.top-=s,this.left-=r,this.right+=r;break;case w.Right:this.left-=o,this.top-=n,this.bottom+=n;break;case w.TopLeft:this.bottom+=s,this.right+=o;break;case w.TopRight:this.bottom+=s,this.left-=o;break;case w.BottomRight:this.top-=s,this.left-=o;break;case w.BottomLeft:this.top-=s,this.right+=o;break;case w.Center:this.top-=n,this.bottom+=n,this.left-=r,this.right+=r}return this}interpolate(t,e){return new ot(this.left*(1-t)+t*this.right,this.top*(1-e)+e*this.bottom)}transform(t,e){return new ot(e.left+(t.x-this.left)/this.width()*e.width(),e.top+(t.y-this.top)/this.height()*e.height())}sampleGrid(t,e){for(var i=[],s=0;s<e;s++)for(var o=s/(e-1),r=0;r<t;r++)i.push(this.interpolate(r/(t-1),o));return i}setHorizontal(t){return this.left=t.left,this.right=t.right,this}padToFit(t){var e=0,i=0;return e=Math.max(e,this.left-t.left),e=Math.max(e,t.right-this.right),i=Math.max(i,this.top-t.top),i=Math.max(i,t.bottom-this.bottom),this.left-=e,this.right+=e,this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addRect(t){return this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.top=Math.min(this.top,t.top),this.bottom=Math.max(this.bottom,t.bottom),this}addCircle(t,e){return this.addXy(t.x-e,t.y-e),this.addXy(t.x+e,t.y+e),this}addX(t){this.left=Math.min(this.left,t),this.right=Math.max(this.right,t)}addY(t){this.top=Math.min(this.top,t),this.bottom=Math.max(this.bottom,t)}addXy(t,e){this.addX(t),this.addY(e)}addPoint(t){this.addXy(t.x,t.y)}addPointSafe(t){t&&(null==this.left?(this.left=t.x,this.top=t.y,this.right=t.x,this.bottom=t.y):this.addPoint(t))}width(){return this.right-this.left}height(){return this.bottom-this.top}area(){return this.width()*this.height()}aspectRatio(){return this.height()/this.width()}pad(t,e,i,s){return null==e&&(e=t),null==i&&(i=t),null==s&&(s=e),this.left-=t,this.top-=e,this.right+=i,this.bottom+=s,this}padLeft(t){return this.left-=t,this}padTop(t){return this.top-=t,this}padRight(t){return this.right+=t,this}padBottom(t){return this.bottom+=t,this}toQuad(){return new rt(this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft())}snap(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this}round(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this}normalize(){var t=Math.min(this.left,this.right),e=Math.max(this.left,this.right),i=Math.min(this.top,this.bottom),s=Math.max(this.top,this.bottom);return this.left=t,this.right=e,this.top=i,this.bottom=s,this}}!function(t){let e=!1,i=new Image;i.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k=",i.onload=function(){e=2==i.width&&3==i.height},t.BrowserRotates=function(){return e}}(v||(v={})),function(t){t.RecodeJpegQuality=.95;const e=new Set(["image/png","image/jpeg"]);function i(e,i,s,o){b.get(e,function(r){F.loadImageFromBlob(e,s,e=>{if(r.statusCode!=g.Success||r.orientation==p.R0||r.orientation==p.Undefined||v.BrowserRotates()){const s=t.imageToCanvasEx(e,i);s.wasRotated=!1,o(s,r)}else{const s=t.rotateImageToCanvasEx(e,r.orientation,i);s.wasRotated=!0,r.applyOrientation(),o(s,r)}})})}function s(t,e){const i=t.naturalWidth,s=t.naturalHeight;let o=new ht(i,s);return o.wasShrunk=!1,o.context().setGlobalAlpha(1),e&&(o.context().setFillStyle("rgb(255,255,255)"),o.context().fillRect(0,0,i,s)),o.context().context.drawImage(t,0,0,i,s),o}function o(t){return s(t,!0)}function r(t,e,i){const s=t.naturalWidth,r=t.naturalHeight;let n=s,a=r,h=0;switch(e){case p.Undefined:case p.R0:return o(t);case p.R90:n=r,a=s,h=.5*Math.PI;break;case p.R180:h=Math.PI;break;case p.R270:n=r,a=s,h=.5*-Math.PI}let l=new ht(n,a);return l.wasShrunk=!1,l.context().setGlobalAlpha(1),i&&(l.context().setFillStyle("rgb(255,255,255)"),l.context().fillRect(0,0,n,a)),l.context().save(),l.context().translate(.5*n,.5*a),l.context().rotate(h),l.context().context.drawImage(t,.5*-s,.5*-r,s,r),l.context().restore(),l}t.DefaultFontFamily=function(){try{return window.getComputedStyle(document.querySelector("body")).fontFamily}catch(t){return"sans-serif"}}(),t.needsReencoding=function(t){return!e.has(t)},t.recodeCanvasFile=function(e,i){return s=e.type,F.endsWith(s,"jpeg")||F.endsWith(s,"jpg")||F.endsWith(s,"webp")||F.endsWith(s,"jp2")||F.endsWith(s,"cr2")||F.endsWith(s,"nef")||F.endsWith(s,"dng")||F.endsWith(s,"jps")||F.startsWith(s,"image/heif")||F.startsWith(s,"image/avif")?i.toFile("image/jpeg",t.RecodeJpegQuality,F.dropExtension(e.name)+".jpeg"):i.toFile("image/png",1,F.dropExtension(e.name)+".png");var s},t.recodeToJpeg=function(e,i){return i.toFile("image/jpeg",t.RecodeJpegQuality,F.dropExtension(e.name)+".jpeg")},t.loadCheckRotateImage=i,t.loadCheckRotateFlattenImage=function(t,e,s){i(t,!0,e,s)},t.imageToCanvasEx=s,t.flattenImage=o,t.rotateImageToCanvasEx=r,t.rotateAndFlattenImage=function(t,e){return r(t,e,!0)}}(Z||(Z={}));class at{constructor(t,e){this.canvas=t,this.context=e,this.toggleImageSmoothing(t.defaultImageSmoothing)}toggleImageSmoothing(t){this.context.mozImageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.imageSmoothingEnabled=t}width(){return this.context.canvas.width}height(){return this.context.canvas.height}logicalWidth(){return this.canvas.logicalWidth()}logicalHeight(){return this.canvas.logicalHeight()}createPattern(t,e){return this.context.createPattern(t,e)}setStrokeStyle(t){this.context.strokeStyle=t}setLineDash(t){this.context.setLineDash(t)}setLineWidth(t){this.context.lineWidth=t}setLineJoin(t){this.context.lineJoin=t}setLineCap(t){this.context.lineCap=t}strokeText(t,e,i){this.context.strokeText(t,e,i)}fillText(t,e,i){this.context.fillText(t,e,i)}measureText(t){return this.context.measureText(t)}setFont(t){this.context.font=t}save(){this.context.save()}fill(){this.context.fill()}stroke(){this.context.stroke()}strokeRect(t,e,i,s){this.context.strokeRect(t,e,i,s)}strokeCross(t,e,i,s){let o=this.context;o.beginPath(),o.moveTo(t,e),o.lineTo(t+i,e+s),o.moveTo(t+i,e),o.lineTo(t,e+s),o.stroke()}createRadialGradient(t,e,i,s,o,r){return this.context.createRadialGradient(t,e,i,s,o,r)}createLinearGradient(t,e,i,s){return this.context.createLinearGradient(t,e,i,s)}scale(t,e){this.context.scale(t,e)}translate(t,e){this.context.translate(t,e)}setRectToRectTransform(t,e){let i=e.width()/t.width(),s=e.height()/t.height();this.context.setTransform(i,0,0,s,e.left-t.left*i,e.top-t.top*s)}moveTo(t,e){this.context.moveTo(t,e)}lineTo(t,e){this.context.lineTo(t,e)}quadraticCurveTo(t,e,i,s){this.context.quadraticCurveTo(t,e,i,s)}bezierCurveTo(t,e,i,s,o,r){this.context.bezierCurveTo(t,e,i,s,o,r)}rotate(t){this.context.rotate(t)}beginPath(){this.context.beginPath()}closePath(){this.context.closePath()}arc(t,e,i,s,o,r){this.context.arc(t,e,i,s,o,r)}rect(t,e,i,s){this.context.rect(t,e,i,s)}rectTo(t,e,i,s,o){let r=t+i,n=e+s;this.moveTo(t,e),o?(this.lineTo(r,e),this.lineTo(r,n),this.lineTo(t,n)):(this.lineTo(t,n),this.lineTo(r,n),this.lineTo(r,e)),this.lineTo(t,e),this.closePath()}clip(){this.context.clip()}clipBlock(t,e,i,s,o,r){t?(this.save(),this.beginPath(),this.rect(e,i,s-e,o-i),this.clip(),r(),this.restore()):r()}rotatedFrame(t,e,i){0!=t?(this.save(),this.translate(e.x,e.y),this.rotate(t),this.translate(-e.x,-e.y),i(),this.restore()):i()}restore(){this.context.restore()}setFillStyle(t){this.context.fillStyle=t}clearShadow(){this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowBlur=0,this.context.shadowColor=void 0}setShadow(t,e,i,s){this.context.shadowOffsetX=t,this.context.shadowOffsetY=e,this.context.shadowBlur=i,this.context.shadowColor=s}setGlobalAlpha(t){this.context.globalAlpha=t}withGlobalAlpha(t,e){let i=this.context.globalAlpha;this.setGlobalAlpha(t),e(),this.setGlobalAlpha(i)}clearRect(t,e,i,s){this.context.clearRect(t,e,i,s)}clearAll(){this.clearRect(0,0,this.logicalWidth(),this.logicalHeight())}createImageData(t,e){return this.context.createImageData(t,e)}getImageData(t,e,i,s){return this.context.getImageData(t,e,i,s)}getImageDataFull(){return this.context.getImageData(0,0,this.width(),this.height())}putImageData(t,e,i){this.context.putImageData(t,e,i)}putImageData2(t,e,i,s,o,r,n){this.context.putImageData(t,e,i,s,o,r,n)}fillRect(t,e,i,s){this.context.fillRect(t,e,i,s)}roundedRect(t,e,i,s,o){i<2*o&&(o=i/2),s<2*o&&(o=s/2),this.beginPath(),this.moveTo(t+o,e),this.context.arcTo(t+i,e,t+i,e+s,o),this.context.arcTo(t+i,e+s,t,e+s,o),this.context.arcTo(t,e+s,t,e,o),this.context.arcTo(t,e,t+i,e,o),this.closePath()}fillRoundedRect(t,e,i,s,o){this.roundedRect(t,e,i,s,o),this.context.fill()}drawImage(t,e,i){this.context.drawImage(t,e,i)}drawImage2(t,e,i,s,o){this.context.drawImage(t,e,i,s,o)}drawImage3(t,e,i,s,o,r,n,a,h){this.context.drawImage(t,e,i,s,o,r,n,a,h)}drawCanvasEx(t,e,i){this.context.drawImage(t.element,e,i)}drawCanvasEx2(t,e,i,s,o){this.context.drawImage(t.element,e,i,s,o)}drawCanvasEx3(t,e,i,s,o,r,n,a,h){this.context.drawImage(t.element,e,i,s,o,r,n,a,h)}circle(t,e,i){this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!0)}fillCircle(t,e,i,s){s&&(this.context.fillStyle=s),this.circle(t,e,i),this.context.fill()}fillSquare(t,e,i,s){s&&(this.context.fillStyle=s),this.context.fillRect(t-i,e-i,2*i,2*i)}strokeSquare(t,e,i,s){s&&(this.context.strokeStyle=s),this.context.strokeRect(t-i,e-i,2*i,2*i)}strokeCircle(t,e,i,s){s&&(this.context.strokeStyle=s),this.circle(t,e,i),this.context.stroke()}strokeLine(t,e,i,s,o,r){o&&(this.context.lineWidth=o),r&&(this.context.strokeStyle=r),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.stroke()}strokePolyline(...t){if(t.length>1){this.context.beginPath(),this.context.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)this.context.lineTo(t[e].x,t[e].y);this.context.stroke()}}triangle(t,e,i,s,o,r){var n=120*Math.PI/180;o=o||s,r=r||o,this.context.moveTo(t+s*Math.cos(i),e+s*Math.sin(i)),this.context.lineTo(t+o*Math.cos(i+n),e+o*Math.sin(i+n)),this.context.lineTo(t+r*Math.cos(i+2*n),e+r*Math.sin(i+2*n)),this.context.closePath()}strokeEx(t,e,i,s){i&&(this.context.lineJoin=i),s&&(this.context.lineCap=s),this.context.lineWidth=t,this.context.strokeStyle=e,this.context.stroke()}fillEx(t){this.context.fillStyle=t,this.context.fill()}drawCenteredText(t,e,i=18,s=!0){var o=t;const r=t.length;this.setGlobalAlpha(1);let n=i;this.setFont(ht.defaultFontOfSize(n));var a=this.measureText(t).width;const h=this.canvas.logicalWidth();var l=h-20;a>l&&(this.setFont(this.canvas.smallFont),n=12,(a=this.measureText(t).width)>l&&(t=F.centerElide(o,.75*r),(a=this.measureText(t).width)>l&&(t=F.centerElide(o,.5*r),(a=this.measureText(t).width)>l&&(t=F.centerElide(o,.25*r),a=this.measureText(t).width))));let c=(h-a)/2,u=n+4,d=.25*n+1;s&&(this.setGlobalAlpha(.4),this.setFillStyle("#fff"),this.fillRoundedRect(c-4,e-u+d,a+8,u,.4*u),this.setGlobalAlpha(1)),this.setFillStyle("#000"),this.fillText(t,c,e)}}class ht{static defaultFontOfSize(t){return t+"px "+Z.DefaultFontFamily}static fromHTMLImageElement(t,e=1){let i=t.naturalWidth*e,s=t.naturalHeight*e,o=new ht(i,s);return o.context().drawImage2(t,0,0,i,s),o}constructor(t,e,i=1){this.w=t,this.h=e,this.highDpiRatio=1,this.largeFont="20px "+Z.DefaultFontFamily,this.smallFont="14px "+Z.DefaultFontFamily,this.defaultImageSmoothing=!1,this.element=document.createElement("canvas"),this.$element=$(this.element),this.setSize(t,e,i),this.wasShrunk=!1,this.contextCache=null}empty(){}width(){return this.w}height(){return this.h}snapStrokeCenterToDevice(t,e){let i=t*this.highDpiRatio,s=e*this.highDpiRatio;return s==Math.round(s)?s%2==0?Math.round(i)/this.highDpiRatio:(Math.floor(i)+.5)/this.highDpiRatio:t}logicalWidth(){return this.wLogical}logicalHeight(){return this.hLogical}boundsRect(){return new nt(0,0,this.width(),this.height())}logicalBoundsRect(){return nt.ofSize(0,0,this.logicalWidth(),this.logicalHeight())}size(){return this.w*this.h}isInBounds(t,e){return 0<=t&&t<this.width()&&0<=e&&e<this.height()}byteLength(){return 4*this.size()}dup(){let t=new ht(this.width(),this.height());return t.context().drawCanvasEx(this,0,0),t}crop(t,e,i,s){let o=new ht(i,s);return o.context().drawCanvasEx(this,-t,-e),o}isOpaque(){let t=this.context().getImageDataFull().data,e=t.length/4;if(e>0)for(let i=0;i<e;i++){if(t[4*i+3]<255)return!1}return!0}removeAlpha(){let t=this.context().getImageDataFull(),e=t.data,i=e.length/4;if(i>0)for(let t=0;t<i;t++)e[4*t+3]=255;return this.context().putImageData(t,0,0),this}hasTransparency(){return!this.isOpaque()}computeMeanRgba(t,e,i,s){if(null!=t&&null!=e&&null!=i&&null!=s){let o=this.context().getImageData(t,e,i,s).data,r=o.length/4;if(r>0){let t=new Float64Array(4);for(let e=0,i=0;e<r;e++)t[0]+=o[i++],t[1]+=o[i++],t[2]+=o[i++],t[3]+=o[i++];let e=new Uint8ClampedArray(4);return e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r,e[3]=t[3]/r,e}}}computeAlphaWeightedMeanRgba(t,e,i,s){if(null!=t&&null!=e&&null!=i&&null!=s){let o=this.context().getImageData(t,e,i,s).data,r=o.length/4;if(r>0){let t=new Float64Array(4);for(let e=0,i=0;e<r;e++){let e=o[i++],s=o[i++],r=o[i++],n=o[i++];t[0]+=e*n,t[1]+=s*n,t[2]+=r*n,t[3]+=n}let e=new Uint8ClampedArray(4);return t[3]>0&&(e[0]=t[0]/t[3],e[1]=t[1]/t[3],e[2]=t[2]/t[3]),e[3]=t[3]/r,e}}}scale(t){let e=new ht(Math.round(this.width()*t),Math.round(this.height()*t));return e.context().drawCanvasEx2(this,0,0,e.width(),e.height()),e}context(){return null==this.contextCache&&(this.contextCache=new at(this,this.element.getContext("2d")),1!=this.highDpiRatio&&this.contextCache.scale(this.highDpiRatio,this.highDpiRatio)),this.contextCache}checkSetSize(t,e,i=1){return(this.w!=t||this.h!=e||this.highDpiRatio!=i)&&(this.setSize(t,e,i),!0)}setSize(t,e,i=1){t>0&&e>0&&(this.highDpiRatio=i,this.wLogical=t,this.hLogical=e,this.w=t*this.highDpiRatio,this.h=e*this.highDpiRatio,this.element.style.width=t+"px",this.element.style.height=e+"px",this.element.width=this.w,this.element.height=this.h,this.contextCache=null)}clearAll(){this.context().clearRect(0,0,this.width(),this.height())}toImage(){let t=document.createElement("img");return t.src=this.toDataURL(),t}toDataURL(t,e){return this.element.toDataURL(t,e)}toBlob(t,e){return F.dataUrlToBlob(this.toDataURL(t,e))}toBlobAsync(t,e,i){this.element.toBlob(t)}toFile(t,e,i){return F.blobToFile(this.toBlob(t,e),i)}fillAliasedCircle(t,e,i,s){if(!(i<=0)){for(var o=this.context().getImageData(0,0,this.width(),this.height()),r=i*i,n=Math.max(0,Math.floor(t-i)),a=Math.min(this.width()-1,Math.ceil(t+i)),h=Math.max(0,Math.floor(e-i)),l=Math.min(this.height()-1,Math.ceil(e+i)),c=h;c<=l;c++)for(var u=n;u<=a;u++)if((u+.5-t)*(u+.5-t)+(c+.5-e)*(c+.5-e)<=r){var d=4*(c*this.width()+u);o.data[d]=s[0],o.data[d+1]=s[1],o.data[d+2]=s[2],o.data[d+3]=s[3]}this.context().putImageData(o,0,0)}}}!function(t){t.copyTextToClipboard=function(t,e,i){window.navigator&&window.navigator.clipboard&&window.navigator.clipboard.writeText?window.navigator.clipboard.writeText(t).then(()=>{e()},()=>{i()}):i()};const e=new RegExp("mobile|ip(hone|od|ad)|android|blackberry|iemobile|kindle|netfront|silk-accelerated|(hpw|web)os|fennec|minimo|opera m(obi|ini)|blazer|dolfin|dolphin|skyfire|zune");function i(t,e,i){navigator.clipboard&&navigator.clipboard.write&&t?navigator.clipboard.write([new ClipboardItem({[t.type]:t})]).then(()=>{e()},t=>{i()}):setTimeout(i,0)}t.copyImageToClipboard=function(t,e,s){ht.fromHTMLImageElement(t).toBlobAsync(t=>i(t,e,s))},t.copyImageBlobToClipboard=i,t.isMobile=function(){return!!(navigator&&navigator.userAgent&&navigator.userAgent.length>0)&&e.test(navigator.userAgent.toLowerCase())},t.downloadBlob=function(t,e){const i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},0)};const s=/[\/\\:*?"<>|;,.\u0000-\u001f\u007e-\u00a0]/g;t.sanitizeFilename=function(t,e=""){return t.replace(s,e)};const o=/\<svg[^\>]+viewBox\s*=\s*"\s*([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s+([\d\.]+)\s*"/,r=/\<svg[^\>]+width\s*=\s*"\s*([\d\.]+)/,n=/\<svg[^\>]+height\s*=\s*"\s*([\d\.]+)/;function a(t,e,i){let s=new Image;s.onload=function(){URL.revokeObjectURL(s.src),i(s)},s.onerror=e,s.src=t}t.loadImageFromSvgString=function(e,i,s){a(t.svgStringToDataUrl(function(t){let e=r.exec(t),i=n.exec(t);if(e&&2==e.length&&isFinite(parseInt(e[1]))&&i&&2==i.length&&isFinite(parseInt(i[1])))return t;{let e=o.exec(t);if(5==e.length){parseInt(e[1]),parseInt(e[2]);let i=parseInt(e[3]),s=parseInt(e[4]);if(isFinite(i)&&isFinite(s)){let e=150,o=Math.ceil(s/i*e);return t.replace("<svg",`<svg width="${e}" height="${o}"`)}}}return t}(e)),i,s)},t.loadImageFromDataUrl=a,t.loadImageFromUrl=function(t,e,i){let s=new Image;s.onload=()=>i(s),s.onerror=e,s.src=t},t.loadImageFromBlob=function(t,e,i){a(URL.createObjectURL(t),e,i)},t.loadFileFromUrl=function(e,i,s){let o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(o){if(200==this.status){let o=this.response,r=e.split("/");i||(i=r[r.length-1]),s(t.blobToFile(o,i))}},o.send()},t.gaTrack=function(t,e,i,s){"gtag"in window?gtag("event",e,{event_category:t,event_label:i,value:s,non_interaction:!0}):ga("send","event",t,e,i,s,{nonInteraction:!0})},t.gaSetPageAndSendPageview=function(t){ga("set","page",t||location.pathname),ga("send","pageview")},t.modal=function(t,e=!1,i=!1){var s="string"==typeof t?$(t):t.$();e?s.modal({backdrop:!i,keyboard:!0}):s.modal({backdrop:"static",keyboard:!1});var o=$(".modal-backdrop"),r=1040+2*(o.length-1);o.last().css("z-index",r),s.css("z-index",r+1)},t.blink=function(t,e=200,i=3){var s="string"==typeof t?$(t):t.$();function o(){s.fadeIn(e,r)}function r(){--i>0&&s.fadeOut(e,o)}s.fadeOut(e,o)},t.makeElement=function(t,e){var i=$(document.createElement(t));return i.text(e),i},t.formatXhrError=function(e,i){const s=e.responseURL||"[Unknown URL]";if(t.gaTrack("XhrError",s,e.status+", "+(i||"[unknown]")),0===e.status)return u.s("Failed to connect to the server.")+"\n"+u.s("Please verify your network connection.")+"\n";{const s=t.elide((o=e.response)?"object"==typeof o?JSON.stringify(o):o.toString():"null",200);return e.status<200||299<e.status?e.statusText+" ["+e.status+"]\n"+s:"parsererror"===i?u.s("Failed to parse JSON response.")+" ["+i+"]\n"+s:"timeout"===i?u.s("Request time out.")+" ["+i+"]":"abort"===i?u.s("Request aborted by the server.")+" ["+i+"]":"empty"===i?u.s("Server gave an empty response."):u.s("Unknown error.")+"\n"+s}var o}}(F||(F={})),function(t){t.attachToLink=function(t,e){t.off("dragstart.DragUrl").on("dragstart.DragUrl",function(t){const i=e();i&&t.originalEvent.dataTransfer.setData("DownloadURL",i+":"+this.href)})},t.attachDecorated=function(){$("a[data-dragurl]").on("dragstart",function(t){const e=$(this).data("dragurl");e&&t.originalEvent.dataTransfer.setData("DownloadURL",e)})}}(C||(C={})),function(t){t.isCommandOrCtrl=function(t){return 17==t||224==t||91==t||93==t},t.isShift=function(t){return 16==t}}(x||(x={})),function(t){const e=".FileDropper";var i,s=!0;let o,r;t.ShiftWasDown=!1,function(t){t[t.Dropped=0]="Dropped",t[t.Picked=1]="Picked",t[t.Pasted=2]="Pasted",t[t.Url=3]="Url"}(o=t.InputMethod||(t.InputMethod={})),function(t){t[t.NoBrowserSupport=0]="NoBrowserSupport",t[t.NonFileInput=1]="NonFileInput",t[t.NonImageInput=2]="NonImageInput"}(r=t.ErrorCode||(t.ErrorCode={})),t.initialize=function(n){var a=!1,h=$.extend({},{hover_class_on:n.monitor_drag,focusPasteOnCtrlV:!!n.monitor_paste,afterPaste:t=>{}},n);function l(t,e,i){h.afterPaste(!1),h.error(t,e,i)}function c(){s=!1,h.monitor_drag&&h.hover_class_on&&h.hover_class&&h.monitor_drag.$().off(e),h.monitor_file_input&&h.monitor_file_input.$().off(e),h.monitor_paste&&h.monitor_paste.$().off(e),h.focusPasteOnCtrlV&&$(window).off(e)}function d(t,e,i){s&&(t&&t.length>0?("Pasted"==e&&h.afterPaste(!0),h.beforeDrop&&h.beforeDrop(),i==o.Dropped&&h.hideDurationMs?setTimeout(()=>{h.drop.call(this,t,i),h.dropOnce&&c()},h.hideDurationMs):(h.drop.call(this,t,i),h.dropOnce&&c())):l(u.s(e+" a non-file input"),i,r.NonFileInput))}function p(t,e){clearTimeout(i),t.stopImmediatePropagation(),t.preventDefault();let s=!1;try{let e=t.originalEvent.dataTransfer;if(e){let t=e.types;for(let e=0;e<t.length;e++){if("Files"==t[e]){s=!0;break}}}}catch(t){s=!0}let o=h.hover_class_on.$().hasClass(h.hover_class.name()),r=e&&s;return o&&!r?(h.beforeHide&&h.beforeHide(),h.hideDurationMs?setTimeout(()=>h.hover_class_on.$().removeClass(h.hover_class.name()),h.hideDurationMs):h.hover_class_on.$().removeClass(h.hover_class.name()),h.afterHide&&h.afterHide()):!o&&r&&(h.beforeShow&&h.beforeShow(),h.hover_class_on.$().addClass(h.hover_class.name())),s}function m(){h.pastedUrl?l(u.s("Pasted something that wasn't an image or URL?"),o.Pasted,r.NonImageInput):l(u.s("Pasted something that wasn't an image?"),o.Pasted,r.NonImageInput)}function g(t){let e=new Blob([t],{type:t.type});return e.lastModified=t.lastModified,e.name=function(){function t(t){return("0"+t).slice(-2)}let e=new Date;return"Pasted-"+e.getFullYear()+t(e.getMonth()+1)+t(e.getDate())+"-"+t(e.getHours())+t(e.getMinutes())+t(e.getSeconds())}(),e}return h.monitor_drag&&h.hover_class_on&&h.hover_class&&h.monitor_drag.$().on("drop"+e,function(e){var i,s;if(p(e,!1)){t.ShiftWasDown=e.shiftKey;const r=e.originalEvent.dataTransfer;if(r.items&&r.items.length>0&&"webkitGetAsEntry"in r.items[0]){const t=[];for(let e=0;e<r.items.length;e++){const o=null===(s=(i=r.items[e]).webkitGetAsEntry)||void 0===s?void 0:s.call(i);o&&t.push(o)}t.length>0?function(t){const e=[],i=[...t];return new Promise(t=>{const s=()=>{if(0===i.length){const i=new Map;for(let t of e){const e=t.fullPath||"/",s=e.substring(0,e.lastIndexOf("/"))||"/";i.has(s)||i.set(s,[]),i.get(s).push(t.file)}const s=[],o=Array.from(i.keys()).sort();for(let t of o){const e=i.get(t).sort((t,e)=>t.name.localeCompare(e.name));s.push(...e)}return void t(s)}const o=i.shift();o.isFile?o.file(t=>{e.push({file:t,fullPath:o.fullPath}),s()},()=>s()):o.isDirectory?o.createReader().readEntries(t=>{i.push(...t),s()},()=>s()):s()};s()})}(t).then(t=>{d(t,"Dropped",o.Dropped)}):d(r.files,"Dropped",o.Dropped)}else d(r.files,"Dropped",o.Dropped)}return!1}).on("dragenter"+e,function(t){p(t,!0),h.onDragEnter&&h.onDragEnter(t)}).on("dragover"+e,function(t){let e=p(t,!0);t.originalEvent.dataTransfer.dropEffect=s&&e?"copy":"none",h.onDragOver&&h.onDragOver(t)}).on("dragleave"+e,function(t){i=setTimeout(()=>{p(t,!1),h.onDragLeave&&h.onDragLeave(t)},100)}),h.monitor_file_input&&h.monitor_file_input.$().on("change"+e,e=>{t.ShiftWasDown=e.shiftKey;let i=e.originalEvent.target;return d(i.files,"Picked",o.Picked),i.value=null,!1}),h.monitor_paste&&(h.monitor_paste.$().on("paste"+e,function(e){if(t.ShiftWasDown=e.shiftKey,!s)return;const i=e.originalEvent.clipboardData;if(i&&i.files&&i.files.length>0)1==i.files.length&&"image.png"==i.files[0].name?d([g(i.files[0])],"Pasted",o.Pasted):d(i.files,"Pasted",o.Pasted);else if(i&&!i.items)l(u.s("Terribly sorry, it seems like your browser doesn't fully support pasting of images yet?")+"\n\n"+u.s("Paste should work in at least Chrome, Firefox, and Microsoft Edge. "),o.Pasted,r.NoBrowserSupport);else if(i&&i.items&&i.items.length>0&&i.types&&i.types.length==i.items.length){const t=[];let e=!1,s=0;for(let o=0;o<i.items.length;o++)if("Files"==i.types[o]){let e=i.items[o].getAsFile();e&&(t[s]=g(e),s++)}else"text/plain"==i.types[o]&&h.pastedUrl&&(e=!0,i.items[o].getAsString(function(t){(t=t.trim()).length>5e3||t.length<=4||t.indexOf("\n")>=0||t.indexOf("\r")>=0||t.indexOf(" ")>=0||t.indexOf(".")<0?m():h.pastedUrl(t)}));s>0?d(t,"Pasted",o.Pasted):e||m()}else m();a&&(a=!1,h.monitor_paste.$().blur()),e.preventDefault()}),h.focusPasteOnCtrlV&&$(window).on("keydown"+e,t=>{if((t.ctrlKey||t.metaKey)&&86==t.keyCode){const t=$(document.activeElement);t.is("input")||t.is("textarea")||t.attr("contenteditable")||(h.monitor_paste.$().focus(),a=!0)}})),{disable:c}};try{XMLHttpRequest.prototype.hasOwnProperty("sendAsBinary")||h.set(XMLHttpRequest.prototype,"sendAsBinary",function(t){var e=Array.prototype.map.call(t,function(t){return 255&t.charCodeAt(0)}),i=new Uint8Array(e);this.send(i.buffer)})}catch(t){}}(y||(y={})),function(t){var e=/%([0-9A-Fa-f]{2})/g,i=/[^\x20-\x7e\xa0-\xff]/g,s=/\\([\u0000-\u007f])/g,o=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,r=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+\-\.^_`|~])+)$/,n=/^([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *(?:$|;)/;function a(t){var s=r.exec(t);if(!s)throw new TypeError("invalid extended field value");var o,n=s[1].toLowerCase(),a=s[2].replace(e,h);switch(n){case"iso-8859-1":o=String(a).replace(i,"?");break;case"utf-8":o=decodeURIComponent(escape(a));break;default:throw new TypeError("unsupported charset in extended field")}return o}function h(t,e){return String.fromCharCode(parseInt(e,16))}t.parse=function(t){if(t&&"string"==typeof t){var e=n.exec(t);if(e){var i,r,h=e[0].length,l=(e[1].toLowerCase(),[]),c={};try{for(h=o.lastIndex=";"===e[0].substr(-1)?h-1:h;e=o.exec(t);){if(e.index!==h)throw new TypeError("invalid parameter format");if(h+=e[0].length,i=e[1].toLowerCase(),r=e[2],-1!==l.indexOf(i))throw new TypeError("invalid duplicate parameter");l.push(i),i.indexOf("*")+1!==i.length?"string"!=typeof c[i]&&('"'===r[0]&&(r=r.substr(1,r.length-2).replace(s,"$1")),c[i]=r):(i=i.slice(0,-1),r=a(r),c[i]=r)}if(-1!==h&&h!==t.length)throw new TypeError("invalid parameter format")}catch(t){}return c.filename}}}}(S||(S={})),function(t){const e={url:"",progress:F.empty,error:F.empty,success:F.empty,withCredentials:!1,contentType:null};function i(t,e){return F.blobToFile(t,e||"FetchedFromUrl_"+Date.now())}t.download=function(t){let s=$.extend({},e,t),o=F.dataUrlToBlob(s.url)||F.dataUrlToBlob(s.displayUrl);if(o)setTimeout(function(){s.success(i(o))},0);else{let t=new XMLHttpRequest,e=0;s.progress!=F.empty&&(t.onprogress=t=>{if(t.lengthComputable){let i=Math.round(100*t.loaded/t.total);e!==i&&(e=i,s.progress(e))}}),t.onerror=e=>{s.error(F.formatXhrError(t,void 0))},t.onabort=e=>{s.error(F.formatXhrError(t,"abort"))},t.withCredentials=!!s.withCredentials,t.onload=e=>{if(t.response)if(t.status<200||t.status>299){let e=String.fromCharCode.apply(null,new Uint8Array(t.response));s.error(u.s('Failed to fetch "{0}"',s.displayUrl||s.url)+"\n"+e)}else{let e=s.contentType||t.getResponseHeader("Content-Type"),o=S.parse(t.getResponseHeader("Content-Disposition")),r=t.response,n=i(new Blob([r],{type:e}),o);s.success(n)}},t.open("GET",s.url,!0),t.responseType="arraybuffer",t.send()}}}(A||(A={})),function(t){t.initialize=function(t,e){t.$().click(function(){let t=prompt(u.s("Please enter the image URL to upload:"));return t&&(t=t.trim(),t.length>4&&e(t)),!1})}}(P||(P={})),function(t){var e;e=()=>{window.addEventListener("message",t=>{if(t.data)if("ping"==t.data)t.source.postMessage("pong","*");else if("pong"==t.data)for(let e=0;e<a.length;e++)a[e].checkPong(t)&&(a.splice(e,1),e--);else if(t.data.file||t.data.blob){let e=t.data.file||t.data.blob;i?r(e):s.push(e)}},!1)},"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e);let i,s=[],o=!1;function r(t){o&&window.hasOwnProperty("chrome")?t.arrayBuffer().then(e=>{i(new File([e],t.name,{type:t.type,lastModified:t.lastModified}))}).catch(t=>{}):i(t)}t.setFileReceiver=function(t,e=!1){o=e,i=t,setTimeout(()=>{for(let t of s)r(t);s=[]},1)};class n{constructor(t,e){this.connected=!1,this.onOpens=[],this.targetWindow=window.open(t,e),this.targetWindow.postMessage("ping","*"),this.pingIntervalId=setInterval(()=>{this.targetWindow.postMessage("ping","*")},30)}onOpen(t){return this.connected?t():this.onOpens.push(t),this}checkPong(t){if(t.source==this.targetWindow){clearInterval(this.pingIntervalId),this.connected=!0;for(let t of this.onOpens)t();return this.onOpens=[],!0}return!1}}let a=[],h={};function l(t,e,i,s){let o=e?h[e]:null;o&&!o.targetWindow.closed||(o=function(t,e){let i=new n(t,e);return a.push(i),e&&(h[e]=i),i}(t,e)),o.onOpen(function(){setTimeout(()=>{(s?o.targetWindow:window).focus(),o.targetWindow.postMessage({file:i},"*")},1)})}t.sendFile=l,t.sendFileToRecompressor=function(t,e){l("https://recompressor.com","recompressor",t,e)},t.sendFileToVectorMagic=function(t,e){l("https://vectormagic.com",null,t,e)},t.sendFileToVectorizer=function(t,e){l("https://vectorizer.ai",null,t,e)},t.sendFileToPixianFaceSticker=function(t,e){l("https://pixian.ai/face-stickers","pixian-face-stickers",t,e)},t.sendFileToPixianBg=function(t,e){l("https://pixian.ai","pixian",t,e)},t.sendFileToClippingMagic=function(t,e){l("https://clippingmagic.com",null,t,e)},t.sendFileToPixspy=function(t,e){l("https://pixspy.com","pixspy",t,e)}}(M||(M={})),function(t){t[t.fill_shapes=0]="fill_shapes",t[t.stroke_shapes=1]="stroke_shapes",t[t.stroke_edges=2]="stroke_edges"}(k||(k={})),function(t){t.MaxTries=1,t.BytesPerChunk=14848,t.NumPuntsWhenWorkersBusy=3,t.MaxBytesPerImage=31457280,t.MaxMaxNumPixels=3145828,t.MaxMaxNumMegapixels=3,t.BrowserChromeUrl="https://www.google.com/chrome/",t.BrowserFirefoxUrl="https://www.mozilla.org/en-US/firefox/new/",t.BrowserSafariUrl="https://www.apple.com/safari/",t.BrowserMicrosoftEdgeUrl="https://www.microsoft.com/en-us/edge",t.EnableVectorInterfaceEncoding=!0,t.ClientVersion=0}(L||(L={})),function(t){t.list=function(){var t=[];function e(e,i){e||t.push(i)}function i(t,i){try{e(t(),i)}catch(t){e(!1,i)}}return i(function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},"HTML5 Canvas"),e("undefined"!=typeof WebSocket,"WebSockets"),i(function(){var t=document.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},"HTML5 Drag-and-Drop"),e("undefined"!=typeof URL,"window.URL Support"),e("undefined"!=typeof XMLHttpRequest,"XML Http Requests"),i(function(){return"undefined"!=typeof Uint32Array&&"undefined"!=typeof Uint8Array&&void 0!==new Uint8Array(2).set},"Native Type Arrays"),i(function(){var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d").getImageData(0,0,1,1).data;return new Int32Array(e.buffer).length>0},"ImageData.data is not a Uint8ClampedArray"),e(!(!window.history||!window.history.pushState),"HTML5 History"),e("undefined"!=typeof Worker,"Web Workers"),e(!!Date.now,"Date.now()"),i(function(){return!!new Blob},"Blob and/or Blob Constructor"),i(function(){return!!Blob.prototype.arrayBuffer},"Blob.arrayBuffer()"),i(function(){return!!new Path2D},"Path2D and/or Path2D Constructor"),i(function(){return!!window.PointerEvent},"PointerEvent"),t.sort(),t}}(E||(E={})),function(t){t[t.Trying=0]="Trying",t[t.Success=1]="Success",t[t.FailureSilent=2]="FailureSilent",t[t.FailureShown=3]="FailureShown",t[t.Stopped=4]="Stopped"}(R||(R={}));class lt{constructor(t){this.opts=t,this.tries=0,this.triesEver=0,this.lastErrorMessage="",this.isTrying=!1,this.state=R.Trying,this.timeout=0,this.executionStopped=()=>{this.state=R.Stopped,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",T.deregister(this)},this.executionSuccess=()=>{this.state=R.Success,this.isTrying=!1,this.tries=0,this.lastErrorMessage="",this.opts.success(),T.deregister(this)},this.executionError=t=>{this.isTrying=!1,this.lastErrorMessage=t.substr(0,200),this.tries<this.opts.numberOfSilentRetriesBeforeShowingErrorToUser?(this.state=R.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,this.opts.millisBetweenSilentRetries)):this.opts.giveUpAfterSilentRetries?this.state=R.FailureSilent:(this.state=R.FailureShown,T.register(this))},this.executionPunt=()=>{this.isTrying=!1,this.state=R.FailureSilent,this.clearTimeout(),this.timeout=setTimeout(this.tryExecute,100)},this.tryExecute=()=>{if(this.clearTimeout(),!this.isTrying){this.state=R.Trying,this.isTrying=!0,this.tries+=1,this.triesEver+=1;try{this.opts.execute(this.executionSuccess,this.executionError)}catch(t){this.tries=Math.max(this.tries,this.opts.numberOfSilentRetriesBeforeShowingErrorToUser),setTimeout(()=>{this.executionError(t.toString())},0)}return!0}return!1}}start(){return this.tryExecute(),this}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=0)}makeHtmlRow(){let t=$(document.createElement("tr"));return t.append(F.makeElement("td",this.opts.label)),t.append(F.makeElement("td",this.lastErrorMessage)),t}toString(){return`RetryInstance(${this.opts.label}, tries: ${this.tries} (${this.triesEver}), err: '${this.lastErrorMessage}', isTrying: ${this.isTrying}, state: ${R[this.state]})`}}!function(t){setTimeout(function(){0},0);var e=[],i=5e3,s=36e5,o=null,r=0,a=i,h=!1;function l(){const t=n.RetryDialog.Body.$();t.empty();const i=$(document.createElement("thead")),s=$(document.createElement("tbody")),o=$(document.createElement("tr"));o.append(F.makeElement("th",u.s("Task"))),o.append(F.makeElement("th",u.s("Error"))),i.append(o),t.append(i),t.append(s);for(var r=0;r<e.length;r++)s.append(e[r].makeHtmlRow())}function c(){r=Date.now(),null!=o&&(clearInterval(o),o=null),(a*=2)>s&&(a=s),n.RetryDialog.Countdown.$().text(u.s("Retrying now..."));for(var t=0;t<e.length;t++)e[t].tryExecute()}function d(){var t=Date.now(),e=Math.round((r+a-t)/1e3);e<=0?c():n.RetryDialog.Countdown.$().text(u.s("Retrying in {0} {0,plural,one{second}other{seconds}}...",e)),l()}t.register=function(t){e.indexOf(t)<0&&(F.gaTrack("ErrorShown",t.opts.label,t.lastErrorMessage,null),e.push(t),l()),F.modal(n.RetryDialog.Dialog.css()),h=!0,null==o&&(r=Date.now(),o=setInterval(d,1e3))},t.deregister=function(t){var s=e.indexOf(t);s>=0&&(e.splice(s,1),l()),a=i,r=Date.now(),0==e.length&&h&&n.RetryDialog.Dialog.$().modal("hide")},$(()=>{n.RetryDialog.RetryNowButton.$().click(()=>{c(),a=i})})}(T||(T={})),function(t){t[t.Disconnected=0]="Disconnected",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected",t[t.Error=3]="Error"}(I||(I={}));class ct{constructor(t){this.state=I.Disconnected,this.websocket=null,this.arraybuffer=null,this.hasReceivedMessage=!1,this.closeReason=null,this.lastDebugUrl="unknown",this.opts=$.extend({numberOfSilentRetriesBeforeShowingErrorToUser:3,millisBetweenSilentRetries:1e3},t),this.eventHandlers={open:t=>{this.onOpen()},close:t=>{this.onClose(t)},message:t=>{this.onMessage(t)},heartbeater:()=>{this.opts.heartbeat&&null!=this.websocket&&this.websocket.readyState==WebSocket.OPEN&&this.doSend(this.opts.heartbeat.message)}},this.retryable=new lt({label:this.opts.label,execute:(t,e)=>{this.clearWebSocket(I.Connecting),this.hasReceivedMessage=!1,this.closeReason=null;let i=this.opts.url();this.lastDebugUrl=i.split("?")[0],this.websocket=new WebSocket(i),this.websocket.binaryType="arraybuffer",this.websocket.addEventListener("open",this.eventHandlers.open),this.websocket.addEventListener("close",this.eventHandlers.close),this.websocket.addEventListener("message",this.eventHandlers.message)},success:()=>{this.opts.connectedToNewServer()},numberOfSilentRetriesBeforeShowingErrorToUser:this.opts.numberOfSilentRetriesBeforeShowingErrorToUser,millisBetweenSilentRetries:this.opts.millisBetweenSilentRetries}).start()}clearWebSocket(t){this.state=t,null!=this.websocket&&(this.websocket.removeEventListener("open",this.eventHandlers.open),this.websocket.removeEventListener("close",this.eventHandlers.close),this.websocket.removeEventListener("message",this.eventHandlers.message),this.websocket.close(),this.websocket=null),this.arraybuffer=null,this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=void 0)}onOpen(){F.gaTrack("WebSocket",this.lastDebugUrl,"connected",1),this.opts.heartbeat&&this.opts.heartbeat.millis>0&&(this.heartbeatTimer=setInterval(this.eventHandlers.heartbeater,this.opts.heartbeat.millis)),this.opts.sendOnOpen?this.doSend(this.opts.sendOnOpen):this.eventHandlers.heartbeater()}onClose(t){this.clearWebSocket(I.Disconnected);let e=t.reason;if(this.closeReason&&!e&&(e=this.closeReason.code.toString()),e){if(this.opts.puntOnCloseReason&&this.opts.puntOnCloseReason(e))return void this.retryable.executionPunt();{let t=this.opts.closeReasonToMessage(e);if(t)return this.onError(t)}}else if(!this.hasReceivedMessage)return this.onError(this.opts.unableToConnectMessage);this.opts.disconnectedFromServer()?this.onError(this.opts.unexpectedCloseMessage):this.retryable.executionStopped()}onError(t){F.gaTrack("WebSocket",this.lastDebugUrl,"error: "+t,0),this.opts.customOnError&&!this.opts.customOnError(t)||this.retryable.executionError(t)}onMessage(t){if("string"==typeof t.data){const e=JSON.parse(t.data);if(e.closeReason)return this.closeReason=e.closeReason,void this.websocket.close();!this.hasReceivedMessage&&this.doSend(this.opts.heartbeat.message)&&(this.hasReceivedMessage=!0,this.state=I.Connected,this.retryable.executionSuccess()),null!=this.arraybuffer&&(e.arraybuffer=this.arraybuffer,this.arraybuffer=null),this.opts.newMessageFromServer(e)}else this.arraybuffer=t.data}doSend(t,e=!1){try{let i=e?t:JSON.stringify(t);return this.websocket.send(i),!0}catch(t){return this.clearWebSocket(I.Error),this.onError(this.opts.sendFailedMessage+"Error: "+t),!1}}send0(t,e){return null==this.websocket||this.websocket.readyState!=WebSocket.OPEN?(null==this.websocket&&this.retryable.tryExecute(),!1):this.doSend(t,e)}send(t){return this.send0(t,!1)}sendBinary(t){return this.send0(t,!0)}getState(){return this.state}forceClose(){this.clearWebSocket(I.Disconnected)}}!function(t){function e(e){n.FatalError.Message.$().text(e),t.modal(n.FatalError.Dialog),t.gaTrack("ErrorShown","Fatal",e)}t.countInstances=function(t,e){const i=e.charCodeAt(0);for(var s=0,o=0;o<t.length;o++)t.charCodeAt(o)==i&&s++;return s},t.whilePressing=function(t,e,i){function s(){window.removeEventListener("touchend",s),window.removeEventListener("mouseup",s),i()}function o(){window.addEventListener("touchend",s),window.addEventListener("mouseup",s),e()}t.$().each(function(t,e){e.addEventListener("touchstart",o),e.addEventListener("mousedown",o)})},t.radioButton=function(t,e,i){let s=t.$();s.click(t=>{t.preventDefault(),t.stopPropagation(),!s.hasClass(r.active.name())?e():i()})},t.blurActiveElement=function(){document.activeElement instanceof HTMLElement?document.activeElement.blur():window.focus()},t.progressBar=function(t,e){let i=0<e&&e<100;e<0?e=0:e>100&&(e=100),t.Bar.$().css({width:e+"%"}).toggleClass("active",i)},t.fatalError=function(i){e(t.stringify(i))},t.fatalErrorStr=e,t.progress=function(e){e?t.modal(n.App.ProgressLightbox):n.App.ProgressLightbox.$().modal("hide")},t.progressUpdate=function(t){n.App.ProgressLightboxBar.Bar.$().attr("style","width:"+t+"%")}}(F||(F={})),function(t){t.getWorkerUrl=function(t,e){let i=("http:"==location.protocol?"ws:":"wss:")+"//"+location.host+t+"?"+window.GlobalsEx.LocaleParameter;for(let t in e)e.hasOwnProperty(t)&&(i+="&"+t+"="+encodeURIComponent(e[t]));return i},t.getFeedbackUrl=function(t,e){return`/images/${t}/feedback?message=${encodeURIComponent(e)}`}}(O||(O={}));class ut{constructor(t,e){this.arraybuffer=t,this.littleEndian=e,this.dataview=new DataView(t),this.offset=0}current(){return this.offset}reset(){this.offset=0}seek(t){this.offset=t}byteLength(){return this.arraybuffer.byteLength}hasMore(t=1){return this.offset+t<=this.byteLength()}skip(t){this.offset+=t}debug(t){return t}advance(t){let e=this.offset;return this.offset+=t,e}nonEmpty(){return this.byteLength()>0}readBoolean(){return 0!=this.readInt8()}readInt8(){return this.debug(this.dataview.getInt8(this.advance(1)))}readUint8(){return this.debug(this.dataview.getUint8(this.advance(1)))}readInt16(){return this.debug(this.dataview.getInt16(this.advance(2),this.littleEndian))}readUint16(){return this.debug(this.dataview.getUint16(this.advance(2),this.littleEndian))}readInt32(){return this.debug(this.dataview.getInt32(this.advance(4),this.littleEndian))}readUint32(){return this.debug(this.dataview.getUint32(this.advance(4),this.littleEndian))}readFloat32(){return this.debug(this.dataview.getFloat32(this.advance(4),this.littleEndian))}readFloat64(){return this.debug(this.dataview.getFloat64(this.advance(8),this.littleEndian))}}!function(t){const e=1e-6,i=[];t.solve=function(t,s,o){if(Math.abs(t)<e)return Math.abs(s)<e?i:[-o/s];{let r=s*s-4*t*o;return r>e?[(-s+Math.sqrt(r))/(2*t),(-s-Math.sqrt(r))/(2*t)]:r<-1e-6?i:[-s/(2*t)]}}}(_||(_={})),function(t){function e(t,e){return(t%e+e)%e}function i(t,e){return(t%e-e)%e}t.TwoPi=2*Math.PI,t.Rad90=Math.PI/2,t.Rad180=Math.PI,t.Rad270=3*Math.PI/2,t.posMod=e,t.negMod=i,t.posRelMod=function(t,i,s){return e(t-i,s)+i},t.negRelMod=function(t,e,s){return i(t-e,s)+e},t.minMod=function(t,s){var o=e(t,s),r=i(t,s);return Math.abs(o)<=Math.abs(r)?o:r}}(D||(D={}));class dt{constructor(t,e,i=new Float64Array(0),s=0,o,r,n){void 0!==n?this.setState(t,e,i,s,n?1:e,n?t:1):this.setState(t,e,i,s,o,r)}static create(t,e,i=!0){return new dt(t,e,new Float64Array(t*e),0,void 0,void 0,i)}static createFromData(t,e,i,s=0,o,r){return new dt(t,e,i,s,o,r)}setState(t,e,i,s,o,r){if(this.k00=s,this.numRows=t,this.numCols=e,this.data=i,this.strideR=o,this.strideC=r,dt.PerformCompatibilityChecks&&i.length<this.size())throw new Error(`Data length (${i.length}) not sufficient for matrix size: ${t}${e} = ${this.size()}`)}dup(){const t=new Float64Array(this.size());if(this.isContiguous())t.set(this.data.subarray(this.k00,this.k00+t.length));else{let e=0;this.forEachRck((i,s,o)=>t[e++]=this.getFlat(o))}return new dt(this.numRows,this.numCols,t,0,this.strideR,this.strideC)}dupSize(){return new dt(this.numRows,this.numCols,new Float64Array(this.numRows*this.numCols),0,this.strideR,this.strideC)}static makeProductSized(t,e){const i=t.isColMajor();return new dt(t.numRows,e.numCols,new Float64Array(t.numRows*e.numCols),0,void 0,void 0,i)}getNumRows(){return this.numRows}getNumCols(){return this.numCols}size(){return this.numRows*this.numCols}isEmpty(){return 0===this.size()}nonEmpty(){return this.size()>0}isInBounds(t,e){return t>=0&&t<this.numRows&&e>=0&&e<this.numCols}notInBounds(t,e){return!this.isInBounds(t,e)}indexOf(t,e){return dt.PerformBoundsChecks&&this.checkBounds(t,e),this.k00+t*this.strideR+e*this.strideC}isSquare(){return this.numRows===this.numCols}notSquare(){return!this.isSquare()}hasSameSize(t){return this.numRows===t.numRows&&this.numCols===t.numCols}isProductCompatibleWith(t,e){return this.numRows===t.numRows&&this.numCols===e.numCols&&t.numCols===e.numRows}isColMajor(){return this.strideR<this.strideC}isRowMajor(){return!this.isColMajor()}minDim(){return Math.min(this.numRows,this.numCols)}maxDim(){return Math.max(this.numRows,this.numCols)}kMax(){return this.k00+(this.numRows-1)*this.strideR+(this.numCols-1)*this.strideC}isTight(){return this.size()===this.data.length}isContiguous(){return this.isColMajor()?1===this.strideR&&this.strideC===this.numRows:1===this.strideC&&this.strideR===this.numCols}forEachRck(t){if(this.isColMajor())for(let e=0;e<this.numCols;e++)for(let i=0,s=this.indexOf(i,e);i<this.numRows;i++,s+=this.strideR)t(i,e,s);else for(let e=0;e<this.numRows;e++)for(let i=0,s=this.indexOf(e,i);i<this.numCols;i++,s+=this.strideC)t(e,i,s)}forEachKkk(t,e,i){if(this.isColMajor())for(let s=0;s<this.numCols;s++)for(let o=0,r=this.indexOf(o,s),n=t.indexOf(o,s),a=e.indexOf(o,s);o<this.numRows;o++,r+=this.strideR,n+=t.strideR,a+=e.strideR)i(r,n,a);else for(let s=0;s<this.numRows;s++)for(let o=0,r=this.indexOf(s,o),n=t.indexOf(s,o),a=e.indexOf(s,o);o<this.numCols;o++,r+=this.strideC,n+=t.strideC,a+=e.strideC)i(r,n,a)}forEachKk(t,e){if(this.isColMajor())for(let i=0;i<this.numCols;i++)for(let s=0,o=this.indexOf(s,i),r=t.indexOf(s,i);s<this.numRows;s++,o+=this.strideR,r+=t.strideR)e(o,r);else for(let i=0;i<this.numRows;i++)for(let s=0,o=this.indexOf(i,s),r=t.indexOf(i,s);s<this.numCols;s++,o+=this.strideC,r+=t.strideC)e(o,r)}plusEqualsElem(t,e,i){this.data[this.indexOf(t,e)]+=i}set(t,e,i){this.data[this.indexOf(t,e)]=i}setFlat(t,e){dt.PerformBoundsChecks&&this.checkBoundsFlat(t),this.data[t]=e}setVector(t,e){dt.PerformBoundsChecks&&this.checkIsVectorOfAtLeastSize(t),1===this.numRows?this.set(0,t,e):this.set(t,0,e)}get(t,e){return this.data[this.indexOf(t,e)]}getVector(t){return dt.PerformBoundsChecks&&this.checkIsVectorOfAtLeastSize(t),1===this.numRows?this.get(0,t):this.get(t,0)}getFlat(t){return dt.PerformBoundsChecks&&this.checkBoundsFlat(t),this.data[t]}flattenTo(t){if(dt.PerformBoundsChecks&&t.length<this.size())throw new Error(`Data length (${t.length}) not sufficient for matrix size: ${this.numRows}${this.numCols} = ${this.size()}`);let e=0;this.forEachRck((i,s,o)=>t[e++]=this.getFlat(o))}viewRect(t,e,i,s,o=new dt(0,0)){if(dt.PerformBoundsChecks&&(t<0||t+i>this.numRows||e<0||e+s>this.numCols))throw new Error(`View rectangle out of bounds: r: ${t}, c: ${e}, numRows: ${i}, numCols: ${s} vs. this.numRows: ${this.numRows}, this.numCols: ${this.numCols}`);return o.setState(i,s,this.data,this.indexOf(t,e),this.strideR,this.strideC),o}viewRow(t,e=new dt(0,0)){return this.viewRect(t,0,1,this.numCols,e)}viewCol(t,e=new dt(0,0)){return this.viewRect(0,t,this.numRows,1,e)}viewDiag(t=new dt(0,0)){const e=this.minDim();return t.setState(e,1,this.data,this.k00,this.strideR+this.strideC,0),t}viewRowsArray(){const t=new Array(this.numRows);for(let e=0;e<this.numRows;e++)t[e]=this.viewRow(e);return t}viewColsArray(){const t=new Array(this.numCols);for(let e=0;e<this.numCols;e++)t[e]=this.viewCol(e);return t}flatten(t=this.isColMajor()){const e=new Float64Array(this.size()),i=t?1:this.numCols,s=t?this.numRows:1;return this.forEachRck((t,o,r)=>e[t*i+o*s]=this.getFlat(r)),this.setState(this.numRows,this.numCols,e,0,t?1:this.numCols,t?this.numRows:1),this}fill(t){return this.isContiguous()?this.data.fill(t,0,this.size()):this.forEachRck((e,i,s)=>this.data[s]=t),this}clear(){return this.fill(0)}setDiag(t){this.clear();for(let e=0,i=this.minDim();e<i;e++)this.set(e,e,t);return this}clearOffDiag(){return this.forEachRck((t,e,i)=>{t!==e&&this.setFlat(i,0)}),this}setFlatValues(t){this.forEachRck((e,i,s)=>{s<t.length&&this.setFlat(s,t[s])})}setMatrix(t){return dt.PerformCompatibilityChecks&&this.checkSameSize(t),this.forEachKk(t,(e,i)=>this.setFlat(e,t.getFlat(i))),this}setSum(t,e){return dt.PerformCompatibilityChecks&&(this.checkSameSize(t),this.checkSameSize(e)),this.forEachKkk(t,e,(i,s,o)=>this.data[i]=t.data[s]+e.data[o]),this}setDiff(t,e){return dt.PerformCompatibilityChecks&&(this.checkSameSize(t),this.checkSameSize(e)),this.forEachKkk(t,e,(i,s,o)=>this.data[i]=t.data[s]-e.data[o]),this}setCombination(t,e,i,s){return dt.PerformCompatibilityChecks&&(this.checkSameSize(e),this.checkSameSize(s)),this.forEachKkk(e,s,(o,r,n)=>this.data[o]=t*e.data[r]+i*s.data[n]),this}normSqrFrobenius(){if(this.isContiguous()){let t=0;for(let e=this.k00,i=this.k00+this.size();e<i;e++)t+=this.data[e]*this.data[e];return t}{let t=0;return this.forEachRck((e,i,s)=>t+=this.data[s]*this.data[s]),t}}normFrobenius(){return Math.sqrt(this.normSqrFrobenius())}notFinite(){if(this.isContiguous()){for(let t=this.k00,e=this.k00+this.size();t<e;t++)if(!Number.isFinite(this.data[t]))return!0;return!1}{let t=!1;return this.forEachRck((e,i,s)=>{Number.isFinite(this.data[s])||(t=!0)}),t}}isFinite(){return!this.notFinite()}max(){if(this.isContiguous()){let t=Number.NEGATIVE_INFINITY;for(let e=this.k00,i=this.k00+this.size();e<i;e++)t=Math.max(t,this.getFlat(e));return t}{let t=Number.NEGATIVE_INFINITY;return this.forEachRck((e,i,s)=>t=Math.max(t,this.getFlat(s))),t}}sum(){if(this.isContiguous()){let t=0;for(let e=this.k00,i=this.k00+this.size();e<i;e++)t+=this.getFlat(e);return t}{let t=0;return this.forEachRck((e,i,s)=>t+=this.getFlat(s)),t}}mean(){return this.sum()/this.size()}dot(t){if(dt.PerformCompatibilityChecks&&(1!=this.minDim()||1!=t.minDim()||this.size()!=t.size()))throw new Error(`Dot product requires two vectors of the same size: ${this.toShapeString()} and ${t.toShapeString()}`);let e=0;if(this.isContiguous()&&t.isContiguous())for(let i=this.k00,s=t.k00,o=this.k00+this.size();i<o;i++,s++)e+=this.data[i]*t.data[s];else this.forEachKk(t,(i,s)=>e+=this.data[i]*t.data[s]);return e}transposed(){return new dt(this.numCols,this.numRows,this.data,this.k00,this.strideC,this.strideR)}times(t){return dt.makeProductSized(this,t).setProduct(this,t)}plus(t){return this.dupSize().setSum(this,t)}plusScaled(t,e){return this.dupSize().setCombination(1,this,e,t)}minus(t){return this.dupSize().setDiff(this,t)}clampEquals(t,e){if(this.isContiguous())for(let i=this.k00,s=this.k00+this.size();i<s;i++)this.setFlat(i,Math.min(e,Math.max(t,this.getFlat(i))));else this.forEachRck((i,s,o)=>this.setFlat(o,Math.min(e,Math.max(t,this.getFlat(o)))));return this}absEquals(){if(this.isContiguous())for(let t=this.k00,e=this.k00+this.size();t<e;t++)this.setFlat(t,Math.abs(this.getFlat(t)));else this.forEachRck((t,e,i)=>this.setFlat(i,Math.abs(this.getFlat(i))));return this}timesEquals(t){if(this.isContiguous())for(let e=this.k00,i=this.k00+this.size();e<i;e++)this.setFlat(e,t*this.getFlat(e));else this.forEachRck((e,i,s)=>this.setFlat(s,t*this.getFlat(s)));return this}static productRc(t,e,i,s){let o=0;for(let r=0,n=t.indexOf(i,0),a=e.indexOf(0,s);r<t.numCols;r++,n+=t.strideC,a+=e.strideR)o+=t.getFlat(n)*e.getFlat(a);return o}setProduct(t,e){return dt.PerformCompatibilityChecks&&this.checkProductCompatible(t,e),this.forEachRck((i,s,o)=>this.setFlat(o,dt.productRc(t,e,i,s))),this}setProductScaled(t,e,i){return dt.PerformCompatibilityChecks&&this.checkProductCompatible(t,e),this.forEachRck((s,o,r)=>this.setFlat(r,i*dt.productRc(t,e,s,o))),this}plusEquals(t){return this.setSum(this,t)}minusEquals(t){return this.setDiff(this,t)}plusEqualsScaled(t,e){return this.setCombination(1,this,e,t)}plusEqualsProduct(t,e){return dt.PerformCompatibilityChecks&&this.checkProductCompatible(t,e),this.forEachRck((i,s,o)=>this.data[o]+=dt.productRc(t,e,i,s)),this}plusEqualsProductScaled(t,e,i){return dt.PerformCompatibilityChecks&&this.checkProductCompatible(t,e),this.forEachRck((s,o,r)=>this.data[r]+=i*dt.productRc(t,e,s,o)),this}choleskyDecomp(){if(dt.PerformCompatibilityChecks&&(this.checkIsSquare(),!this.isColMajor()))throw new Error("Cholesky decomposition requires column-major matrix");for(let t=0;t<this.numRows;t++){for(let e=0;e<t;e++){for(let i=0;i<e;i++)this.data[t+e*this.numRows]-=this.data[t+i*this.numRows]*this.data[e+i*this.numRows];this.data[t+e*this.numRows]/=this.data[e+e*this.numRows]}for(let e=0;e<t;e++)this.data[t+t*this.numRows]-=this.data[t+e*this.numRows]*this.data[t+e*this.numRows];if(this.data[t+t*this.numRows]<=0)return!0;this.data[t+t*this.numRows]=Math.sqrt(this.data[t+t*this.numRows])}return!1}choleskySolve(t){if(dt.PerformCompatibilityChecks&&(this.checkIsSquare(),this.checkSameNumRows(t),!this.isColMajor()))throw new Error("Cholesky solve requires column-major matrix");for(let e=0;e<t.numCols;e++){const i=e*this.numRows;for(let e=0;e<this.numRows;e++){let s=t.data[i+e];for(let o=e-1;o>=0;o--)s-=this.data[e+o*this.numRows]*t.data[i+o];t.data[i+e]=s/this.data[e+e*this.numRows]}for(let e=this.numRows-1;e>=0;e--){let s=t.data[i+e];for(let o=e+1;o<this.numRows;o++)s-=this.data[o+e*this.numRows]*t.data[i+o];t.data[i+e]=s/this.data[e+e*this.numRows]}}}toString(){const t=[];t.push(this.toShapeString()+":\n");for(let e=0;e<this.numRows;e++){0===e?t.push(""):e<this.numRows-1?t.push(""):t.push("");for(let i=0;i<this.numCols;i++)t.push(pt(String(this.get(e,i).toFixed(4)),7)),i!==this.numCols-1&&t.push(", ");0===e?t.push("\n"):e<this.numRows-1?t.push("\n"):t.push("")}return t.push("\n"),t.join("")}toShapeString(){return`${this.isColMajor()?"C":"R"}[${this.numRows}${this.numCols}]`}toOneLineString(){const t=[];for(let e=0;e<this.numRows;e++)for(let i=0;i<this.numCols;i++)t.push(String(this.get(e,i))),e===this.numRows-1&&i===this.numCols-1||t.push(", ");return t.join("")}toOneLineStringWithPrecision(t){const e=`%.${t}f`,i=[];for(let t=0;t<this.numRows;t++)for(let s=0;s<this.numCols;s++)i.push(e.replace("%",String(this.get(t,s)))),t===this.numRows-1&&s===this.numCols-1||i.push(", ");return i.join("")}prettyPrint(t){}checkIsSquare(){if(!this.isSquare())throw new Error(`Matrix is not square: ${this.toShapeString()}`)}checkSameNumRows(t){if(this.numRows!==t.numRows)throw new Error(`Matrix rows do not match: this.rows: ${this.numRows}, other.rows: ${t.numRows}`)}checkSameSize(t){if(!this.hasSameSize(t))throw new Error(`Matrix dimensions do not match: this.shape: ${this.toShapeString()}, other.shape: ${t.toShapeString()}`)}checkProductCompatible(t,e){if(!this.isProductCompatibleWith(t,e))throw new Error(`Matrix dimensions do not match for multiplication this = A * B: this.shape: ${this.toShapeString()}, A.shape: ${t.toShapeString()}, B.shape: ${e.toShapeString()}`);if(this===t||this===e)throw new Error("Cannot set product to self")}checkBounds(t,e){if(this.notInBounds(t,e))throw new Error(`Index out of bounds: r: ${t}, c: ${e}, #rows: ${this.numRows}, #cols: ${this.numCols}`)}checkBoundsFlat(t){if(t<this.k00||t>this.kMax())throw new Error(`Index out of bounds: k: ${t}, k00: ${this.k00}, kmax: ${this.kMax()}`)}checkIsVectorOfAtLeastSize(t){if(this.minDim()>1)throw new Error(`Matrix is not a vector: ${this.toShapeString()}`);if(t<0||t>=this.maxDim())throw new Error(`Index out of bounds: ${t} vs. ${this.maxDim()}`)}}function pt(t,e,i=" "){return e|=0,t.length>e?String(t):((e-=t.length)>i.length&&(i+=i.repeat(e/i.length)),i.slice(0,e)+String(t))}dt.PerformCompatibilityChecks=!0,dt.PerformBoundsChecks=!0,dt.EmptyData=new Float64Array(0);class mt{static clamp(t,e,i){return Math.max(e,Math.min(i,t))}constructor(t=0,e=0,i=0,s=0){this.r=t,this.g=e,this.b=i,this.a=s}dup(){return new mt(this.r,this.g,this.b,this.a)}equals(t){return this.r==t.r&&this.g==t.g&&this.b==t.b&&this.a==t.a}normSqr(){return this.r*this.r+this.g*this.g+this.b*this.b+this.a*this.a}norm(){return Math.sqrt(this.normSqr())}normManhattan(){return Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b)+Math.abs(this.a)}normalize(){let t=this.norm();return t>0?this.setArgb(this.a/t,this.r/t,this.g/t,this.b/t):this}setA(t){return this.a=t,this}setR(t){return this.r=t,this}setG(t){return this.g=t,this}setB(t){return this.b=t,this}setArgb(t,e,i,s){return this.r=e,this.g=i,this.b=s,this.a=t,this}setHex(t){return 3==(t=t.replace(/^#/,"")).length?t="ff"+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:6==t.length&&(t="ff"+t),this.setArgbInt(parseInt(t,16))}setRgba(t,e,i,s=1){return this.setArgb(s,t,e,i)}setArgbInt(t){return this.setArgb((t>>24&255)/255,(t>>16&255)/255,(t>>8&255)/255,(255&t)/255)}setFrom(t){return this.setArgb(t.a,t.r,t.g,t.b)}setDiff(t,e){return this.setArgb(t.a-e.a,t.r-e.r,t.g-e.g,t.b-e.b)}setToSecondDerivative(t,e,i){return this.setArgb(t.a-2*e.a+i.a,t.r-2*e.r+i.r,t.g-2*e.g+i.g,t.b-2*e.b+i.b)}setToInverted(t=this){return this.setArgb(1-t.a,1-t.r,1-t.g,1-t.b)}setToAlphaComposition(t,e){let i=t.a,s=1-i;return this.setArgb(i+e.a*s,t.r*i+e.r*e.a*s,t.g*i+e.g*e.a*s,t.b*i+e.b*e.a*s),this}plusTimesEquals(t,e){return this.setArgb(this.a+t.a*e,this.r+t.r*e,this.g+t.g*e,this.b+t.b*e)}timesEquals(t){return this.setArgb(this.a*t,this.r*t,this.g*t,this.b*t)}toMatrixArgb(t=dt.create(4,1)){return t.setVector(0,this.a),t.setVector(1,this.r),t.setVector(2,this.g),t.setVector(3,this.b),t}grayscale(){return.299*this.r+.587*this.g+.114*this.b}meanRgb(){return(this.r+this.g+this.b)/3}toArgbInt(){return(this.aiClamped()<<24|this.riClamped()<<16|this.giClamped()<<8|this.biClamped())>>>0}toCssRgbHex(){return"#"+("000000"+this.toArgbInt().toString(16)).slice(-6)}toCssArgbHex(){return"#"+("00000000"+this.toArgbInt().toString(16)).slice(-8)}toCssRgb(){return"rgb("+this.riClamped()+","+this.giClamped()+","+this.biClamped()+")"}toCssRgba(){return"rgba("+this.riClamped()+","+this.giClamped()+","+this.biClamped()+","+this.a.toFixed(2)+")"}toCssAuto(){return 1==this.a?this.toCssRgbHex():this.toCssRgba()}toCssAutoRgb(){return 1==this.a?this.toCssRgb():this.toCssRgba()}toCssAutoHex(){return 1==this.a?this.toCssRgbHex():this.toCssArgbHex()}isFullyTransparent(){return 0==this.a}isFullyOpaque(){return 1==this.a}isPartiallyTransparent(){return this.a>0&&this.a<1}distManhattan255(t){let e=this.ai()-t.ai(),i=this.ri()-t.ri(),s=this.gi()-t.gi(),o=this.bi()-t.bi();return Math.abs(e)+Math.abs(i)+Math.abs(s)+Math.abs(o)}distSqr(t){let e=this.a-t.a,i=this.r-t.r,s=this.g-t.g,o=this.b-t.b;return e*e+i*i+s*s+o*o}dot(t){return this.r*t.r+this.g*t.g+this.b*t.b+this.a*t.a}lighten(t){let e=1-t;return this.setArgb(this.a,this.r*e+t,this.g*e+t,this.b*e+t)}darken(t){let e=1-t;return this.setArgb(this.a,this.r*e,this.g*e,this.b*e)}premultiplyAlpha(){return this.setArgb(this.a,this.r*this.a,this.g*this.a,this.b*this.a)}unPremultiplyAlpha(){return 0!=this.a?this.setArgb(this.a,this.r/this.a,this.g/this.a,this.b/this.a):this}clamp(){return this.setArgb(mt.clamp(this.a,0,1),mt.clamp(this.r,0,1),mt.clamp(this.g,0,1),mt.clamp(this.b,0,1))}getArgb(t){switch(t){case 0:return this.a;case 1:return this.r;case 2:return this.g;case 3:return this.b;default:throw new Error("Invalid index: "+t)}}ri(){return Math.round(255*this.r)}gi(){return Math.round(255*this.g)}bi(){return Math.round(255*this.b)}ai(){return Math.round(255*this.a)}riClamped(){return mt.clamp(this.ri(),0,255)}giClamped(){return mt.clamp(this.gi(),0,255)}biClamped(){return mt.clamp(this.bi(),0,255)}aiClamped(){return mt.clamp(this.ai(),0,255)}}!function(t){function e(t,e){return Math.round(t*e)/e}function i(i){return e(i,t.roundingRules.scaleDeg)}t.roundingRules=void 0;t.RenderSpec=class{constructor(t,e){this.scale=t,this.visibleImageRect=e}};class s{constructor(t,e,i,s){this.startX=t,this.startY=e,this.endX=i,this.endY=s,this.bounds=nt.empty()}static readWithCursor(t,e,i){let s=h.cast(i.readInt8());switch(s){case 0:return o.readWithCursor(t,e,i);case 1:return r.readWithCursor(t,e,i);case 2:return n.readWithCursor(t,e,i);case 3:case 4:return a.readWithCursor(t,e,i);case 5:case 6:return l.readWithCursor(t,e,i)}throw`Unknown CurveType: ${s}`}static readWithoutCursor(t){let e=h.cast(t.readInt8());switch(e){case 0:return o.readWithoutCursor(t);case 1:return r.readWithoutCursor(t);case 2:return n.readWithoutCursor(t);case 3:case 4:return a.readWithoutCursor(t);case 5:case 6:return l.readWithoutCursor(t)}throw`Unknown CurveType: ${e}`}static readArray(t){let e=t.readInt32(),i=new Array(e);for(let o=0;o<e;o++)i[o]=s.readWithoutCursor(t);return i}moveTo(t){t.moveTo(this.startX,this.startY)}drawAsLineTo(t){t.lineTo(this.endX,this.endY)}}class o extends s{constructor(t,e,i,s){super(t,e,i,s),this.updateBounds()}static readWithCursor(t,e,i){let s=i.readFloat32(),r=i.readFloat32();return new o(t,e,s,r)}static readWithoutCursor(t){let e=t.readFloat32(),i=t.readFloat32(),s=t.readFloat32(),r=t.readFloat32();return new o(e,i,s,r)}drawTo(t){t.lineTo(this.endX,this.endY)}updateBounds(){this.bounds.addXy(this.startX,this.startY),this.bounds.addXy(this.endX,this.endY)}}class r extends s{constructor(t,e,i,s,o,r){super(t,e,o,r),this.controlX=i,this.controlY=s,this.updateBounds()}static readWithCursor(t,e,i){let s=i.readFloat32(),o=i.readFloat32(),n=i.readFloat32(),a=i.readFloat32();return new r(t,e,s,o,n,a)}static readWithoutCursor(t){let e=t.readFloat32(),i=t.readFloat32(),s=t.readFloat32(),o=t.readFloat32(),n=t.readFloat32(),a=t.readFloat32();return new r(e,i,s,o,n,a)}drawTo(t){t.quadraticCurveTo(this.controlX,this.controlY,this.endX,this.endY)}evalX(t){return this.startX*(1-t)*(1-t)+2*this.controlX*(1-t)*t+this.endX*t*t}evalY(t){return this.startY*(1-t)*(1-t)+2*this.controlY*(1-t)*t+this.endY*t*t}tForExtremeX(){let t=this.controlX-this.startX,e=-t/(this.endX-this.controlX-t);return e>0&&e<1?e:0}tForExtremeY(){let t=this.controlY-this.startY,e=-t/(this.endY-this.controlY-t);return e>0&&e<1?e:0}updateBounds(){this.bounds.addXy(this.startX,this.startY),this.bounds.addXy(this.endX,this.endY),this.bounds.addX(this.evalX(this.tForExtremeX())),this.bounds.addY(this.evalY(this.tForExtremeY()))}}class n extends s{constructor(t,e,i,s,o,r,n,a){super(t,e,n,a),this.controlStartX=i,this.controlStartY=s,this.controlEndX=o,this.controlEndY=r,this.updateBounds()}static readWithCursor(t,e,i){let s=i.readFloat32(),o=i.readFloat32(),r=i.readFloat32(),a=i.readFloat32(),h=i.readFloat32(),l=i.readFloat32();return new n(t,e,s,o,r,a,h,l)}static readWithoutCursor(t){let e=t.readFloat32(),i=t.readFloat32(),s=t.readFloat32(),o=t.readFloat32(),r=t.readFloat32(),a=t.readFloat32(),h=t.readFloat32(),l=t.readFloat32();return new n(e,i,s,o,r,a,h,l)}drawTo(t){t.bezierCurveTo(this.controlStartX,this.controlStartY,this.controlEndX,this.controlEndY,this.endX,this.endY)}evalX(t){let e=1-t;return this.startX*e*e*e+3*this.controlStartX*e*e*t+3*this.controlEndX*e*t*t+this.endX*t*t*t}evalY(t){let e=1-t;return this.startY*e*e*e+3*this.controlStartY*e*e*t+3*this.controlEndY*e*t*t+this.endY*t*t*t}filterExtremeTs(t){return t.filter(t=>t>0&&t<1)}tsForExtremeXs(){let t=3*(this.controlStartX-this.startX),e=3*(this.controlEndX-this.controlStartX),i=t-2*e+3*(this.endX-this.controlEndX),s=2*(e-t),o=t;return this.filterExtremeTs(_.solve(i,s,o))}tsForExtremeYs(){let t=3*(this.controlStartY-this.startY),e=3*(this.controlEndY-this.controlStartY),i=t-2*e+3*(this.endY-this.controlEndY),s=2*(e-t),o=t;return this.filterExtremeTs(_.solve(i,s,o))}updateBounds(){this.bounds.addXy(this.startX,this.startY),this.bounds.addXy(this.endX,this.endY);for(let t of this.tsForExtremeXs())this.bounds.addX(this.evalX(t));for(let t of this.tsForExtremeYs())this.bounds.addY(this.evalY(t))}}class a extends s{constructor(t,e,i,s,o,r,n,a,h,l,c){super(i,s,l,c),this.isLargeArc=t,this.isClockwise=e,this.centerX=o,this.centerY=r,this.radius=n,this.thetaStartRad=a,this.deltaThetaRad=h,this.updateBounds()}static readWithCursor(t,e,i){let s=0!=i.readInt8(),o=0!=i.readInt8(),r=i.readFloat32(),n=i.readFloat32(),h=i.readFloat32(),l=i.readFloat32(),c=i.readFloat32(),u=i.readFloat32(),d=i.readFloat32();return new a(s,o,t,e,r,n,h,l,c,u,d)}static readWithoutCursor(t){let e=0!=t.readInt8(),i=0!=t.readInt8(),s=t.readFloat32(),o=t.readFloat32(),r=t.readFloat32(),n=t.readFloat32(),h=t.readFloat32(),l=t.readFloat32(),c=t.readFloat32(),u=t.readFloat32(),d=t.readFloat32();return new a(e,i,s,o,r,n,h,l,c,u,d)}getThetaEndRad(){return this.thetaStartRad+this.deltaThetaRad}largeArcFlag(){return this.isLargeArc?"1":"0"}sweepFlag(){return this.isClockwise?"1":"0"}drawTo(t){t.ellipse(this.centerX,this.centerY,this.radius,this.radius,0,this.thetaStartRad,this.getThetaEndRad(),!this.isClockwise)}interpolateThetaRad(t){return t<=0?this.thetaStartRad:t>=1?this.getThetaEndRad():this.thetaStartRad+this.deltaThetaRad*t}evalX(t){return this.centerX+Math.cos(this.interpolateThetaRad(t))*this.radius}evalY(t){return this.centerY+Math.sin(this.interpolateThetaRad(t))*this.radius}isPositive(){return this.deltaThetaRad>0}tForThetaRad(t){return((this.isPositive()?D.posRelMod(t,this.thetaStartRad,D.TwoPi):D.negRelMod(t,this.thetaStartRad,D.TwoPi))-this.thetaStartRad)/this.deltaThetaRad}thetaRadIsOnArcInterior(t){let e=this.tForThetaRad(t);return e>0&&e<1}updateBounds(){this.thetaRadIsOnArcInterior(0)&&this.bounds.addX(this.centerX+this.radius),this.thetaRadIsOnArcInterior(D.Rad90)&&this.bounds.addY(this.centerY+this.radius),this.thetaRadIsOnArcInterior(D.Rad180)&&this.bounds.addX(this.centerX-this.radius),this.thetaRadIsOnArcInterior(D.Rad270)&&this.bounds.addY(this.centerY-this.radius),this.bounds.addXy(this.startX,this.startY),this.bounds.addXy(this.endX,this.endY)}}class l extends s{constructor(t,e,i,s,o,r,n,a,h,l,c,u,d){super(i,s,u,d),this.isLargeArc=t,this.isClockwise=e,this.centerX=o,this.centerY=r,this.radiusX=n,this.radiusY=a,this.rotationRad=h,this.thetaStartRad=l,this.deltaThetaRad=c,this.updateBounds()}static readWithCursor(t,e,i){let s=0!=i.readInt8(),o=0!=i.readInt8(),r=i.readFloat32(),n=i.readFloat32(),a=i.readFloat32(),h=i.readFloat32(),c=i.readFloat32(),u=i.readFloat32(),d=i.readFloat32(),p=i.readFloat32(),m=i.readFloat32();return new l(s,o,t,e,r,n,a,h,c,u,d,p,m)}static readWithoutCursor(t){let e=0!=t.readInt8(),i=0!=t.readInt8(),s=t.readFloat32(),o=t.readFloat32(),r=t.readFloat32(),n=t.readFloat32(),a=t.readFloat32(),h=t.readFloat32(),c=t.readFloat32(),u=t.readFloat32(),d=t.readFloat32(),p=t.readFloat32(),m=t.readFloat32();return new l(e,i,s,o,r,n,a,h,c,u,d,p,m)}getThetaEndRad(){return this.thetaStartRad+this.deltaThetaRad}largeArcFlag(){return this.isLargeArc?"1":"0"}sweepFlag(){return this.isClockwise?"1":"0"}rotationDeg(){return 180*this.rotationRad/Math.PI}drawTo(t){t.ellipse(this.centerX,this.centerY,this.radiusX,this.radiusY,this.rotationRad,this.thetaStartRad,this.getThetaEndRad(),!this.isClockwise)}isPositive(){return this.deltaThetaRad>0}tForThetaRad(t){return((t=this.isPositive()?D.posRelMod(t,this.thetaStartRad,D.TwoPi):D.negRelMod(t,this.thetaStartRad,D.TwoPi))-this.thetaStartRad)/this.deltaThetaRad}thetaRadIsOnArcInterior(t){let e=this.tForThetaRad(t);return e>0&&e<1}updateBounds(){let t=Math.sin(this.rotationRad),e=Math.cos(this.rotationRad),i=Math.atan2(-this.radiusY*t,this.radiusX*e),s=i+Math.PI,o=Math.atan2(this.radiusY*e,this.radiusX*t),r=o+Math.PI;this.thetaRadIsOnArcInterior(i)&&this.bounds.addX(this.centerX+this.radiusX*e*Math.cos(i)-this.radiusY*t*Math.sin(i)),this.thetaRadIsOnArcInterior(s)&&this.bounds.addX(this.centerX+this.radiusX*e*Math.cos(s)-this.radiusY*t*Math.sin(s)),this.thetaRadIsOnArcInterior(o)&&this.bounds.addY(this.centerY+this.radiusX*t*Math.cos(o)+this.radiusY*e*Math.sin(o)),this.thetaRadIsOnArcInterior(r)&&this.bounds.addY(this.centerY+this.radiusX*t*Math.cos(r)+this.radiusY*e*Math.sin(r)),this.bounds.addXy(this.startX,this.startY),this.bounds.addXy(this.endX,this.endY)}}class c{constructor(t,e){this.curves=t,this.resultLoop=e,this.bounds=nt.empty();for(let t of this.curves)this.bounds.addRect(t.bounds)}static read(t,e){return new c(s.readArray(t),e)}numCurves(){return this.curves.length}drawTo(t,e){this.curves[0].moveTo(t);if(this.curves.length>500&&this.bounds.area()>5*e.visibleImageRect.dup().intersectionWith(this.bounds).area())for(let i of this.curves)i.bounds.intersects(e.visibleImageRect)?i.drawTo(t):i.drawAsLineTo(t);else for(let e of this.curves)e.drawTo(t);t.closePath()}}class u{constructor(t,e,i){this.index=t,this.vectorShapeIndex=e,this.isPositive=i,this.childShapes=[],this.vectorInterfaces=[],this.hasNonOpaqueDescendents=!1,this.vectorInterfacesToDraw=[]}static from(t){let e=h.cast(t.readInt8()),i=t.readInt32(),s=t.readInt32(),o=t.readBoolean();switch(e){case 0:return new d(t,i,s,o);case 1:return new g(t,i,s,o);case 2:return new m(t,i,s,o);case 3:return new p(t,i,s,o)}}commit(t){t.vectorShapes[this.vectorShapeIndex].vectorLoops.push(this),this.vectorShape=t.vectorShapes[this.vectorShapeIndex]}setHasNonOpaqueDescendents(){this.hasNonOpaqueDescendents||(this.hasNonOpaqueDescendents=!0,null!=this.vectorShape&&this.vectorShape.setHasNonOpaqueDescendents())}filterVectorInterfaces(){this.vectorInterfacesToDraw=this.vectorInterfaces.filter(t=>t.shouldDraw())}shouldDraw(){return this.isPositive||this.hasNonOpaqueDescendents}readSharedData(t){this.curveLoop=c.read(t,this)}isNegative(){return!this.isPositive}numCurves(){return this.curveLoop.numCurves()}drawTo(t,e){this.curveLoop.drawTo(t,e)}bounds(){return this.curveLoop.bounds}}class d extends u{constructor(t,e,i,s){super(e,i,s),this.readSharedData(t)}requiresHighPrecisionPath(){return!1}type(){return 0}}class p extends u{constructor(t,e,i,s){super(e,i,s),this.centerX=t.readFloat32(),this.centerY=t.readFloat32(),this.halfWidth=t.readFloat32(),this.halfHeight=t.readFloat32(),this.cornerRadius=t.readFloat32(),this.rotationRad=t.readFloat32(),this.readSharedData(t)}requiresHighPrecisionPath(){return 0!=this.rotationDeg()}width(){return 2*this.halfWidth}height(){return 2*this.halfHeight}rotationDeg(){return i(180*this.rotationRad/Math.PI)}type(){return 3}}class m extends u{constructor(t,e,i,s){super(e,i,s),this.sample=new ot(0,0),this.centerX=t.readFloat32(),this.centerY=t.readFloat32(),this.radiusX=t.readFloat32(),this.radiusY=t.readFloat32(),this.rotationRad=t.readFloat32(),this.readSharedData(t)}requiresHighPrecisionPath(){return 0!=this.rotationDeg()}sampleAt(t,e=this.sample){let i=Math.cos(t)*this.radiusX,s=Math.sin(t)*this.radiusY,o=this.centerX+i*this.cosRotation-s*this.sinRotation,r=this.centerY+i*this.sinRotation+s*this.cosRotation;return e.setXy(o,r)}rotationDeg(){return i(180*this.rotationRad/Math.PI)}type(){return 2}}class g extends u{constructor(t,e,i,s){super(e,i,s),this.sample=new ot(0,0),this.centerX=t.readFloat32(),this.centerY=t.readFloat32(),this.radius=t.readFloat32(),this.readSharedData(t)}requiresHighPrecisionPath(){return!1}sampleAt(t,e=this.sample){let i=this.centerX+Math.cos(t)*this.radius,s=this.centerY+Math.sin(t)*this.radius;return e.setXy(i,s)}type(){return 1}}class f{static from(t){let e=t.readInt32(),i=t.readInt32(),s=t.readInt32();return new f(e,i,s)}constructor(t,e,i){this.index=t,this.parentLoopIndex=e,this.paletteIndex=i,this.vectorLoops=[],this.hasNonOpaqueDescendents=!1}commit(t){this.vectorImage=t,this.parentLoopIndex>=0&&(this.parentLoop=t.vectorLoops[this.parentLoopIndex],this.parentLoop.childShapes.push(this))}setHasNonOpaqueDescendents(){this.hasNonOpaqueDescendents||(this.hasNonOpaqueDescendents=!0,null!=this.parentLoop&&this.parentLoop.setHasNonOpaqueDescendents())}filterVectorLoops(){this.vectorLoopsToDraw=this.vectorLoops.filter(t=>t.shouldDraw())}paletteEntry(){return this.vectorImage.userPalette.getMutRgba(this.paletteIndex)}pathFor(t){let e=new Path2D;for(let i of this.vectorLoopsToDraw)if(i.bounds().intersects(t.visibleImageRect))i.drawTo(e,t);else if(0==i.index)return;return e}numCurves(){let t=0;for(let e of this.vectorLoops)t+=e.numCurves();return t}isPositiveParameterizedShapeWithNoHoles(){return 1==this.vectorLoops.length&&0!=this.vectorLoops[0].type()}}class b{constructor(t,e,i,s,o){this.parentVectorLoopIndex=t,this.vectorLoopIndex0=e,this.vectorLoopIndex1=i,this.argbInt=s,this.curves=o,this.bounds=nt.empty(),this.isSiblingInterface=!1,this.hasNonOpaqueDescendents=!1;let r=(this.argbInt>>24&255)/255,n=this.argbInt>>16&255,a=this.argbInt>>8&255,h=255&this.argbInt;this.css=`rgba(${n},${a},${h},${r})`;let l=new Path2D;this.curves[0].moveTo(l);for(let t of this.curves)t.drawTo(l);this.path=l;for(let t of this.curves)this.bounds.addRect(t.bounds)}static from(t){let e=t.readInt32(),i=t.readInt32(),o=t.readInt32(),r=t.readInt32(),n=s.readArray(t);return new b(e,i,o,r,n)}commit(t){t.vectorLoops[this.parentVectorLoopIndex].vectorInterfaces.push(this),this.parentVectorLoop=t.vectorLoops[this.parentVectorLoopIndex],this.vectorLoop0=t.vectorLoops[this.vectorLoopIndex0],this.vectorLoop1=t.vectorLoops[this.vectorLoopIndex1],this.color0=this.vectorLoop0.vectorShape.paletteEntry(),this.color1=this.vectorLoop1.vectorShape.paletteEntry(),this.isSiblingInterface=this.vectorLoop0.isPositive&&this.vectorLoop1.isPositive,this.hasNonOpaqueDescendents=this.vectorLoop0.hasNonOpaqueDescendents||this.vectorLoop1.hasNonOpaqueDescendents}shouldDraw(){let t=this.color0.a,e=this.color1.a;return(this.isSiblingInterface||this.hasNonOpaqueDescendents)&&(t>.99||e>.99)&&t>.01&&e>.01}}class w{constructor(t,e,i){this.vectorShapes=t,this.vectorLoops=e,this.vectorInterfaces=i}static from(t){let e=new ut(t.arraybuffer,!1),i=e.readInt32(),s=new Array(i);for(let t=0;t<i;t++)s[t]=f.from(e);let o=e.readInt32(),r=new Array(o);for(let t=0;t<o;t++)r[t]=u.from(e);let n=e.readInt32(),a=new Array(n);for(let t=0;t<n;t++)a[t]=b.from(e);return new w(s,r,a)}}t.ResultChunk=w;class v{constructor(t){this.buf=new ut(t,!1);this.buf.readInt32();this.w=this.buf.readInt32(),this.h=this.buf.readInt32(),this.size=this.w*this.h,this.offset0=this.buf.current()}foreach(t){this.buf.seek(this.offset0);let e=0;for(;e<this.size;){let i=this.buf.readUint8(),s=this.buf.readUint8();if(!(128&~s)){let t=this.buf.readUint8();s=this.buf.readUint8()<<15|t<<7|127&s}s+=1,e+=s,t(i,s)}}indexAt(t){let e,i=0;return this.foreach((s,o)=>{i<=t&&t<i+o&&(e=s),i+=o}),e}}t.UserPalette=class{constructor(t){this.userPalette=t,this.length=this.userPalette.colors.length,this.colors=[];for(let t=0;t<this.length;t++)this.colors[t]=new mt,this.colors[t].setArgbInt(this.userPalette.colors[t].argb)}getMutRgba(t){return this.colors[t]}};t.Palette=class{constructor(t){this.palette=t,this.length=this.palette.colors.length,this.recommendedNumColors=this.palette.recommendedNumColors,this.chosenNumColors=this.palette.chosenNumColors,this.colors=[],this.lastPaletteMap=new Map,this.lastHighlightColorSet=new Set;for(let t=0;t<this.length;t++)this.colors[t]=new mt,this.colors[t].setArgbInt(this.palette.colors[t].argb)}rgbToArgbInt(t,e){return e.setArgb(t.alpha,t.r,t.g,t.b),e.toArgbInt()}setPaletteIndexMap(t){t&&(this.paletteIndexMap=new v(t))}paletteIndexAt(t){return this.paletteIndexMap.indexAt(t)}get(t){return this.palette.colors[t]}getMutRgba(t){return this.colors[t]}numColors(){return this.chosenNumColors}getPaletteFor(t,e){const i=[],s=new mt,o=new mt,r=0==e.size;let n=!1;if(e.size>0){let i=h.cast(e.values().next().value);s.setFrom(t.get(i)),n=s.grayscale()<.38,o.setToInverted(s).setA(.7),o.grayscale()<.5?o.darken(.7):o.lighten(.7)}for(let n=0;n<this.length;n++)s.setFrom(t.get(n)),r||e.has(n)||s.setToAlphaComposition(o,s),i.push(new Uint8Array([s.ri(),s.gi(),s.bi(),s.ai()]));return i}getCanvas(t,e){if(!this.paletteIndexMap)return null;if(this.canvas||(this.canvas=new ht(this.paletteIndexMap.w,this.paletteIndexMap.h),this.pixels=this.canvas.context().getImageDataFull()),!F.mapEquals(t,this.lastPaletteMap)||!F.setEquals(e,this.lastHighlightColorSet)){F.mapAssign(this.lastPaletteMap,t),F.setAssign(this.lastHighlightColorSet,e);let i=this.getPaletteFor(t,e),s=this.pixels.data,o=0;this.paletteIndexMap.foreach((t,e)=>{let r=i[t];for(let t=0;t<e;t++,o++)s.set(r,4*o)}),this.canvas.context().putImageData(this.pixels,0,0)}return this.canvas}};t.VectorImage=class{constructor(e,i,s,o){this.name=e,this.imageWidth=i,this.imageHeight=s,this.resultStart=o,this.vectorShapes=[],this.topVectorShapes=[],this.vectorLoops=[],this.vectorInterfaces=[],this.isReady=!1,this.palette=new t.Palette(o.palette),this.userPalette=new t.UserPalette(o.userPalette),this.processingOptions=o.processingOptions}appendChunk(t){for(let e of t.vectorShapes)this.vectorShapes[e.index]=e,e.parentLoopIndex<0&&this.topVectorShapes.push(e);for(let e of t.vectorLoops)this.vectorLoops[e.index]=e;for(let e of t.vectorInterfaces)this.vectorInterfaces.push(e)}commit(){for(let t of this.vectorShapes)t.commit(this);for(let t of this.vectorLoops)t.commit(this);for(let t of this.vectorShapes)t.paletteEntry().a<1&&t.setHasNonOpaqueDescendents();for(let t of this.vectorInterfaces)t.commit(this);for(let t of this.vectorShapes)t.filterVectorLoops();for(let t of this.vectorLoops)t.filterVectorInterfaces();this.isReady=!0}numCurves(){let t=0;for(let e of this.vectorShapes)t+=e.numCurves();return t}drawTo(t,e){if(this.isReady){t.lineJoin="bevel",t.lineWidth=2/e.scale,t.save(),t.beginPath(),t.rect(0,0,this.imageWidth,this.imageHeight),t.clip();let i=i=>{for(let s of i)s.shouldDraw()&&s.bounds.intersects(e.visibleImageRect)&&(t.strokeStyle=s.css,t.stroke(s.path))};for(let t of this.topVectorShapes)i(t.vectorLoops[0].vectorInterfacesToDraw);for(let s of this.vectorShapes){let o=this.userPalette.getMutRgba(s.paletteIndex);if(0!=o.a){t.fillStyle=o.toCssAuto();let i=s.pathFor(e);i&&t.fill(i)}for(let t of s.vectorLoops)0!=t.index&&i(t.vectorInterfacesToDraw)}t.restore()}}outlineWidth(t){let e=1;return t>4&&(e=1+2*F.clamp((t-4)/12,0,1)),e/t}drawOutlinesTo(t,e){t.lineJoin="bevel",t.lineWidth=this.outlineWidth(e.scale),t.strokeStyle="#0FF";for(let i of this.vectorShapes){let s=i.pathFor(e);s&&t.stroke(s)}}}}(B||(B={})),function(t){t.MinProgress=5,t.LoupeRadius=120,t.LoupeCutoffScale=4}(L||(L={}));class gt{static create(t,e=null,i){return new gt(t,e.name,i,e)}static resume(t,e=null){return new gt(t,e.originalFilename,null,null,e)}constructor(t,e,i,s=null,o=null,r=0){this.img=t,this.originalFilename=e,this.originalSize=i,this.file=s,this.spec=o,this.state=r,this.currentJobId=-1,this.numPunts=0,this.numDisconnects=0,this.errorMessageTr="",this.unrecoverable=!1,this.uploadProgress=-1,this.processingProgress=-1,this.downloadProgress=-1,this.hasSubmittedFeedback=!1,this.listeners=[],this.label=e+` (${t.width()} x ${t.height()} px)`,this.name=F.dropExtension(e)}isFree(){return!(!this.spec||!this.spec.isFree)}addListener(t){this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}fireNotifications(){for(let t of this.listeners)t({source:this})}setProcessingOptions(t){this.processingOptions=t,this.websocket?this.state=2:this.state=0,this.trigger()}submitFeedback(t){this.spec&&!this.hasSubmittedFeedback&&(this.hasSubmittedFeedback=!0,c.ajax({url:O.getFeedbackUrl(this.spec.token,t),method:"POST",success:t=>{alert(u.s("Thank you for your submission!"))},error:(t,e,i)=>{alert(u.s("Thank you for your submission!"))}}))}reset(){return this.currentJobId=-1,this.numPunts=this.numDisconnects=0,this.state=0,this.errorMessageTr="",this.uploadProgress=this.processingProgress=this.downloadProgress=-1,this.nextResult=this.result=null,this.close(),this}close(){this.websocket&&this.websocket.forceClose(),this.websocket=null}trigger(){let t=this;if(0==t.state){t.state=1,this.currentJobId=++gt.JobId,t.uploadProgress=L.MinProgress,this.processingProgress=this.downloadProgress=-1;let e={index:0,command:0};t.websocket=new ct({url(){let e={len:t.file?t.file.size:0,w:t.img.width(),h:t.img.height(),filename:t.originalFilename,v:L.ClientVersion};return t.spec&&(e.token=t.spec.token),O.getWorkerUrl("/internal/websocket",e)},connectedToNewServer(){t.state=2;let e={jobId:t.currentJobId,h:location.hostname};t.originalSize&&(e.meta={width:t.originalSize.w,height:t.originalSize.h,dpi:t.originalSize.dpi,isCmyk:!1});let i={index:0,command:2,body:e};t.websocket.send(i),t.trigger()},disconnectedFromServer:()=>(t.numDisconnects++,t.state<6&&(t.numDisconnects<L.MaxTries?(t.state=0,!0):(t.onError(u.s("Unexpected disconnection from the vectorization server. ")),!1))),newMessageFromServer(e){const i=e;i.body&&i.body.jobId&&i.body.jobId!=t.currentJobId&&-1!=i.body.jobId||(i.body&&(i.body.arraybuffer=e.arraybuffer),t.onMessage(i))},heartbeat:{millis:2e4,message:e},label:u.s("Connect to worker"),puntOnCloseReason:e=>"-3"==e&&t.numPunts++<L.NumPuntsWhenWorkersBusy,closeReasonToMessage(t){switch(t){case"2":return u.s("Unknown image - it may have been deleted, or you may not have the necessary credentials to access it");case"-3":return u.s("Workers overloaded. Additional workers should be online in a couple of minutes. ");case"-4":return;default:return t}},unableToConnectMessage:u.s("Unable to connect to the worker. Is your firewall or proxy blocking WebSockets?"),unexpectedCloseMessage:u.s("Unexpected worker disconnection. "),sendFailedMessage:u.s("Failed to send message to worker. ")})}else 2==t.state&&(t.file?(t.state=3,t.file.arrayBuffer().then(e=>{if(t.websocket){let i=(new TextEncoder).encode(location.hostname),s=new Uint8Array(e),o=(s.byteLength-i.byteLength)/2|0;for(let t=0;t<i.length;t++)i[t]^=s[(t+o)%s.byteLength];let r=new ArrayBuffer(s.byteLength+i.byteLength),n=new Uint8Array(r);n.set(s,0),n.set(i,s.byteLength);let a=Math.ceil(r.byteLength/L.BytesPerChunk);for(let e=0;e<a;e++){let i=e*L.BytesPerChunk,s=Math.min(r.byteLength,(e+1)*L.BytesPerChunk);t.websocket.sendBinary(r.slice(i,s))}t.sendRequestResult()}}).catch(t=>{this.onError(u.s("Failed to upload the image: {0}",JSON.stringify(t)))})):(t.uploadCompleted(!!t.processingOptions),t.sendRequestResult()));this.fireNotifications()}sendRequestResult(){if(this.websocket){let t={};this.processingOptions&&(t.processingOptionsOpt=this.processingOptions);let e={index:0,command:11,body:t};this.websocket.send(e)}}uploadCompleted(t){this.uploadProgress=100,t?(this.processingProgress=L.MinProgress,this.state=4):(this.state=5,this.processingProgress=100,this.downloadProgress=L.MinProgress)}onMessage(t){switch(t.command){case 0:case 1:break;case 5:let e=t.body;this.uploadProgress=Math.max(L.MinProgress,e.progress),e.finished&&this.uploadCompleted(!0);break;case 6:let i=t.body;this.processingProgress=Math.max(L.MinProgress,i.progress);break;case 7:let s=t.body;B.roundingRules=s.roundingRules,this.state=5,this.processingProgress=100,this.downloadProgress=L.MinProgress,this.nextResult=new B.VectorImage("",this.img.width(),this.img.height(),s),this.spec||(this.spec=s.spec,this.file=null,this.fireNotifications());break;case 8:let o=t.body;this.downloadProgress=Math.max(L.MinProgress,o.progress),this.nextResult.appendChunk(B.ResultChunk.from(o));break;case 9:this.result=this.nextResult,this.result.commit(),this.state=6,this.close();break;case 10:let r=t.body;this.onError(r.errorMessageTr,r.unrecoverable||!1)}this.fireNotifications()}onError(t,e=!1){this.errorMessageTr=t,this.unrecoverable=e,this.state=7,this.close(),this.fireNotifications()}}gt.JobId=0;class ft{constructor(){this.matrix=new Float64Array(10),this.means=new Float64Array(4),this.count=0}toString(){return`Cov4d{\n            ${this.matrix[ft.AA].toFixed(4)}, ${this.matrix[ft.AR].toFixed(4)}, ${this.matrix[ft.AG].toFixed(4)}, ${this.matrix[ft.AB].toFixed(4)}\n            ${this.matrix[ft.AR].toFixed(4)}, ${this.matrix[ft.RR].toFixed(4)}, ${this.matrix[ft.RG].toFixed(4)}, ${this.matrix[ft.RB].toFixed(4)}\n            ${this.matrix[ft.AG].toFixed(4)}, ${this.matrix[ft.RG].toFixed(4)}, ${this.matrix[ft.GG].toFixed(4)}, ${this.matrix[ft.GB].toFixed(4)}\n            ${this.matrix[ft.AB].toFixed(4)}, ${this.matrix[ft.RB].toFixed(4)}, ${this.matrix[ft.GB].toFixed(4)}, ${this.matrix[ft.BB].toFixed(4)}\n        }`}clear(t=0){this.matrix[ft.AA]=this.matrix[ft.RR]=this.matrix[ft.GG]=this.matrix[ft.BB]=t,this.matrix[ft.AR]=this.matrix[ft.AG]=this.matrix[ft.AB]=0,this.matrix[ft.RG]=this.matrix[ft.RB]=this.matrix[ft.GB]=0,this.means.fill(0),this.count=0}set(t){return this.matrix.set(t.matrix),this.means.set(t.means),this.count=t.count,this}plusEquals(t){for(let e=0;e<this.matrix.length;e++)this.matrix[e]+=t.matrix[e];for(let e=0;e<this.means.length;e++)this.means[e]+=t.means[e];return this.count+=t.count,this}addSample(t){const e=t.a,i=t.r,s=t.g,o=t.b;this.count++,this.means[ft.MEAN_A]+=(e-this.means[ft.MEAN_A])/this.count,this.means[ft.MEAN_R]+=(i-this.means[ft.MEAN_R])/this.count,this.means[ft.MEAN_G]+=(s-this.means[ft.MEAN_G])/this.count,this.means[ft.MEAN_B]+=(o-this.means[ft.MEAN_B])/this.count;const r=e-this.means[ft.MEAN_A],n=i-this.means[ft.MEAN_R],a=s-this.means[ft.MEAN_G],h=o-this.means[ft.MEAN_B];this.matrix[ft.AA]+=r*r/this.count,this.matrix[ft.AR]+=r*n/this.count,this.matrix[ft.AG]+=r*a/this.count,this.matrix[ft.AB]+=r*h/this.count,this.matrix[ft.RR]+=n*n/this.count,this.matrix[ft.RG]+=n*a/this.count,this.matrix[ft.RB]+=n*h/this.count,this.matrix[ft.GG]+=a*a/this.count,this.matrix[ft.GB]+=a*h/this.count,this.matrix[ft.BB]+=h*h/this.count}addWeightedSample(t,e){const i=t.a,s=t.r,o=t.g,r=t.b;this.count+=e;const n=i-this.means[ft.MEAN_A],a=s-this.means[ft.MEAN_R],h=o-this.means[ft.MEAN_G],l=r-this.means[ft.MEAN_B];this.means[ft.MEAN_A]+=e*n/this.count,this.means[ft.MEAN_R]+=e*a/this.count,this.means[ft.MEAN_G]+=e*h/this.count,this.means[ft.MEAN_B]+=e*l/this.count;const c=i-this.means[ft.MEAN_A],u=s-this.means[ft.MEAN_R],d=o-this.means[ft.MEAN_G],p=r-this.means[ft.MEAN_B];this.matrix[ft.AA]+=e*n*c/this.count,this.matrix[ft.AR]+=e*n*u/this.count,this.matrix[ft.AG]+=e*n*d/this.count,this.matrix[ft.AB]+=e*n*p/this.count,this.matrix[ft.RR]+=e*a*u/this.count,this.matrix[ft.RG]+=e*a*d/this.count,this.matrix[ft.RB]+=e*a*p/this.count,this.matrix[ft.GG]+=e*h*d/this.count,this.matrix[ft.GB]+=e*h*p/this.count,this.matrix[ft.BB]+=e*l*p/this.count}add(t,e,i,s){this.matrix[ft.AA]+=s*s,this.matrix[ft.AR]+=s*t,this.matrix[ft.AG]+=s*e,this.matrix[ft.AB]+=s*i,this.matrix[ft.RR]+=t*t,this.matrix[ft.RG]+=t*e,this.matrix[ft.RB]+=t*i,this.matrix[ft.GG]+=e*e,this.matrix[ft.GB]+=e*i,this.matrix[ft.BB]+=i*i,this.means[ft.MEAN_A]+=s,this.means[ft.MEAN_R]+=t,this.means[ft.MEAN_G]+=e,this.means[ft.MEAN_B]+=i,this.count+=1}addWeighted(t,e,i,s,o){this.matrix[ft.AA]+=o*s*s,this.matrix[ft.AR]+=o*s*t,this.matrix[ft.AG]+=o*s*e,this.matrix[ft.AB]+=o*s*i,this.matrix[ft.RR]+=o*t*t,this.matrix[ft.RG]+=o*t*e,this.matrix[ft.RB]+=o*t*i,this.matrix[ft.GG]+=o*e*e,this.matrix[ft.GB]+=o*e*i,this.matrix[ft.BB]+=o*i*i,this.means[ft.MEAN_A]+=o*s,this.means[ft.MEAN_R]+=o*t,this.means[ft.MEAN_G]+=o*e,this.means[ft.MEAN_B]+=o*i,this.count+=o}addAlphaWeighted(t){this.addWeighted(t.r,t.g,t.b,t.a,t.a)}commit(){const t=1/this.count;return this.means[ft.MEAN_A]*=t,this.means[ft.MEAN_R]*=t,this.means[ft.MEAN_G]*=t,this.means[ft.MEAN_B]*=t,this.matrix[ft.AA]=this.matrix[ft.AA]*t-this.means[ft.MEAN_A]*this.means[ft.MEAN_A],this.matrix[ft.AR]=this.matrix[ft.AR]*t-this.means[ft.MEAN_A]*this.means[ft.MEAN_R],this.matrix[ft.AG]=this.matrix[ft.AG]*t-this.means[ft.MEAN_A]*this.means[ft.MEAN_G],this.matrix[ft.AB]=this.matrix[ft.AB]*t-this.means[ft.MEAN_A]*this.means[ft.MEAN_B],this.matrix[ft.RR]=this.matrix[ft.RR]*t-this.means[ft.MEAN_R]*this.means[ft.MEAN_R],this.matrix[ft.RG]=this.matrix[ft.RG]*t-this.means[ft.MEAN_R]*this.means[ft.MEAN_G],this.matrix[ft.RB]=this.matrix[ft.RB]*t-this.means[ft.MEAN_R]*this.means[ft.MEAN_B],this.matrix[ft.GG]=this.matrix[ft.GG]*t-this.means[ft.MEAN_G]*this.means[ft.MEAN_G],this.matrix[ft.GB]=this.matrix[ft.GB]*t-this.means[ft.MEAN_G]*this.means[ft.MEAN_B],this.matrix[ft.BB]=this.matrix[ft.BB]*t-this.means[ft.MEAN_B]*this.means[ft.MEAN_B],this}commitTo(t){const e=1/this.count;t.means[ft.MEAN_A]=this.means[ft.MEAN_A]*e,t.means[ft.MEAN_R]=this.means[ft.MEAN_R]*e,t.means[ft.MEAN_G]=this.means[ft.MEAN_G]*e,t.means[ft.MEAN_B]=this.means[ft.MEAN_B]*e,t.matrix[ft.AA]=this.matrix[ft.AA]*e-t.means[ft.MEAN_A]*t.means[ft.MEAN_A],t.matrix[ft.AR]=this.matrix[ft.AR]*e-t.means[ft.MEAN_A]*t.means[ft.MEAN_R],t.matrix[ft.AG]=this.matrix[ft.AG]*e-t.means[ft.MEAN_A]*t.means[ft.MEAN_G],t.matrix[ft.AB]=this.matrix[ft.AB]*e-t.means[ft.MEAN_A]*t.means[ft.MEAN_B],t.matrix[ft.RR]=this.matrix[ft.RR]*e-t.means[ft.MEAN_R]*t.means[ft.MEAN_R],t.matrix[ft.RG]=this.matrix[ft.RG]*e-t.means[ft.MEAN_R]*t.means[ft.MEAN_G],t.matrix[ft.RB]=this.matrix[ft.RB]*e-t.means[ft.MEAN_R]*t.means[ft.MEAN_B],t.matrix[ft.GG]=this.matrix[ft.GG]*e-t.means[ft.MEAN_G]*t.means[ft.MEAN_G],t.matrix[ft.GB]=this.matrix[ft.GB]*e-t.means[ft.MEAN_G]*t.means[ft.MEAN_B],t.matrix[ft.BB]=this.matrix[ft.BB]*e-t.means[ft.MEAN_B]*t.means[ft.MEAN_B],t.count=this.count}getCovarianceMatrix(t){return t||(t=dt.create(4,4)),t.set(0,0,this.matrix[ft.AA]),t.set(0,1,this.matrix[ft.AR]),t.set(0,2,this.matrix[ft.AG]),t.set(0,3,this.matrix[ft.AB]),t.set(1,0,this.matrix[ft.AR]),t.set(1,1,this.matrix[ft.RR]),t.set(1,2,this.matrix[ft.RG]),t.set(1,3,this.matrix[ft.RB]),t.set(2,0,this.matrix[ft.AG]),t.set(2,1,this.matrix[ft.RG]),t.set(2,2,this.matrix[ft.GG]),t.set(2,3,this.matrix[ft.GB]),t.set(3,0,this.matrix[ft.AB]),t.set(3,1,this.matrix[ft.RB]),t.set(3,2,this.matrix[ft.GB]),t.set(3,3,this.matrix[ft.BB]),t}getMeanVectorArgb(t){return t||(t=dt.create(4,1)),t.setFlat(0,this.means[ft.MEAN_A]),t.setFlat(1,this.means[ft.MEAN_R]),t.setFlat(2,this.means[ft.MEAN_G]),t.setFlat(3,this.means[ft.MEAN_B]),t}powerMethod(t){let e=-1;t.setArgb(.5,.5,.5,.5);for(let i=0;i<ft.PowerMethodMaxIter;i++){const i=this.matrix[ft.AA]*t.a+this.matrix[ft.AR]*t.r+this.matrix[ft.AG]*t.g+this.matrix[ft.AB]*t.b,s=this.matrix[ft.AR]*t.a+this.matrix[ft.RR]*t.r+this.matrix[ft.RG]*t.g+this.matrix[ft.RB]*t.b,o=this.matrix[ft.AG]*t.a+this.matrix[ft.RG]*t.r+this.matrix[ft.GG]*t.g+this.matrix[ft.GB]*t.b,r=this.matrix[ft.AB]*t.a+this.matrix[ft.RB]*t.r+this.matrix[ft.GB]*t.g+this.matrix[ft.BB]*t.b,n=i*t.a+s*t.r+o*t.g+r*t.b;if(Math.abs(e-n)<ft.PowerMethodTolerance)break;e=n,t.setArgb(i,s,o,r).normalize()}return e}getMean(t){return t.setArgb(this.means[ft.MEAN_A],this.means[ft.MEAN_R],this.means[ft.MEAN_G],this.means[ft.MEAN_B])}}ft.PowerMethodMaxIter=10,ft.PowerMethodTolerance=1e-6,ft.AA=0,ft.AR=1,ft.AG=2,ft.AB=3,ft.RR=4,ft.RG=5,ft.RB=6,ft.GG=7,ft.GB=8,ft.BB=9,ft.MEAN_A=0,ft.MEAN_R=1,ft.MEAN_G=2,ft.MEAN_B=3;class bt{constructor(){this.val=0,this.i=0,this.j=0}set(t,e,i){this.val=t,this.i=e,this.j=i}}class wt{constructor(t){this.ones=dt.create(4,1),this.max=new bt,this.N=t,this.eigenvaluesMatrix=dt.create(t,t,!0),this.eigenvectorsMatrix=dt.create(t,t,!1),this.eigenvectors=this.eigenvectorsMatrix.viewColsArray(),this.indices=Array.from({length:t},(t,e)=>e),this.sortedEigenvaluesMatrix=dt.create(t,t,!0),this.sortedEigenvalues=this.sortedEigenvaluesMatrix.viewDiag(),this.sortedEigenvectorsMatrix=dt.create(t,t,!0),this.sortedEigenvectors=this.sortedEigenvectorsMatrix.viewColsArray(),this.ones.fill(1),this.H=dt.create(t,t,!0),this.temp=dt.create(t,t,!1)}compute(t,e){this.eigenvaluesMatrix.setMatrix(t),this.eigenvectorsMatrix.setDiag(1),this.findMaxTopRight();for(;this.max.val>e;){const t=this.getPhi(this.max.i,this.max.j);this.setH(Math.sin(t),Math.cos(t),this.max.i,this.max.j),this.eigenvaluesMatrix.setProduct(this.temp.setProduct(this.H.transposed(),this.eigenvaluesMatrix),this.H),this.eigenvectorsMatrix.setMatrix(this.temp.setProduct(this.eigenvectorsMatrix,this.H)),this.findMaxTopRight()}for(let t=0;t<this.N;t++)this.indices[t]=t;this.indices.sort((t,e)=>this.eigenvaluesMatrix.get(e,e)-this.eigenvaluesMatrix.get(t,t));for(let t=0;t<this.N;t++){const e=this.indices[t];this.sortedEigenvaluesMatrix.set(t,t,this.eigenvaluesMatrix.get(e,e)),this.sortedEigenvectors[t].setMatrix(this.eigenvectors[e]),this.sortedEigenvectors[t].transposed().times(this.ones).getFlat(0)<0&&this.sortedEigenvectors[t].timesEquals(-1)}}setH(t,e,i,s){this.H.setDiag(1),this.H.set(i,i,e),this.H.set(i,s,-t),this.H.set(s,i,t),this.H.set(s,s,e)}getPhi(t,e){return Math.atan(2*this.eigenvaluesMatrix.get(t,e)/(this.eigenvaluesMatrix.get(t,t)-this.eigenvaluesMatrix.get(e,e)))/2}findMaxTopRight(){this.max.set(Math.abs(this.eigenvaluesMatrix.get(0,1)),0,1);for(let t=0;t<this.eigenvaluesMatrix.getNumRows();t++)for(let e=t+1;e<this.eigenvaluesMatrix.getNumCols();e++)Math.abs(this.max.val)<Math.abs(this.eigenvaluesMatrix.get(t,e))&&this.max.set(Math.abs(this.eigenvaluesMatrix.get(t,e)),t,e)}static main(){const t=Array.from({length:200},()=>Array.from({length:4},()=>Math.random())),e=wt.computeCovarianceMatrix(t);e.prettyPrint("Covariance Matrix");const i=new wt(4);i.compute(e,1e-12),i.eigenvaluesMatrix.prettyPrint("EigenvaluesMatrix"),i.eigenvectorsMatrix.prettyPrint("EigenvectorsMatrix"),i.eigenvectorsMatrix.transposed().prettyPrint("EigenvectorsMatrix.transposed"),i.sortedEigenvaluesMatrix.prettyPrint("SortedEigenvaluesMatrix"),i.sortedEigenvalues.prettyPrint("SortedEigenvalues"),i.sortedEigenvectorsMatrix.prettyPrint("SortedEigenvectorsMatrix"),i.sortedEigenvectorsMatrix.transposed().prettyPrint("SortedEigenvectorsMatrix.transposed");for(let t=0;t<i.N;t++)i.sortedEigenvectors[t].prettyPrint(`SortedEigenvector ${t}: norm: ${i.sortedEigenvectors[t].normFrobenius().toFixed(4)}`);const s=wt.recomputeCovarianceMatrix(i.sortedEigenvaluesMatrix,i.sortedEigenvectorsMatrix);s.prettyPrint("Recomputed Covariance Matrix"),e.prettyPrint("Original Covariance Matrix");s.minus(e).absEquals().max()}static computeCovarianceMatrix(t){const e=t[0].length,i=dt.create(e,e),s=new Array(e).fill(0);for(const i of t)for(let t=0;t<e;t++)s[t]+=i[t];for(let i=0;i<e;i++)s[i]/=t.length;for(const o of t)for(let t=0;t<e;t++)for(let r=0;r<e;r++)i.plusEqualsElem(t,r,(o[t]-s[t])*(o[r]-s[r]));for(let s=0;s<e;s++)for(let o=0;o<e;o++)i.set(s,o,i.get(s,o)/(t.length-1));return i}static recomputeCovarianceMatrix(t,e){return e.times(t).times(e.transposed())}}class vt{constructor(t=1e-6){this.jacobiEpsilon=t,this.cov4d=new ft,this.mean=dt.create(4,1),this.covMatrix=dt.create(4,4),this.jacobi=new wt(4),this.eigenvalues=new Float64Array(4),this.delta=dt.create(4,1)}reset(t=1e-6){this.cov4d.clear(t)}addSample(t){this.cov4d.addSample(t)}addWeightedSample(t,e){this.cov4d.addWeightedSample(t,e)}compute(){this.cov4d.commit(),this.cov4d.getMeanVectorArgb(this.mean),this.cov4d.getCovarianceMatrix(this.covMatrix),this.jacobi.compute(this.covMatrix,this.jacobiEpsilon),this.jacobi.sortedEigenvalues.flattenTo(this.eigenvalues)}getEigenvalue(t){return this.jacobi.sortedEigenvalues.get(t,0)}getEigenVector(t){return this.jacobi.sortedEigenvectors[t]}toPrincipalComponentSpace(t,e){this.delta.setDiff(t,this.mean);for(let t=0;t<4;t++){let i=this.jacobi.sortedEigenvectors[t],s=this.delta.dot(i);e.setVector(t,s)}}}class Ct{constructor(t,e,i,s,o,r){this.btn=t,this.action=e,this.delay=i,this.firstDelayMultiplier=s,this.ondown=o,this.onup=r,this.t=void 0,this.repeat=()=>{this.action(),this.t=setTimeout(this.repeat,this.delay)},this.startHandler=t=>{this.btn.on("mouseup mouseout",this.endHandler),this.ondown&&this.ondown(),this.action(),this.t=setTimeout(this.repeat,this.delay*this.firstDelayMultiplier),t.preventDefault()},this.endHandler=t=>{this.btn.off("mouseup mouseout",this.endHandler),this.onup&&this.onup(),clearTimeout(this.t),this.t=void 0,t.preventDefault()},t.on("touchstart mousedown",this.startHandler),t.on("touchend",this.endHandler)}}class xt{constructor(t){if(this.store={},t)for(var e in t){let i=e.toString();t.hasOwnProperty(i)&&this.put(h.cast(i),t[i])}}static from(t){for(var e=new xt,i=0;i<t.length;i++){var s=t[i];if(2==s.length){var o=s[0],r=s[1];e.put(o,r)}}return e}getOrElse(t,e){return this.contains(t)?this.get(t):e}get(t){return this.store[t.toString()]}put(t,e){return this.store[t.toString()]=e}contains(t){return this.store.hasOwnProperty(t.toString())}remove(t){return!!this.contains(t)&&(delete this.store[t.toString()],!0)}clear(){this.store={}}}!function(t){let e;t.isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,t.zoomDelta=function(t,e=1.2,i=!0){let s=i?t.deltaY:t.deltaY*t.deltaFactor/100;return Math.pow(e,s)},function(t){t[t.CanvasEnter=0]="CanvasEnter",t[t.CanvasLeave=1]="CanvasLeave",t[t.Hover=2]="Hover",t[t.Tap=3]="Tap",t[t.ActionStart=4]="ActionStart",t[t.ActionMove=5]="ActionMove",t[t.ActionEnd=6]="ActionEnd",t[t.PanZoom=7]="PanZoom",t[t.DoubleClick=8]="DoubleClick",t[t.MomentumTranslate=9]="MomentumTranslate"}(e=t.InteractionType||(t.InteractionType={}));class i{constructor(t,e,i,s,o,r,n,a,h){this.type=t,this.interactionIdentifier=e,this.referenceInteraction=i,this.pageX=s,this.pageY=o,this.zoomTo=r,this.canvas=n,this.isTouch=a,this.isFirstPan=h,this.numTouches=0,i||(this.referenceInteraction=this),this.timestamp=Date.now()}dup(t){return new i(t,this.interactionIdentifier,this.referenceInteraction,this.pageX,this.pageY,this.zoomTo,this.canvas,this.isTouch,this.isFirstPan)}getReferenceBefore(t){let e=this.timestamp-t,i=this.referenceInteraction;for(;i.referenceInteraction.timestamp>e&&i!=i.referenceInteraction;)i=i.referenceInteraction;return i}getMostRecentTwoTouch(t){let e=this.timestamp-t,i=this.referenceInteraction;for(;i.numTouches<2&&i.referenceInteraction.timestamp>e&&i!=i.referenceInteraction;)i=i.referenceInteraction;return 2==i.numTouches?i:void 0}isMousePanEnd(){return this.type==e.ActionEnd&&this.referenceInteraction.type==e.ActionMove}shouldStopMouseMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.PanZoom}isTouchPanEnd(){return!!!this.getMostRecentTwoTouch(500)&&this.type==e.CanvasLeave&&this.referenceInteraction.type==e.PanZoom}shouldStopTouchMomentumPan(){return this.type==e.ActionStart||this.type==e.ActionMove||this.type==e.DoubleClick||this.type==e.Tap||this.type==e.CanvasEnter}}t.Interaction=i;class s{constructor(t,e,i){this.identifier=t,this.pageX=e,this.pageY=i}static from(t){return new s(t.identifier,t.pageX,t.pageY)}find(t){for(let e=0;e<t.length;e++){const i=t.item(e);if(i.identifier==this.identifier)return i}return null}distanceSqrTo(t){const e=this.pageX-t.pageX,i=this.pageY-t.pageY;return e*e+i*i}distanceTo(t){return Math.max(1,Math.sqrt(this.distanceSqrTo(t)))}isNull(){return this==t.NullTouch}}t.YoTouch=s,t.TouchSpaceRadiusPx=10,t.TouchSpaceRadiusSqrPx=t.TouchSpaceRadiusPx*t.TouchSpaceRadiusPx,t.TouchTimeBoxMs=300,t.DoubleTapRadiusPx=20,t.DoubleTapTimeMs=300,t.NullTouch=new s(null,0,0);let o=!1;try{let t=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("test",null,t)}catch(t){}t.AddEventListenerThirdArgForTouch=!!o&&{passive:!1}}(G||(G={})),function(t){t.MinScaleFactor=1/16,t.MaxScaleFactor=16,t.zoomStep=1.2,t.zoomToFitBackOff=.95,t.configure=function(e){e.MinScaleFactor&&(t.MinScaleFactor=e.MinScaleFactor),e.MaxScaleFactor&&(t.MaxScaleFactor=e.MaxScaleFactor),e.zoomStep&&(t.zoomStep=e.zoomStep),e.zoomToFitBackOff&&(t.zoomToFitBackOff=e.zoomToFitBackOff)},t.buttonFor=function(t){return 1&~t.buttons?2&~t.buttons?4&~t.buttons?"none":"middle":"right":t.ctrlKey?"right":"left"},t.addMovement=function(t,e,i){t.dx=e,t.dy=i}}(N||(N={}));class yt{constructor(t,e,i,s,o,r,n){this.pointerEvent=t,this.x=e,this.y=i,this.type=s,this.numTouches=o,this.down=r,this.root=n,this.isSynthetic=!1,this.button=N.buttonFor(this.pointerEvent),this.timestamp=Date.now()}isMouse(){return this.pointerEvent&&"mouse"==this.pointerEvent.pointerType}isTouch(){return!this.isMouse()}getPoint(){return new ot(this.x,this.y)}getRoot(){return this.root||this}sameXyAs(t){return this.x==t.x&&this.y==t.y}}class St{constructor(t){this.owner=t,this.dx=0,this.dy=0,this.scale=1}constrainTranslation(){}constrainScale(t){return t}quantizeOffset(){const t=window.devicePixelRatio||1;this.dx=Math.round(this.dx*t)/t,this.dy=Math.round(this.dy*t)/t}translateBy(t,e,i=!0){0==t&&0==e||(this.dx+=t,this.dy+=e,i&&this.constrainTranslation(),this.owner.invalidate())}setScaleAndOffset(t,e,i){this.scale=t,this.dx=e,this.dy=i,this.owner.invalidate()}zoomBy(t){1!=t&&this.zoomTo(this.scale*t)}zoomTo(t){this.scale!=t&&(this.scale=this.constrainScale(t),this.owner.invalidate())}zoomAboutBy(t,e,i){this.zoomAboutTo(t,e,this.scale*i)}zoomAboutTo(t,e,i){const s=(i=this.constrainScale(i))/this.scale;this.dx=t-(t-this.dx)*s,this.dy=e-(e-this.dy)*s,this.scale=i,this.constrainTranslation(),this.owner.invalidate()}transformEvent(t,e){const i=t.getRoot(),s=e?i:t;return new yt(t.pointerEvent,(s.x-this.dx)/this.scale,(s.y-this.dy)/this.scale,s.type,s.numTouches,t.down?this.transformEvent(t.down,e):void 0,i)}transformContext(t,e){e?t.context.setTransform(this.scale,0,0,this.scale,this.dx,this.dy):t.context.transform(this.scale,0,0,this.scale,this.dx,this.dy)}transformPoint(t){return new ot(this.scale*t.x+this.dx,this.scale*t.y+this.dy)}transformRect(t){return new nt(this.scale*t.left+this.dx,this.scale*t.top+this.dy,this.scale*t.right+this.dx,this.scale*t.bottom+this.dy)}inverseTransformPoint(t){return new ot((t.x-this.dx)/this.scale,(t.y-this.dy)/this.scale)}inverseTransformRect(t){return new nt((t.left-this.dx)/this.scale,(t.top-this.dy)/this.scale,(t.right-this.dx)/this.scale,(t.bottom-this.dy)/this.scale)}snapPointToCanvasPixels(t,e=.5,i=.5){return this.inverseTransformPoint(this.transformPoint(t).snap(e,i))}getScale(){return this.scale}getDxDy(){return new ot(this.dx,this.dy)}getDx(){return this.dx}getDy(){return this.dy}}class At extends St{constructor(t=1,e=1,i=!1){super(void 0),this.imageWidth=t,this.imageHeight=e,this.isQuantized=i,this.views=[],this.canvasPad=nt.zero(),this.stickyZoom=0,this.owner=this}constrainTranslation(){this.stickyZoom=0;const t=0*this.scale+this.dx,e=this.imageWidth*this.scale+this.dx,i=this.canvasWidth/2;t>i?this.dx-=t-i:e<i&&(this.dx-=e-i);const s=0*this.scale+this.dy,o=this.imageHeight*this.scale+this.dy,r=this.canvasHeight/2;s>r?this.dy-=s-r:o<r&&(this.dy-=o-r),this.isQuantized&&this.quantizeOffset()}getState(){return{dx:this.dx,dy:this.dy,scale:this.scale,stickyZoom:this.stickyZoom}}setState(t){this.dx=t.dx,this.dy=t.dy,this.scale=t.scale,this.stickyZoom=t.stickyZoom,this.owner.invalidate()}constrainScale(t){return this.stickyZoom=0,F.clamp(t,N.MinScaleFactor,N.MaxScaleFactor)}setCanvasPad(t,e,i,s){this.canvasPad.set(t,e,i,s)}canvasWidthInterior(){return this.canvasWidth-this.canvasPad.left-this.canvasPad.right}canvasHeightInterior(){return this.canvasHeight-this.canvasPad.top-this.canvasPad.bottom}canvasCenterX(){return this.canvasPad.left+.5*this.canvasWidthInterior()}canvasCenterY(){return this.canvasPad.top+.5*this.canvasHeightInterior()}canvasCenter(){return new ot(this.canvasCenterX(),this.canvasCenterY())}stopAllPanAnimations(){for(let t of this.views)t.stopPanAnimation()}visibleImageRect(){return this.inverseTransformRect(this.canvasRect()).intersectionWith(this.imageRect())}imageRect(){return new nt(0,0,this.imageWidth,this.imageHeight)}canvasRect(){return new nt(0,0,this.canvasWidth,this.canvasHeight)}zoomTo(t){this.zoomAboutTo(this.canvasCenterX(),this.canvasCenterY(),t)}centerImagePoint(t,e,i=!0){this.dx=this.canvasCenterX()-t*this.scale,this.dy=this.canvasCenterY()-e*this.scale,i&&this.quantizeOffset(),this.invalidate()}center(){this.centerImagePoint(.5*this.imageWidth,.5*this.imageHeight)}zoomToFit(){const t=Math.min(this.canvasHeightInterior()/this.imageHeight,this.canvasWidthInterior()/this.imageWidth)*N.zoomToFitBackOff;this.scale=this.constrainScale(t),this.center(),this.stickyZoom=1}fitRect(t){const e=Math.min(this.canvasHeightInterior()/t.height(),this.canvasWidthInterior()/t.width())*N.zoomToFitBackOff;this.scale=this.constrainScale(e);let i=t.center();this.centerImagePoint(i.x,i.y),this.stickyZoom=0}zoom1To1(){this.scale=1,this.center(),this.stickyZoom=2}dblClick(){switch(this.stickyZoom){case 0:case 2:this.zoomToFit();break;case 1:this.zoom1To1()}}register(t){this.views.push(t)}setCanvasSize(t,e,i){if(t!=this.canvasWidth||e!=this.canvasHeight||i){switch(this.canvasWidth>0&&(this.dx+=.5*(t-this.canvasWidth),this.dy+=.5*(e-this.canvasHeight)),this.canvasWidth=t,this.canvasHeight=e,this.stickyZoom){case 0:this.constrainTranslation();break;case 1:this.zoomToFit();break;case 2:this.zoom1To1()}this.invalidate(!0)}}setImageSize(t,e){if(t!=this.imageWidth||e!=this.imageHeight){switch(this.imageWidth=t,this.imageHeight=e,this.stickyZoom){case 0:this.constrainTranslation();break;case 1:this.zoomToFit();break;case 2:this.zoom1To1()}this.invalidate(!0)}}invalidate(t){for(let e of this.views)e.invalidate(t)}}class Pt{constructor(...t){this.children=[],this.transform=new St(this),this.visible=!0,this.fixedCoordinates=!1,this.handler=void 0,this.add(...t)}setView(t){this.view=t;for(let e of this.children)e.setView(t)}add(...t){this.children||(this.children=[]),this.children.push(...t);for(let e of t)e.parent=this,e.setView(this.view);return this}getPropagatedScale(){let t=this.transform.getScale();return this.parent&&(t*=this.parent.getPropagatedScale()),t}getScale(){return this.view.getScale()}onepix(){return this.view.onepix()}transformEvent(t){return this.transform.transformEvent(t,this.fixedCoordinates)}transformEventWithAncestors(t){return this.parent&&(t=this.parent.transformEventWithAncestors(t)),this.transformEvent(t)}transformContext(t){this.transform.transformContext(t,this.fixedCoordinates)}inFixedCoordinates(t,e){t.context.save(),this.transform.transformContext(t,!0),e(),t.context.restore()}inCanvasCoordinates(t,e){t.context.save(),t.context.resetTransform(),e(),t.context.restore()}drawTo(t){if(this.visible){t.context.save(),this.transformContext(t),this.drawInner(t);for(let e of this.children)e.drawTo(t);this.drawInnerAfterChildren(t),t.context.restore()}}toggleVisible(){this.setVisible(!this.visible)}setVisible(t){this.visible=t,this.view&&this.view.invalidate()}invalidate(t){this.visible&&this.view&&this.view.invalidate(t)}drawInner(t){}drawInnerAfterChildren(t){}moveHandlerWithPropagation(t){const e=this.transformEvent(t);if(this.children.length>0)for(let t=this.children.length-1;t>=0;t--){const i=this.children[t];if(i.visible){const t=i.moveHandlerWithPropagation(e);if(t)return t}}return this.moveHandler(e)}dblClick(t){return!0}moveHandler(t){if(this.handler&&this.handler.moveHandler(t))return this}mouseCursor(t){if(this.handler)return this.handler.mouseCursor(t)}}class Mt extends Pt{constructor(t){super(),this.camera=t,this.eventHistory=[],this.panPxPerMs=ot.zero(),this.panimationListeners=[],this.sumDelta=0,this.clickHandler=void 0,this.panAnimationFrame=()=>{if(!this.hasPanSpeed())return;this.timerId=void 0;let t=Date.now(),e=t-this.lastPanFrameAt;this.lastPanFrameAt=t;let i=this.camera.getDx(),s=this.camera.getDy();if(this.camera.translateBy(this.panPxPerMs.x*e,this.panPxPerMs.y*e),this.firePanimationListeners(this.camera.getDx()-i,this.camera.getDy()-s),t-this.lastPanInteraction.timestamp>150){let t=.003*e/this.panPxPerMs.length();t>=1?(this.panPxPerMs.setXy(0,0),this.camera.invalidate()):(this.panPxPerMs.plusEqualsScaled(-t,this.panPxPerMs),this.triggerPanAnimation())}else this.triggerPanAnimation()}}addPanimationListener(t){this.panimationListeners.push(t)}removePanimationListener(t){this.panimationListeners=this.panimationListeners.filter(e=>e!=t)}firePanimationListeners(t,e){for(let i of this.panimationListeners)i(t,e)}moveHandler(t){if(1==t.type)"left"==t.button&&this.camera.stopAllPanAnimations(),this.clickHandler&&(this.downEvent=t);else if(2==t.type){if(this.camera.stopAllPanAnimations(),t.down&&"left"==t.button){const e=t.getRoot();this.camera.translateBy(e.pointerEvent.dx,e.pointerEvent.dy)}this.clickHandler&&this.downEvent&&this.downEvent.button==t.button&&(this.sumDelta+=Math.hypot(t.pointerEvent.dx,t.pointerEvent.dy))}else 3==t.type&&(this.tryStartPanAnimation(t),this.clickHandler&&this.downEvent&&(this.clickHandler(this.downEvent,this.sumDelta,t),this.downEvent=void 0,this.sumDelta=0));return this.addEventToHistory(t),this}mouseCursor(t){return t?n.grab_closed:n.grab_open}stopPanAnimation(){this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0,this.lastPanFrameAt=void 0,this.panPxPerMs.setXy(0,0),this.lastPanInteraction=void 0,this.camera.invalidate())}tryStartPanAnimation(t){if(this.lastPanInteraction=t,Date.now()-this.lastPinchZoomAt<500)return;let e=this.panAnimationReferenceEvent(t.timestamp-100);if(e){let i=Math.max(10,t.timestamp-e.timestamp);if(i<500){let s=1;if(this.panPxPerMs.setXy((t.x-e.x)/i,(t.y-e.y)/i).capLength(1.75*Math.sqrt(s)),this.hasPanSpeed())return this.lastPanFrameAt=Date.now(),void this.triggerPanAnimation()}}}triggerPanAnimation(){this.timerId||(this.timerId=setTimeout(this.panAnimationFrame,10))}hasPanSpeed(){return 0!=this.panPxPerMs.lengthSqr()}panAnimationReferenceEvent(t){let e=this.eventHistory,i=e[e.length-1];if(2==i.type){for(let s=e.length-1;s>=0;s--){let o=e[s];if(2!=o.type)return i;if(i=o,i.timestamp<t)return i}return i}}addEventToHistory(t){let e=t.timestamp;for(this.eventHistory.push(t);this.eventHistory[0]&&e-this.eventHistory[0].timestamp>1e3;)this.eventHistory.shift()}}class kt{constructor(t,e,i){this.pointerId=t,this.pageX=e,this.pageY=i,this.pageXy=new ot(this.pageX,this.pageY)}}class Et{constructor(t,e){this.imageView=t,this.isParent=e,this.touchPointsMap=new Map,this.startPinchZoom=void 0}numTouches(){return this.touchPointsMap.size}dup(){let t=new Et(this.imageView,!1);for(let e of this.touchPointsMap.values())t.addOrUpdate(e);return t.pinchPageCenter=this.pinchPageCenter.dup(),t.pinchWidth=this.pinchWidth,t.pinchScale=this.pinchScale,t.pinchDxDy=this.pinchDxDy.dup(),t}addOrUpdate(t){let e=this.numTouches();this.touchPointsMap.set(t.pointerId,t);let i=this.numTouches();if(2==i){this.pinchPageCenter=ot.zero();for(let t of this.touchPointsMap.values())this.pinchPageCenter.plusEquals(t.pageXy);this.pinchPageCenter.timesEquals(.5),this.pinchWidth=0;for(let t of this.touchPointsMap.values())this.pinchWidth+=this.pinchPageCenter.distanceTo(t.pageXy);this.pinchWidth*=.5,this.pinchScale=this.imageView.getCamera().getScale(),this.pinchDxDy=this.imageView.getCamera().getDxDy()}this.isParent&&1==e&&2==i&&(this.startPinchZoom=this.dup())}remove(t){this.touchPointsMap.delete(t),this.numTouches()<2&&this.startPinchZoom&&(this.startPinchZoom=void 0)}}class Rt{constructor(t,e,i,s,o){this.camera=t,this.root=e,this.canvas=i,this.topText=s,this.bottomText=o,this.visible=!1,this.redrawTimeout=void 0,this.lastRedrawAt=0,this.redrawRequestedAt=0,this.highDpiRatio=1,this.countWheelDeltaMod120IsZero=void 0,this.countDeltaYisNotInteger=void 0,this.isDiscreteDevice=!0,this.mightBeDiscreteDevice=!0,this.lastX=0,this.lastY=0,this.touchPointList=new Et(this,!0),this.topTextMargin=20,this.mouseWheel=t=>{let e=h.cast(t.originalEvent);this.updateIsDiscrete(e);const i=G.zoomDelta(t,N.zoomStep,this.isDiscreteDevice),s=this.canvasXyFromPageXy(t);this.camera.stopAllPanAnimations(),this.camera.zoomAboutBy(s.canvasX,s.canvasY,i);let o=this.getStaticLastPointerEvent();o&&this.moveHandler(o),t.preventDefault()},this.touchStart=t=>{t.preventDefault()},this.touchMove=t=>{t.preventDefault()},this.touchEnd=t=>{t.preventDefault()},this.pointerDown=t=>{this.checkAddDxDy(t),this.touchPointList.addOrUpdate(new kt(t.pointerId,t.pageX,t.pageY)),1==this.touchPointList.numTouches()&&this.downHandler(t),t.isPrimary&&(this.lastPrimaryPointerEvent=t),t.stopPropagation()},this.pointerMove=t=>{this.checkAddDxDy(t),this.touchPointList.addOrUpdate(new kt(t.pointerId,t.pageX,t.pageY));let e=this.touchPointList.numTouches();if(e<=1)this.moveHandler(t),t.isPrimary&&(this.lastPrimaryPointerEvent=t);else if(2==e){let t=this.touchPointList.startPinchZoom.pinchPageCenter,e=this.canvasPointFromPagePoint(t),i=this.touchPointList.startPinchZoom.pinchWidth,s=this.touchPointList.startPinchZoom.pinchScale,o=this.touchPointList.pinchPageCenter,r=(this.canvasPointFromPagePoint(o),s*this.touchPointList.pinchWidth/i);this.getCamera().zoomAboutTo(e.x,e.y,r),this.clearLastPrimaryPointerEvent(),this.grabLayer.lastPinchZoomAt=Date.now()}t.stopPropagation()},this.pointerUp=t=>{this.checkAddDxDy(t),this.touchPointList.remove(t.pointerId),0==this.touchPointList.numTouches()&&this.upHandler(t),1==this.touchPointList.numTouches()&&this.clearLastPrimaryPointerEvent(),t.stopPropagation()},this.pointerCancel=this.pointerUp,this.pointerLeave=this.pointerUp,this.contextMenu=t=>{t.preventDefault(),t.stopPropagation()},this.dblClick=t=>{let e=!0;if(this.lastMoveEvent){let t=this.hit(this.lastMoveEvent);if(t){let i=t.transformEventWithAncestors(this.lastMoveEvent);e=t.dblClick(i)}}e&&this.camera.dblClick()},this.draw=()=>{if(this.redrawTimeout=void 0,this.lastRedrawAt=Date.now(),!this.visible)return;const t=this.canvas.context();t.clearAll(),this.root.drawTo(t),this.topText&&t.drawCenteredText(this.topText,this.topTextMargin),this.bottomText&&t.drawCenteredText(this.bottomText,this.canvas.logicalHeight()-20)},this.register(),this.grabLayer=new Mt(t),this.grabLayer.setView(this),e.setView(this),t.register(this),e.transform=t,this.canvas.element.setAttribute("touch-action","none")}getCamera(){return this.camera}isDown(){return!!this.downNode}nodeIsHit(t){return this.hitNode==t}nodeIsDown(t){return this.downNode==t}getScale(){return this.camera.getScale()}onepix(){return 1/this.getScale()}canvasWidth(){return this.canvas.width()}canvasHeight(){return this.canvas.height()}canvasWidthLogical(){return this.canvas.logicalWidth()}canvasHeightLogical(){return this.canvas.logicalHeight()}canvasRect(){return new nt(0,0,this.canvasWidth(),this.canvasHeight())}canvasRectLogical(){return new nt(0,0,this.canvasWidthLogical(),this.canvasHeightLogical())}setIsDark(t){this.canvas.$element.parent().toggleClass(n.dark_checker.name(),t)}setCanvasPad(t,e,i,s){this.camera.setCanvasPad(t,e,i,s)}deregister(){this.canvas.$element.off("mousewheel"),this.canvas.element.removeEventListener("touchstart",this.touchStart),this.canvas.element.removeEventListener("touchmove",this.touchMove),this.canvas.element.removeEventListener("touchend",this.touchEnd),this.canvas.element.removeEventListener("pointerdown",this.pointerDown),this.canvas.element.removeEventListener("pointermove",this.pointerMove),this.canvas.element.removeEventListener("pointerup",this.pointerUp),this.canvas.element.removeEventListener("pointercancel",this.pointerCancel),this.canvas.element.removeEventListener("pointerleave",this.pointerLeave),this.canvas.element.removeEventListener("contextmenu",this.contextMenu),this.canvas.element.removeEventListener("dblclick",this.dblClick)}register(){this.canvas.$element.mousewheel(this.mouseWheel),this.canvas.element.addEventListener("touchstart",this.touchStart,{passive:!1}),this.canvas.element.addEventListener("touchmove",this.touchMove,{passive:!1}),this.canvas.element.addEventListener("touchend",this.touchEnd,{passive:!1}),this.canvas.element.addEventListener("pointerdown",this.pointerDown),this.canvas.element.addEventListener("pointermove",this.pointerMove),this.canvas.element.addEventListener("pointerup",this.pointerUp),this.canvas.element.addEventListener("pointercancel",this.pointerCancel),this.canvas.element.addEventListener("pointerleave",this.pointerLeave),this.canvas.element.addEventListener("contextmenu",this.contextMenu),this.canvas.element.addEventListener("dblclick",this.dblClick)}getStaticLastPointerEvent(){if(this.lastPrimaryPointerEvent){let t=$.extend(!0,{},this.lastPrimaryPointerEvent);return N.addMovement(t,0,0),t}}getLastMoveEvent(){return this.lastMoveEvent}stopPanAnimation(){this.grabLayer.stopPanAnimation()}simulateMoveEvent(t){this.lastMoveEvent=void 0,this.lastPrimaryPointerEvent=void 0,this.checkAddMoveClass(this.hit(t)),this.lastMoveEvent=t,this.lastPrimaryPointerEvent=t.pointerEvent}canvasXyFromPageXy(t){const e=this.canvas.$element.offset();return{canvasX:t.pageX-e.left,canvasY:t.pageY-e.top}}canvasPointFromPagePoint(t){const e=this.canvas.$element.offset();return new ot(t.x-e.left,t.y-e.top)}sceneMoveEvent(t,e,i){const s=this.canvas.$element.offset();return new yt(t,t.pageX-s.left,t.pageY-s.top,e,this.touchPointList.numTouches(),i)}updateIsDiscrete(t){let e=t.wheelDelta||t.wheelDeltaY||t.wheelDeltaX,i=t.deltaY||t.deltaX||t.deltaZ,s=t.deltaMode;if(void 0!==i){let t=!Number.isInteger(i);void 0===this.countDeltaYisNotInteger?this.countDeltaYisNotInteger=t?Rt.ThreshDeltaIsNotInteger:0:t?this.countDeltaYisNotInteger++:this.countDeltaYisNotInteger=0}if(void 0===e){let t=0===s;this.mightBeDiscreteDevice=this.isDiscreteDevice=!t}else{let t=Math.abs(e)%120==0;void 0===this.countWheelDeltaMod120IsZero?this.countWheelDeltaMod120IsZero=t?Rt.ThreshWheelDeltaMod120IsZero:0:t?this.countWheelDeltaMod120IsZero++:this.countWheelDeltaMod120IsZero=0,this.countWheelDeltaMod120IsZero>=Rt.ThreshWheelDeltaMod120IsZero?this.mightBeDiscreteDevice=this.isDiscreteDevice=!0:G.isMac?this.mightBeDiscreteDevice=this.isDiscreteDevice=this.countDeltaYisNotInteger>=Rt.ThreshDeltaIsNotInteger:(this.isDiscreteDevice=!1,this.mightBeDiscreteDevice=t)}}checkAddDxDy(t){this.lastPrimaryPointerEvent?N.addMovement(t,t.pageX-this.lastPrimaryPointerEvent.pageX,t.pageY-this.lastPrimaryPointerEvent.pageY):N.addMovement(t,t.movementX||0,t.movementY||0)}clearLastPrimaryPointerEvent(){this.lastPrimaryPointerEvent=void 0}hit(t){return this.hitNode=this.root.moveHandlerWithPropagation(t)||this.grabLayer.moveHandler(t)}checkAddClass(t){t&&this.canvas.$element.addClass(t.name())}checkRemoveClass(t){t&&this.canvas.$element.removeClass(t.name())}removeMoveClass(){this.checkRemoveClass(this.moveClass),this.moveClass=void 0}checkAddMoveClass(t){let e;t&&(e=t.mouseCursor(!1)),this.moveClass!=e&&(this.removeMoveClass(),this.checkAddClass(this.moveClass=e))}downHandler(t){if(this.moveHandler(t),this.downNode=this.hitNode,this.downNode){this.canvas.element.setPointerCapture(t.pointerId),this.downEvent=this.sceneMoveEvent(t,1);let e=this.sceneMoveEvent(t,1,this.downEvent);e=this.downNode.transformEventWithAncestors(e),this.downNode.moveHandler(e),n.body.$().addClass(n.noselect.name()),this.removeMoveClass(),this.downClass=this.downNode.mouseCursor(!0),this.downClass&&n.body.$().addClass(this.downClass.name())}}moveHandler(t){if(this.lastX=t.pageX,this.lastY=t.pageY,this.downNode){let e=this.sceneMoveEvent(t,2,this.downEvent);e=this.downNode.transformEventWithAncestors(e),this.downNode.moveHandler(e)}else this.lastMoveEvent=this.sceneMoveEvent(t,0),this.checkAddMoveClass(this.hit(this.lastMoveEvent))}upHandler(t){if(this.downNode){this.canvas.element.releasePointerCapture(t.pointerId),n.body.$().removeClass(n.noselect.name()),this.downClass&&n.body.$().removeClass(this.downClass.name()),this.downEvent=void 0,this.downNode=void 0,this.downClass=void 0;const e=this.sceneMoveEvent(t,3);this.checkAddMoveClass(this.hit(e))}else this.moveHandler(t)}invalidate(t){this.visible&&(t?(clearTimeout(this.redrawTimeout),this.draw()):this.redrawTimeout||(this.redrawRequestedAt=Date.now(),this.redrawTimeout=window.requestAnimationFrame(this.draw)))}invalidateMouseCursor(){if(this.visible)if(this.downNode){const t=this.downNode.mouseCursor(!0);t!=this.downClass&&(this.downClass&&n.body.$().removeClass(this.downClass.name()),this.downClass=t,this.downClass&&n.body.$().addClass(this.downClass.name()))}else this.lastMoveEvent&&this.checkAddMoveClass(this.hit(this.lastMoveEvent))}show(){this.visible||(this.visible=!0,this.invalidate(),this.canvas.$element.show())}checkSetSize(t,e){this.highDpiRatio=window.devicePixelRatio||1;const i=this.canvas.checkSetSize(t,e,this.highDpiRatio);this.camera.setCanvasSize(t,e,i)}hide(){this.visible=!1,this.canvas.$element.hide()}directDraw(t,e){t.save(),t.context.setTransform(this.highDpiRatio,0,0,this.highDpiRatio,0,0),e(t),t.restore()}}Rt.ThreshWheelDeltaMod120IsZero=3,Rt.ThreshDeltaIsNotInteger=3;class Tt extends Pt{constructor(t,e){super(),this.imageCanvas=t,this.handler=e}setImageCanvas(t){this.imageCanvas=t,this.invalidate()}drawInner(t){this.imageCanvas&&t.drawCanvasEx(this.imageCanvas,0,0)}}!function(t){t.TileWh=1024;const e=[];let i,s,o=[],r=-1,n=-1,a=-1,h=-1,l=-1,c=!1;class u{constructor(){this.canvas=new ht(t.TileWh,t.TileWh)}}class d{constructor(t,e,i){this.tx=t,this.ty=e,this.bounds=i,this.physicalTile=void 0,this.visible=!1}assign(e){this.physicalTile=e,e.owner&&(e.owner.physicalTile=void 0),e.owner=this;try{const i=e.canvas.context().context;i.resetTransform(),i.clearRect(0,0,t.TileWh,t.TileWh);const o=new B.RenderSpec(l,this.bounds);i.scale(l,l),i.translate(-this.bounds.left,-this.bounds.top),c?s.drawOutlinesTo(i,o):s.drawTo(i,o)}catch(t){}}}t.render=function(p,m,g,f){if(!p||!m||!g)return;const b=new B.RenderSpec(g.getScale(),g.visibleImageRect());if(m!=s||b.scale!=l||f!=c){s=m,l=b.scale,c=f,o=[];for(let t of e)t.owner=void 0;r=Math.ceil(m.imageWidth*l),n=Math.ceil(m.imageHeight*l),i=nt.ofSize(0,0,r,n),a=Math.ceil(r/t.TileWh),h=Math.ceil(n/t.TileWh);for(let e=0;e<h;e++)for(let i=0;i<a;i++){const s=new d(i,e,nt.ofSize(i*t.TileWh,e*t.TileWh,t.TileWh,t.TileWh).scale(1/l));o.push(s)}const p=g.canvasRect(),w=Math.ceil(p.width()/t.TileWh)*Math.ceil(p.height()/t.TileWh),v=Math.max(2,2*w);for(;e.length<v;)e.push(new u)}let w=[],v=[];for(let t of o)t.visible=t.bounds.intersects(b.visibleImageRect),t.visible&&!t.physicalTile?v.push(t):!t.visible&&t.physicalTile&&w.push(t);let C=e.filter(t=>!t.owner);for(let t of v)if(C.length>0)t.assign(C.pop());else if(w.length>0)t.assign(w.pop().physicalTile);else{let i=new u;e.push(i),t.assign(i)}for(let t of o)if(t.visible){const e=t.physicalTile;p.drawCanvasEx2(e.canvas,t.bounds.left,t.bounds.top,t.bounds.width(),t.bounds.height())}}}(z||(z={}));class It extends Pt{constructor(){super(...arguments),this.progress0to100=0,this.errorMessageTr=void 0}setProgress(t){this.errorMessageTr=void 0,this.progress0to100=t,this.fixedCoordinates=!0,this.invalidate()}setFailedToLoad(t){this.errorMessageTr=t,this.fixedCoordinates=!0,this.invalidate()}drawProgress(t){const e=t.context.canvas.width,i=t.context.canvas.height,s=Math.min(125,e/2),o=Math.floor(.5*(i-10)),r=Math.floor(.5*(e-s));this.errorMessageTr?t.drawCenteredText(this.errorMessageTr,i/2):(t.setLineWidth(2),t.setLineCap("round"),t.setStrokeStyle("#265a88"),t.strokeRect(r,o,s,10),t.setFillStyle("#FFF"),t.fillRect(r,o,s,10),t.setFillStyle("#337ab7"),t.fillRect(r,o,s*this.progress0to100*.5/100,10))}}class Ft extends It{constructor(t){super(),this.handler=t}setProgress(t){this.imageCanvas=void 0,super.setProgress(t)}setFailedToLoad(t){this.imageCanvas=void 0,super.setFailedToLoad(t)}setImageCanvas(t){this.imageCanvas=t,t?this.fixedCoordinates=!1:this.setProgress(0),this.invalidate()}hasImageCanvas(){return null!=this.imageCanvas}xyToK(t,e){return this.imageCanvas.width()*e+t}drawInner(t){this.imageCanvas?t.drawCanvasEx(this.imageCanvas,0,0):this.drawProgress(t)}}class Ot extends It{constructor(t,e){super(),this.result=t,this.imageCanvas=e,this.showBitmapAndOutlines=!1}setImageCanvas(t){this.imageCanvas=t,this.invalidate()}setResult(t){this.result=t,this.result&&(this.fixedCoordinates=!1),this.invalidate()}setProgress(t){this.result=void 0,super.setProgress(t)}setShowBitmapAndOutlines(t){this.showBitmapAndOutlines=t,this.invalidate()}drawInner(t){if(this.result){new B.RenderSpec(this.getPropagatedScale(),this.view.getCamera().visibleImageRect());this.showBitmapAndOutlines?(this.imageCanvas&&t.drawCanvasEx(this.imageCanvas,0,0),z.render(t,this.result,this.view.getCamera(),!0)):z.render(t,this.result,this.view.getCamera(),!1)}else this.drawProgress(t)}drawLoupe(t,e){this.imageCanvas&&t.drawCanvasEx(this.imageCanvas,0,0);const i=new B.RenderSpec(this.getPropagatedScale(),e);this.result.drawOutlinesTo(t.context,i)}}class _t extends Pt{constructor(...t){super(...t),this.lastMove=void 0,this.lastMoveListener=void 0}getLastMove(t){return t?this.view.isDown()||this.otherView.isDown()?t:this.transformEventWithAncestors(t.getRoot()):void 0}drawInnerAfterChildren(t){const e=this.getLastMove(this.lastMove);if(e){const i=t.context;i.beginPath();let s=this.view.getCamera().getScale(),o=20/s;i.arc(e.x-o,e.y-o,o,0,2*Math.PI,!1),i.lineWidth=3/s,i.strokeStyle="#FFF",i.stroke(),i.lineWidth=1/s,i.strokeStyle="#000",i.stroke()}}moveHandler(t){this.lastMoveListener&&this.lastMoveListener(t)}}class Dt extends _t{constructor(t){super(t),this.vector=t,this.showingVector=!0,this.lastLoupe=void 0,this.showBitmap=()=>{this.view.topText=u.s("Original Image"),this.vector.setShowBitmapAndOutlines(!0),this.showingVector=!1},this.showVector=()=>{this.view.topText=u.s("Vectorizer.AI Result"),this.vector.setShowBitmapAndOutlines(!1),this.showingVector=!0}}drawInnerAfterChildren(t){super.drawInnerAfterChildren(t);const e=this.getLastMove(this.lastLoupe);let i=this.view.getCamera().getScale();if(this.showingVector&&e&&this.vector.result&&this.vector.imageCanvas&&i>=L.LoupeCutoffScale){let s,o,r=1+1.5*(i-L.LoupeCutoffScale)/(N.MaxScaleFactor-L.LoupeCutoffScale),n=r*L.LoupeRadius/i;if(e.isMouse())s=e.x-3*n/4,o=e.y-3*n/4;else{if("none"==e.button)return;let t=this.view.getCamera(),i=t.inverseTransformPoint(t.canvasCenter());s=i.x,o=i.y}if(!isFinite(s)||!isFinite(o)||!isFinite(n))throw new Error("Loupe: x: "+s+", y: "+o+", r: "+n+", s: "+i+", rs: "+r+", mx: "+e.x+", my: "+e.y+", mb: "+e.button+", mim: "+e.isMouse());let a=new nt(s-n,o-n,s+n,o+n),h=1.2,l=(e,i)=>{let r=t.context.createRadialGradient(s,o,0,s,o,h*n);return r.addColorStop(0,e),r.addColorStop(1/h,e),r.addColorStop(1/h,i),r.addColorStop(1,e),r};t.beginPath(),t.arc(s,o,h*n,0,2*Math.PI,!1),t.setFillStyle(l("rgba(0,255,255,0)","rgba(0,255,255,0.5)")),t.fill(),t.save(),t.beginPath(),t.arc(s,o,n,0,2*Math.PI,!1),t.clip(),t.clearRect(a.left,a.top,a.width(),a.height()),this.vector.drawLoupe(t,a),t.restore(),t.beginPath(),t.arc(s,o,n,0,2*Math.PI,!1),t.setLineWidth(this.vector.result.outlineWidth(i)),t.setStrokeStyle("#0FF"),t.stroke()}}}function Bt(t,e){if(e)try{self.postMessage(t,e)}catch(e){self.postMessage(t)}else self.postMessage(t)}!function(t){const e=300,i=new mt(1,1,1,1),s=new mt;let o,r,a,h,l=0,c=!1,d=[],p=null,m=null,g=null,f=-1,b=null,w=!1,v=new Set,C=null,x=null;function y(t){const e=new Set,i=new mt;for(let s of t){const t=s.output.rgb;i.setArgb(t.alpha,t.r,t.g,t.b),e.add(i.toArgbInt())}return e.size}function S(){let t;if(m){if(h){let e=h.getCurrent();if(e.isPreset())t={maxColors:e.getMaxColorsForProcessingOptions(),palette:[]};else{let i=[];for(let t of e.inputColors)i.push(t.toPaletteColorSpec());t={maxColors:e.inputColors.length,palette:i}}}else t={maxColors:f,palette:[]};JSON.stringify(g.processingOptions)!=JSON.stringify(t)&&m.setProcessingOptions(t)}}function P(t){R()}function M(){c||(c=!0,F.modal(n.App.SubApps.LightBox),R(),n.$window.on("resize.PaletteApp",k),k(),o.zoomToFit())}function k(){r.checkSetSize(n.App.SubApps.View.$().width(),n.App.SubApps.View.$().height())}function E(){c&&(c=!1,n.App.SubApps.LightBox.$().modal("hide"),n.$window.off(".PaletteApp"))}function R(){if(c&&(1==l&&function(){if(m&&m.spec){l=2;let t={url:"/images/"+m.spec.token+"/paletteIndexMap",displayUrl:"Palette Preview",progress:a.setProgress.bind(a),error:t=>{l=4,a.setFailedToLoad(u.s("Failed to fetch the palette preview, you may need to re-generate your result. "))},success:t=>{t.arrayBuffer().then(t=>{p=t,g&&g.palette.setPaletteIndexMap(p),l=3,O()})}};A.download(t)}}(),m.result&&m.result!=g)){for(g=m.result,g.palette.setPaletteIndexMap(p),f=g.palette.chosenNumColors;d.length<g.palette.length;)d.push(new L(d.length));for(let t=0;t<g.palette.length;t++)d[t].setColor(g.palette.get(t));h||(h=new U),O()}}function T(t){h.getPreset(t,!0)}function I(){clearTimeout(b),b=null,O()}function O(){if(g){for(let t=0;t<g.palette.length;t++)d[t].updateClasses();w?a.setImageCanvas(m.img):b||(b=setTimeout(()=>{const t=h.getCurrent().toPaletteMap(),e=g.palette.getCanvas(t,v);e&&a.setImageCanvas(e),b=null},1)),function(){let t=f;if(h){let e=h.getCurrent();e&&(t=e.numVisibleOutputColors())}n.App.SubApps.Toolbar.NumColors.$().text(""+t)}()}}function _(){g&&(h&&(h.hasSelection()&&h.rejectEdits(),h.undoAllTheWay()),S()),E()}function D(){g&&(h&&(h.hasSelection()&&h.acceptEdits(),h.clearUndoStack()),S()),E()}function B(){return f}t.countNumDistinctColorsInPalette=y,t.clearOnDropTwice=function(){h&&(h.clearSelection(),h.clearView(),h=void 0)},t.setCurrentModel=function(t){for(0==l&&function(){l=1,n.App.SubApps.Exit.$().click(_),n.App.Toolbar.Palette.$().click(M),n.App.SubApps.Palette.Cancel.$().click(_),n.App.SubApps.Palette.Ok.$().click(D);const t=n.App.SubApps.Palette.ColorEditor.ColorInput.$(),e=n.App.SubApps.Palette.ColorEditor.OpacityInput.$(),i=n.App.SubApps.Palette.ColorEditor.IncludeInput.$();t.on("input",function(){h&&h.onColorChanged()}),e.on("input",function(){h&&h.onOpacityChanged()}),i.on("input",function(){h&&h.onIncludeChanged()}),t.add(e).add(i).on("focus",function(){h&&h.onColorFocus()}),n.App.SubApps.Toolbar.Close.$().click(_),n.App.SubApps.Toolbar.Accept.$().click(D),n.App.SubApps.Toolbar.Undo.$().click(function(){h&&h.undo()}),n.App.SubApps.Toolbar.Redo.$().click(function(){h&&h.redo()}),n.App.SubApps.Palette.ColorEditor.RevertButton.$().click(function(){h&&h.revertColor()}),n.App.SubApps.Palette.ColorEditor.CloseButton.$().click(function(){h&&h.rejectEdits()}),n.App.SubApps.Palette.ColorEditor.AcceptButton.$().click(function(){h&&h.acceptEdits()}),$(window).resize(()=>{h&&(h.invalidateViews(),h.updateView(!0))}),o=new At(1,1,!0);const s=new ht(1,1);n.App.SubApps.View.$().append(s.element),a=new Ft;let c=new Pt(a);r=new Rt(o,c,s),r.grabLayer.clickHandler=(t,e,i)=>{if(a.hasImageCanvas()&&e<5){let e=o.transformEvent(t,!1),i=Math.floor(e.x),s=Math.floor(e.y),r=a.xyToK(i,s),n=g.palette.paletteIndexAt(r);void 0!==n&&h.clickInputColorIdx(n)}},r.show(),r.topText=x=u.s("Palette Preview"),C=u.s("Original Image"),r.topTextMargin=30,new Ct(n.App.SubApps.Toolbar.ZoomIn.$(),function(){o.zoomBy(N.zoomStep)},50,1),new Ct(n.App.SubApps.Toolbar.ZoomOut.$(),function(){o.zoomBy(1/N.zoomStep)},50,1),n.App.SubApps.Toolbar.ZoomToFit.$().click(function(){o.zoomToFit()})}(),l=1;d.length>0;)d.pop().remove();a.setImageCanvas(null),p=null,g=null,f=-1,m&&m.removeListener(P),m=t,m.addListener(P),o.setImageSize(m.img.width(),m.img.height()),o.zoomToFit(),r.bottomText=m.label,v.clear(),h&&(h.clearSelection(),h=void 0)},t.show=M,t.keyUpHandler=function(t){if(!c)return!1;switch(t.keyCode){case 66:w=!1,r.topText=x,I();break;case 90:t.ctrlKey&&(t.shiftKey?h&&h.redo():h&&h.undo())}return!0},t.keyDownHandler=function(t){if(!c)return!1;switch(t.keyCode){case 27:_();break;case 13:D();break;case 37:f>2&&(f--,T(f),O());break;case 39:f<g.palette.length&&(f++,T(f),O());break;case 66:w=!0,r.topText=C,I();break;case 36:o.zoomToFit();break;case 35:o.zoom1To1();break;case 33:o.zoomBy(1.2);break;case 34:o.zoomBy(1/1.2)}return!0};class L{constructor(t){this.idx=t,this.$wrapper=$("<div>").addClass(n.App.SubApps.Palette.swatch.name()),this.$outer=$("<div>"),0==t||this.$wrapper.dblclick(()=>{D()}).click(()=>{!function(t){h&&h.acceptEdits(),f=t+1,T(f),O()}(t)}),this.$middle=$("<div>").addClass(n.canvas_container.name()),this.$inner=$(`<div><span>${t+1}</span></div>`),this.$wrapper.append(this.$outer),this.$outer.append(this.$middle),this.$middle.append(this.$inner),n.App.SubApps.Palette.presets_container.$().append(this.$wrapper)}remove(){this.$wrapper.remove()}setColor(t){const e=(new mt).setArgbInt(t.argb);let i=e.grayscale()>.5?"#000":"#FFF";this.$inner.css("background-color",e.toCssAuto()),this.$outer.attr("title",e.toCssAutoHex()+"\n"+u.s("Keyboard: Left & Right")).css("color",i)}updateClasses(){this.$wrapper.toggleClass(n.App.SubApps.Palette.chosen.name(),this.isChosen()).toggleClass(n.App.SubApps.Palette.recommended.name(),this.isRecommended()).toggleClass(n.App.SubApps.Palette.active.name(),this.isActive())}isActive(){if(h){const t=h.getCurrent();return t&&void 0!==t.presetNumColors&&t.presetNumColors>=this.idx+1}return this.idx<B()}isChosen(){if(h){const t=h.getCurrent();return t&&void 0!==t.presetNumColors&&t.presetNumColors==this.idx+1}return this.idx==B()-1}isRecommended(){return this.idx==g.palette.recommendedNumColors-1}}class G{constructor(t,e,i,s,o){this.tooltipLabel=i,this.modelSet=o,this.selected=!1,this.dragging=!1,this.pointerStart=ot.zero(),this.mousePosition=ot.zero(),this.deltaMousePosition=ot.zero(),this.maxAbsDeltaMousePosition=ot.zero(),this.group=o.circles.append("g").attr("transform",`translate(${e.x}, ${e.y})`).classed(s.map(t=>t.name()).join(" "),!0),this.title=this.group.append("title"),this.checkerCircle=this.group.append("circle").classed(n.App.SubApps.Palette.Editor.checker.name(),!0).attr("cx",0).attr("cy",0).attr("r",t.radius-1).attr("fill","url(#checkerboard)"),this.colorCircle=this.group.append("circle").classed(n.App.SubApps.Palette.Editor.fill.name(),!0).attr("cx",0).attr("cy",0).attr("r",t.radius).attr("fill",t.rgba.toCssRgba()),this.selectorCircle=this.group.append("circle").classed(n.App.SubApps.Palette.Editor.selector.name(),!0).attr("cx",0).attr("cy",0).attr("r",t.radius).attr("fill","none"),this.bindColor(t),this.group.on("touchstart",this.onTouchDiscard.bind(this)).on("touchmove",this.onTouchDiscard.bind(this)).on("touchend",this.onTouchDiscard.bind(this)).on("pointerdown",this.onPointerDown.bind(this)).on("pointermove",this.onPointerMove.bind(this)).on("pointerup",this.onPointerUp.bind(this))}toString(){return this.boundColor?this.boundColor.toString():"undefined"}getDisplayPosition(){const t=this.group.attr("transform"),e=/translate\(([^,]+),\s*([^)]+)\)/.exec(t);let i=0,s=0;return e&&(i=parseFloat(e[1]),s=parseFloat(e[2])),new ot(i,s)}getDisplayRadius(){let t=parseFloat(this.selectorCircle.attr("r"));return Number.isFinite(t)?t:this.boundColor?this.boundColor.radius:1}svgWidth(){return this.modelSet.svgWidth()}svgHeight(){return this.modelSet.svgHeight()}updateMousePosition(t){const e=this.modelSet.svg.node(),i=e.createSVGPoint();i.x=t.clientX,i.y=t.clientY;const s=i.matrixTransform(e.getScreenCTM().inverse());this.mousePosition.set(s)}updateMaxAbsDeltaMousePosition(){this.maxAbsDeltaMousePosition.setXy(Math.max(this.maxAbsDeltaMousePosition.x,Math.abs(this.deltaMousePosition.x)),Math.max(this.maxAbsDeltaMousePosition.y,Math.abs(this.deltaMousePosition.y)))}onTouchDiscard(t){t.preventDefault()}onPointerDown(t){if(d3.active(this.group.node()))return;this.raise(),t.preventDefault();this.selectorCircle.node().setPointerCapture(t.pointerId),this.updateMousePosition(t),this.pointerStart.set(this.mousePosition),this.maxAbsDeltaMousePosition.setXy(0,0),this.dragging=!0}onPointerMove(t){if(this.dragging&&(this.updateMousePosition(t),this.deltaMousePosition.set(this.mousePosition).minusEquals(this.pointerStart),this.updateMaxAbsDeltaMousePosition(),this.offset(this.deltaMousePosition.dup()),this.maxAbsDeltaMousePosition.length()>=3)){this.group.attr("opacity",.5);const t=this.modelSet.findColorViewAtPosition(this.mousePosition,this);this.modelSet.onTargetHoverColor(this,t,this.mousePosition,this.getDisplayPosition())}}onPointerUp(t){this.group.attr("opacity",1),this.updateMousePosition(t),this.deltaMousePosition.set(this.mousePosition).minusEquals(this.pointerStart),this.updateMaxAbsDeltaMousePosition(),this.dragging=!1;this.selectorCircle.node().releasePointerCapture(t.pointerId),this.maxAbsDeltaMousePosition.x<3&&this.maxAbsDeltaMousePosition.y<3?this.modelSet.clickColor(this):(this.modelSet.clearOnTargetHover(),this.onDrop(t))}onDrop(t){const e=this.modelSet.findColorViewAtPosition(this.mousePosition,this);this.modelSet.targetIsValid(this,e,this.mousePosition,this.getDisplayPosition())&&(this.modelSet.acceptEdits(),O()),this.modelSet.onDropColor(this,e,this.mousePosition)}setSelected(t){this.selected=t,this.group.classed(n.App.SubApps.Palette.Editor.selected.name(),t)}isSelected(){return this.selected}setColor(t,e=!0){this.boundColor.rgba.setFrom(t),e&&this.colorCircle.attr("fill",t.toCssRgba()),this.boundColor.updatePcaVector()}setAlpha(t){this.boundColor.rgba.a=t,this.colorCircle.attr("fill",this.boundColor.rgba.toCssRgba()),this.boundColor.updatePcaVector()}bindColor(t){var e,i;this.boundColor=t,this.title.text((e=this.tooltipLabel,i=this.boundColor.rgba,e+"\n"+i.toCssAutoHex()+"\n"+i.toCssAutoRgb()))}animateToBoundColor(){this.group.interrupt(),this.checkerCircle.interrupt(),this.colorCircle.interrupt();const t=this.getCenter();"none"==this.group.attr("display")?this.group.attr("transform",`translate(${t.x}, ${t.y})`).attr("display","inline"):this.group.transition().duration(e).attr("transform",`translate(${t.x}, ${t.y})`),this.checkerCircle.transition().duration(e).attr("opacity",1).attr("r",this.boundColor.radius-1),this.colorCircle.transition().duration(e).attr("opacity",1).attr("r",this.boundColor.radius).attr("fill",this.boundColor.rgba.toCssRgba()),this.selectorCircle.transition().duration(e).attr("opacity",1).attr("r",this.boundColor.radius)}}class z extends G{constructor(t,e){super(t,t,"Output Color:",[n.App.SubApps.Palette.Editor.outer_color],e),this.checkerCircle.attr("filter",`url(#${n.App.SubApps.Palette.Editor.OuterColorShadow.name()})`)}forEachInputColorView(t){for(let e of this.boundColor.inputColors)t(e.boundView)}raise(){this.group.raise(),this.forEachInputColorView(t=>t.raise())}offset(t){const e=this.svgWidth(),i=this.svgHeight(),s=this.getDisplayRadius(),o=this.boundColor.dup().plusEquals(t),r=F.clamp(o.x,s,e-s),n=F.clamp(o.y,s,i-s);t.setXy(r-this.boundColor.x,n-this.boundColor.y),this.group.attr("transform",`translate(${r}, ${n})`),this.forEachInputColorView(e=>e.offset(t))}getCenter(){return this.boundColor}addHighlightColors(){this.boundColor&&this.boundColor.inputColors&&this.boundColor.inputColors.forEach(t=>{v.add(t.idx)})}hide(){this.group.interrupt(),this.checkerCircle.interrupt(),this.colorCircle.interrupt(),this.boundColor&&(this.boundColor.boundView=void 0),this.boundColor=void 0,this.checkerCircle.transition().duration(e).attr("opacity",0).attr("r",0),this.colorCircle.transition().duration(e).attr("opacity",0).attr("r",0),this.selectorCircle.transition().duration(e).attr("r",0),this.group.transition().duration(e).on("end",()=>{this.group.attr("display","none")})}set(t){this.bindColor(t),t.boundView=this,this.animateToBoundColor()}}class W extends G{constructor(t,e){super(t,t.outputColor.dup().plusEquals(t),"Input Color:",[n.App.SubApps.Palette.Editor.inner_color],e),this.checkerCircle.attr("filter",`url(#${n.App.SubApps.Palette.Editor.InnerColorShadowLight.name()})`)}isSingleton(){return 1==this.boundOutputColor.inputColors.length}outputColorView(){return this.boundOutputColor.boundView}raise(){this.group.raise()}hide(){this.group.interrupt(),this.checkerCircle.interrupt(),this.colorCircle.interrupt(),this.group.attr("transform","translate(-1000, -1000)")}offset(t){const e=this.svgWidth(),i=this.svgHeight(),s=this.getDisplayRadius(),o=this.boundOutputColor.dup().plusEquals(this.boundColor).plusEquals(t),r=F.clamp(o.x,s,e-s),n=F.clamp(o.y,s,i-s);t.setXy(r,n).minusEquals(this.boundOutputColor).minusEquals(this.boundColor),this.group.attr("transform",`translate(${r}, ${n})`)}getCenter(){return this.boundColor.dup().plusEquals(this.boundOutputColor)}addHighlightColors(){this.boundColor&&v.add(this.boundColor.idx)}set(t,e){this.bindColor(t),this.boundOutputColor=e,t.boundView=this,this.group.classed(n.App.SubApps.Palette.Editor.dark.name(),!1).classed(n.App.SubApps.Palette.Editor.light.name(),!1).attr("filter",e.lightDarkFilterUrl(t.rgba)),this.raise(),this.animateToBoundColor()}}class U{constructor(){this.presetModels=[],this.undoStack=[],this.redoStack=[],this.inputColorViews=[],this.outputColorViews=[],this.selectedInputColor=void 0,this.selectedOutputColor=void 0,this.undoRgba=new mt,this.updateViewOnColorChangeTimeoutId=-1,this.modelMax=this.getPreset(g.palette.length,!1);const t=this.modelMax.width,e=this.modelMax.height;this.svg=d3.create("svg").attr("width",t).attr("height",e).attr("viewBox",`0 0 ${t} ${e}`).attr("xmlns","http://www.w3.org/2000/svg"),this.defs=this.svg.append("defs"),this.defs.append("pattern").attr("id","checkerboard").attr("patternUnits","userSpaceOnUse").attr("width",16).attr("height",16).append("image").attr("href","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+CiAgPHBhdGggZmlsbD0iI2RlZGVkZSIgZD0iTTAgMGg4djhIMHpNOCA4aDh2OEg4eiIvPgogIDxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik04IDBoOHY4SDh6TTAgOGg4djhIMHoiLz4KPC9zdmc+Cg==").attr("width",16).attr("height",16),this.addDropShadow(n.App.SubApps.Palette.Editor.OuterColorShadow,3,3,4,"black",.4),this.addDropShadow(n.App.SubApps.Palette.Editor.InnerColorShadowLight,2,2,1.5,"black",.2),this.addDropShadow(n.App.SubApps.Palette.Editor.InnerColorShadowDark,2,2,1.5,"white",.4),this.svg.append("rect").attr("width","100%").attr("height","100%").attr("fill","#FFF").on("click",()=>{this.clickColor(void 0)}),this.circles=this.svg.append("g");for(let t of this.modelMax.outputColors){const e=new z(t,this);this.outputColorViews.push(e)}for(let t of this.modelMax.inputColors){const e=new W(t,this);this.inputColorViews.push(e)}this.overlays=this.svg.append("g"),this.plus=this.overlays.append("g").attr("display","none");this.plus.append("circle").attr("cx",0).attr("cy",0).attr("r",7).attr("fill","#0A0"),this.plus.append("rect").attr("fill","#fff").attr("x",-4).attr("y",-1).attr("width",8).attr("height",2),this.plus.append("rect").attr("fill","#fff").attr("x",-1).attr("y",-4).attr("width",2).attr("height",8),n.App.SubApps.Palette.Editor.Container.$().empty().append(this.svg.node()),this.modelMax.invalidateView();const i=g.processingOptions;if(i.palette.length>0){const t=y(i.palette),e=new q(this,g,t);e.setFromPalette(i.palette),this.setCurrent(e)}else this.getPreset(f,!0);this.getCurrent().invalidateView(),this.updateView(!0)}addDropShadow(t,e,i,s,o,r){this.defs.append("filter").attr("id",t.name()).attr("x","-20%").attr("y","-20%").attr("width","160%").attr("height","160%").attr("filterUnits","objectBoundingBox").append("feDropShadow").attr("dx",e).attr("dy",i).attr("stdDeviation",s).attr("flood-color",o).attr("flood-opacity",r)}findColorViewAtPosition(t,e){for(let i of this.outputColorViews){if(i===e||!i.boundColor||!i.boundColor.visible)continue;const s=i.getDisplayPosition(),o=i.getDisplayRadius();if(t.distanceTo(s)<=o)return i}}updateControlsOnColorChange(){if(this.selectedOutputColor){const t=this.selectedOutputColor.boundColor.rgba;n.App.SubApps.Palette.ColorEditor.OpacityInput.$().val((255*t.a).toFixed(0))}}updateViewOnColorChange(){this.updateControlsOnColorChange(),clearTimeout(this.updateViewOnColorChangeTimeoutId),this.updateViewOnColorChangeTimeoutId=setTimeout(()=>{this.updateView(!0)},100)}onColorFocus(){v.clear(),O()}onColorChanged(){if(this.selectedOutputColor){this.onColorFocus();const t=this.selectedOutputColor.boundColor.rgba.dup(),e=n.App.SubApps.Palette.ColorEditor.ColorInput.$().val(),i=t.a;t.setHex(e).setA(i),this.selectedOutputColor.setColor(t),this.updateViewOnColorChange(),O(),this.updateRevertButtonDisabled()}}onOpacityChanged(){if(this.selectedOutputColor){this.onColorFocus();let t=parseFloat(n.App.SubApps.Palette.ColorEditor.OpacityInput.$().val());Number.isFinite(t)||(t=0),t=Math.max(0,Math.min(255,t));const e=t/255;this.selectedOutputColor.setAlpha(e),this.updateViewOnColorChange(),O(),this.updateRevertButtonDisabled()}}onIncludeChanged(){if(this.selectedOutputColor){this.onColorFocus();const t=this.selectedOutputColor.boundColor.rgba.dup(),e=n.App.SubApps.Palette.ColorEditor.IncludeInput.$().prop("checked");let i=t.a;e?this.undoRgba.a>0?i=this.undoRgba.a:(i=this.selectedOutputColor.boundColor.primaryInputColor().rgba.a,0==i&&(i=1)):i=0,t.setA(i),this.selectedOutputColor.setColor(t),this.updateViewOnColorChange(),O(),this.updateRevertButtonDisabled()}}acceptEdits(){if(this.updateControlsOnColorChange(),this.selectedOutputColor)if(this.selectedOutputColor.boundColor.rgba.equals(this.undoRgba))this.clearSelection(),this.updateView(),O();else{const t=this.getCurrent().dupWithMod(new V);this.selectedOutputColor.setColor(this.undoRgba,!1),this.checkLayout(!0),this.updateControlsOnColorChange(),this.clearSelection(),this.setCurrent(t),O()}}rejectEdits(){this.selectedOutputColor&&(this.selectedOutputColor.setColor(this.undoRgba),this.updateControlsOnColorChange(),this.clearSelection(),this.updateView(!0),O())}hasRevertColor(){if(this.selectedOutputColor){const t=this.selectedOutputColor.boundColor.rgba,e=this.selectedOutputColor.boundColor.primaryInputColor().rgba;return!t.equals(this.undoRgba)||!t.equals(e)}return!1}revertColor(){if(this.selectedOutputColor){const t=this.selectedOutputColor.boundColor.rgba,e=this.selectedOutputColor.boundColor.primaryInputColor().rgba;let i=!1;t.equals(this.undoRgba)?t.equals(e)||(this.selectedOutputColor.setColor(e),i=!0):(this.selectedOutputColor.setColor(this.undoRgba),i=!0),i&&(this.updateSelectedOutputColorView(),this.updateControlsOnColorChange(),this.updateViewOnColorChange(),O())}}hasSelection(){return!!this.selectedInputColor||!!this.selectedOutputColor}clearSelection(t=!0,e=!0){t&&this.selectedInputColor&&(this.selectedInputColor.setSelected(!1),this.selectedInputColor=void 0),e&&this.selectedOutputColor&&(this.selectedOutputColor.setSelected(!1),this.selectedOutputColor=void 0,n.App.SubApps.Palette.ColorEditor.Container.$().addClass(n.App.SubApps.Palette.ColorEditor.disabled.name())),v.clear()}selectInputColor(t){this.selectedInputColor=t,this.selectedInputColor.setSelected(!0)}selectOutputColor(t){this.selectedOutputColor=t,this.selectedOutputColor.setSelected(!0);const e=this.selectedOutputColor.boundColor.rgba;this.undoRgba.setFrom(e),this.updateSelectedOutputColorView()}updateSelectedOutputColorView(){const t=this.selectedOutputColor.boundColor.rgba,e=t.toCssRgbHex(),i=(255*t.a).toFixed(0);n.App.SubApps.Palette.ColorEditor.ColorInput.$().val(e),n.App.SubApps.Palette.ColorEditor.ColorOutput.$().val(e),n.App.SubApps.Palette.ColorEditor.OpacityInput.$().val(i),n.App.SubApps.Palette.ColorEditor.IncludeInput.$().prop("checked",t.a>0),n.App.SubApps.Palette.ColorEditor.Container.$().removeClass(n.App.SubApps.Palette.ColorEditor.disabled.name()),this.updateRevertButtonDisabled()}updateRevertButtonDisabled(){n.App.SubApps.Palette.ColorEditor.RevertButton.toggleDisabled(!this.hasRevertColor())}clickInputColorIdx(t){this.clickColor(this.inputColorViews[t].outputColorView())}clickColor(t){void 0===t?this.acceptEdits():t instanceof W?t==this.selectedInputColor?this.clearSelection(!0,!1):t.isSingleton()&&t.outputColorView()==this.selectedOutputColor?this.acceptEdits():(this.acceptEdits(),t.outputColorView().boundColor.inputColors.length>1&&this.selectInputColor(t),this.selectOutputColor(t.outputColorView())):t instanceof z&&(t==this.selectedOutputColor?this.acceptEdits():(this.acceptEdits(),this.selectOutputColor(t))),this.selectedInputColor?this.selectedInputColor.addHighlightColors():this.selectedOutputColor&&this.selectedOutputColor.addHighlightColors(),O()}targetIsValid(t,e,i,s){let o=!1;if(t instanceof W){const i=t;e?e!==i.outputColorView()&&(o=(i.isSingleton(),!0)):i.isSingleton()||(o=!0)}else t instanceof z&&e&&e!==t&&(o=!0);return o}onTargetHoverColor(t,e,i,s){let o=this.targetIsValid(t,e,i,s);if(this.clearOnTargetHover(),o)if(e)e.group.classed(n.App.SubApps.Palette.Editor.drop_target.name(),!0);else{const e=t.boundColor.radius+4+7,i=Math.SQRT1_2*e;this.plus.attr("display","inline").attr("transform",`translate(${s.x+i}, ${s.y-i})`)}}clearOnTargetHover(){this.plus.attr("display","none");const t=n.App.SubApps.Palette.Editor.drop_target;t.$(!0).removeClass(t.name())}onDropColor(t,e,i){let s,o=this.getCurrent();if(t instanceof W){const i=t;e?e!==i.outputColorView()&&(s=i.isSingleton()?o.dupWithMod(new H(i.boundOutputColor,e.boundColor)):o.dupWithMod(new X(i.boundColor,e.boundColor))):i.isSingleton()||(s=o.dupWithMod(new Y(i.boundColor)))}else t instanceof z&&e&&e!==t&&(s=o.dupWithMod(new H(t.boundColor,e.boundColor)));s&&this.setCurrent(s),this.updateView(),O()}svgWidth(){return this.svg?parseFloat(this.svg.attr("width")):0}svgHeight(){return this.svg?parseFloat(this.svg.attr("height")):0}invalidateViews(){for(let t of this.undoStack)t.invalidateView()}checkLayout(t=!1){const e=this.getCurrent(),i=this.viewWidth(),s=this.viewWidth(),o=this.svgWidth(),r=this.svgHeight(),n=e.width!=o||e.height!=r;(t||n||(o!=i||r!=s))&&(e.checkLayout(i,t),this.svg.attr("width",e.width).attr("height",e.height).attr("viewBox",`0 0 ${e.width} ${e.height}`))}getCurrent(){return this.undoStack[this.undoStack.length-1]}setCurrent(t){this.undoStack.push(t),this.redoStack.length=0,this.updateView(),this.updateUndoRedoDisabledState()}updateUndoRedoDisabledState(){const t=this.undoStack.length>1,e=this.redoStack.length>0;n.App.SubApps.Toolbar.Undo.toggleDisabled(!t),n.App.SubApps.Toolbar.Redo.toggleDisabled(!e)}undoAllTheWay(){this.undoStack.length>1&&(this.undoStack.length=1,this.updateView(!0),O(),this.updateUndoRedoDisabledState())}clearUndoStack(){if(this.undoStack.length>1){const t=this.undoStack[this.undoStack.length-1];this.undoStack.length=0,this.undoStack.push(t),O(),this.updateUndoRedoDisabledState()}}undo(){this.undoStack.length>1&&(this.clearSelection(),this.redoStack.push(this.undoStack.pop()),this.updateView(!0),O()),this.updateUndoRedoDisabledState()}redo(){this.redoStack.length>0&&(this.clearSelection(),this.undoStack.push(this.redoStack.pop()),this.updateView(!0),O()),this.updateUndoRedoDisabledState()}clearView(){for(let t of this.outputColorViews)t.hide();for(let t of this.inputColorViews)t.hide()}updateViewWith(t,e=!1){this.checkLayout(e),n.App.SubApps.Palette.Editor.singleton.$(!0).removeClass(n.App.SubApps.Palette.Editor.singleton.name());for(let e=0;e<t.outputColors.length;e++){const i=t.outputColors[e],s=this.outputColorViews[e];if(i.visible){s.set(i);const t=1==i.inputColors.length;t&&s.group.classed(n.App.SubApps.Palette.Editor.singleton.name(),!0);for(let e=0;e<i.inputColors.length;e++){const s=i.inputColors[e],o=this.inputColorViews[s.idx];o.set(s,i),t&&o.group.classed(n.App.SubApps.Palette.Editor.singleton.name(),!0)}}else s.hide()}}updateView(t=!1){this.updateViewWith(this.getCurrent(),t)}viewWidth(){return n.App.SubApps.Palette.Editor.Container.$().width()}viewHeight(){return n.App.SubApps.Palette.Editor.Container.$().height()}getPreset(t,e=!1){let i;return i=this.presetModels[t]?this.presetModels[t]:this.presetModels[t]=new q(this,m.result,t).setFromResult(),i.checkLayout(this.viewWidth()),e&&this.setCurrent(i),i}}class V{deltaNumColors(){return 0}}class H{constructor(t,e){this.source=t,this.target=e}deltaNumColors(){return-1}}class X{constructor(t,e){this.inputColor=t,this.targetOutputColor=e}deltaNumColors(){return 0}}class Y{constructor(t){this.inputColor=t}deltaNumColors(){return 1}}class q{constructor(t,e,o){this.modelSet=t,this.result=e,this.numColors=o,this.inputColors=[],this.outputColors=[],this.pca=new vt,this.visibleOutputColors=[],this.width=0,this.height=0,this.underAllocationAreaRatio=1,this.presetNumColors=void 0;let r=0;for(let t=0;t<e.palette.length;t++){const i=new Z(e.palette.get(t),this);this.inputColors.push(i);i.rgba;r+=i.targetArea()}this.sumInputTargetAreas=r;for(let t of this.inputColors)t.rgba.a<1?s.setToAlphaComposition(t.rgba,i):s.setFrom(t.rgba),this.pca.addWeightedSample(s,t.pcaWeight);this.pca.compute();for(let t of this.inputColors)t.updatePcaVector()}invalidateView(){this.width=0,this.height=0;for(let t of this.outputColors)t.invalidateView()}setFromResult(){for(let t=0;t<this.inputColors.length;t++){const e=this.inputColors[t],i=new Q(t,e.rgba,e.isPrimary(this.numColors),this);i.inputColors.push(e),e.outputColor=i,this.outputColors.push(i)}for(let t=0;t<this.inputColors.length;t++){let e=this.inputColors[t];if(!e.isPrimary(this.numColors)){let t=this.inputColors[e.resultColor.redirectIndex];t.outputColor.inputColors.push(e),e.outputColor=t.outputColor}}return this.updateOutputPcsPoints(),this.presetNumColors=this.numColors,this}isPreset(){return null!=this.presetNumColors&&this.numColors==this.presetNumColors}getMaxColorsForProcessingOptions(){return this.presetNumColors?this.presetNumColors==g.palette.recommendedNumColors?0:this.presetNumColors:f}setFromPalette(t){for(let t=0;t<this.inputColors.length;t++){const e=this.inputColors[t],i=new Q(t,e.rgba,!1,this);this.outputColors.push(i)}const e=new mt,i=new Map;for(let s=0;s<t.length;s++){const o=this.inputColors[s],r=t[s].output.rgb;e.setArgb(r.alpha,r.r,r.g,r.b);const n=e.toArgbInt();if(!i.has(n)){const t=i.size;i.set(n,t)}const a=i.get(n),h=this.outputColors[a];h.visible=!0,h.rgba.setFrom(e),h.inputColors.push(o),o.outputColor=h}return this.updateOutputPcsPoints(),this}setFromModel(t,e){for(let e=0;e<t.outputColors.length;e++){const i=t.outputColors[e],s=new Q(i.idx,i.rgba,i.visible,this);if(this.outputColors.push(s),i.visible)for(let t of i.inputColors)s.addInputColor(this.inputColors[t.idx])}if(e instanceof H){const t=this.outputColors[e.source.idx],i=this.outputColors[e.target.idx];for(let e of t.inputColors)i.addInputColor(e);t.truncateInputColors()}if(e instanceof X){const t=this.inputColors[e.inputColor.idx],i=t.outputColor,s=this.outputColors[e.targetOutputColor.idx];i.removeInputColor(t),s.addInputColor(t)}if(e instanceof Y){const t=this.inputColors[e.inputColor.idx],i=t.outputColor,s=this.outputColors.find(t=>!t.visible&&0==t.inputColors.length);s&&(i.removeInputColor(t),s.addInputColor(t),s.rgba.setFrom(t.rgba),s.setXy(i.x,i.y))}return this.updateOutputPcsPoints(),this}dupWithMod(t){return new q(this.modelSet,this.result,this.numColors+t.deltaNumColors()).setFromModel(this,t)}logState(){for(let t of this.outputColors)if(t.visible)for(let e of t.inputColors);}updateOutputPcsPoints(){for(let t of this.outputColors)t.updatePcaVector()}minWidthHeight(){return Math.min(this.width,this.height)}isHorizontal(){return this.width>this.height}imageSize4x(){return this.result.imageWidth*this.result.imageHeight*16}numVisibleOutputColors(){let t=0;for(let e of this.outputColors)e.visible&&t++;return t}toPaletteMap(){const t=new Map;for(let e of this.outputColors)if(e.visible)for(let i of e.inputColors)t.set(i.idx,e.rgba.dup());return t}checkLayout(t,e=!1){if(!e&&this.width==t)return;this.width=t;const i=Math.max(.5*t,this.sumInputTargetAreas/q.PackingDensity/t),s=Math.max(100,Math.min(600,Math.round(.7*n.App.SubApps.sidebar.$().height())));this.height=Math.min(s,i);const o=this.width*this.height,r=this.sumInputTargetAreas/o,a=q.PackingDensity;this.underAllocationAreaRatio=Math.sqrt(a/r);for(let t of this.inputColors)t.resetState(),t.applyUnderAllocationAreaRatio();this.visibleOutputColors.length=0;for(let t of this.outputColors)t.visible&&this.visibleOutputColors.push(t);for(let t of this.visibleOutputColors)t.ensureInternalLayout();const h=nt.empty();for(let t of this.visibleOutputColors)h.addPoint(t.pcaPoint());h.pad(1e-6);const l=nt.ofSize(0,0,this.width,this.height);for(let t of this.visibleOutputColors)t.setDesiredPosition(h.transform(t.pcaPoint(),l));this.scaleToFit(!0,!1);const c=5*Math.min(1,this.underAllocationAreaRatio),u=d3.forceSimulation(this.visibleOutputColors).force("collision",d3.forceCollide(t=>t.targetRadius+c).strength(1)).force("x",d3.forceX(t=>t.desiredPosition.x).strength(.1)).force("y",d3.forceY(t=>t.desiredPosition.y).strength(.1)).force("boundary",function(t,e,i){let s;function o(o){for(const o of s){const s=o.targetRadius+5,r=i+s,n=t-i-s,a=i+s,h=e-i-s;o.x<r?(o.x=r,o.vx*=-.5):o.x>n&&(o.x=n,o.vx*=-.5),o.y<a?(o.y=a,o.vy*=-.5):o.y>h&&(o.y=h,o.vy*=-.5)}}return o.initialize=function(t){s=t},o}(this.width,this.height,q.EdgePadding)).stop();for(let t=0;t<100;t++)u.tick();this.scaleToFit(!1,!0);for(let t of this.visibleOutputColors)for(let e of this.visibleOutputColors)t!==e&&this.scaleToEliminateOverlap(t,e)}scaleToEliminateOverlap(t,e){const i=t.distanceTo(e),s=t.radius+e.radius,o=s-i;if(o>0){const i=t.radius/s,r=e.radius/s,n=Math.max(5,t.radius-i*o),a=Math.max(5,e.radius-r*o);t.scale(n/t.radius),e.scale(a/e.radius)}}scaleToFit(t,e){const i=nt.ofSize(0,0,this.width,this.height).pad(-q.EdgePadding),s=nt.empty(),o=nt.empty();for(let e of this.visibleOutputColors){const i=t?e.desiredPosition:e;o.addCircle(i,e.radius),s.addPoint(i)}s.pad(.1);const r=Math.abs(Math.min(i.width()/o.width(),i.height()/o.height()));i.padLeft(-(s.left-o.left)*r),i.padTop(-(s.top-o.top)*r),i.padRight(-(o.right-s.right)*r),i.padBottom(-(o.bottom-s.bottom)*r);for(let o of this.visibleOutputColors){const n=t?o.desiredPosition:o,a=s.transform(n,i);t?o.setDesiredPosition(a):o.set(a),e&&o.scale(r)}}}q.PackingDensity=.15,q.EdgePadding=7;class j extends ot{constructor(t,e,i){super(0,0),this.idx=t,this.model=i,this.rgba=new mt,this.pcaVector=dt.create(4,1),this.index=0,this.vx=0,this.vy=0,this.fx=null,this.fy=null,e instanceof mt?this.rgba.setFrom(e):this.rgba.setArgbInt(e),this.index=t}pcaPoint(){return this.model.isHorizontal()?new ot(this.pcaVector.getVector(0),this.pcaVector.getVector(1)):new ot(this.pcaVector.getVector(1),-this.pcaVector.getVector(0))}updatePcaVector(){const t=this.rgba.isFullyOpaque()?this.rgba:s.setToAlphaComposition(this.rgba,i);this.model.pca.toPrincipalComponentSpace(t.toMatrixArgb(),this.pcaVector)}}class Z extends j{constructor(t,e){super(t.index,t.argb,e),this.resultColor=t,this.layoutPosition=ot.zero(),this.layoutRadius=0,this.outputColor=void 0,this.pcaWeight=t.sumWeights/this.model.imageSize4x(),this.resetState()}toPaletteColorSpec(){function t(t){return{raw:t.toCssAuto(),kind:1,rgb:{alpha:t.a,r:t.r,g:t.g,b:t.b}}}return{input:t(this.rgba),output:t(this.outputColor.rgba)}}resetState(){this.setXy(0,0);const t=this.model.result.palette.length,e=this.resultColor.numPixels/this.model.imageSize4x(),i=e/(1/t),s=Math.sqrt(t);this.targetRadius=i<1/s&&e<.05?Z.SmallRadius:i<s&&e<.333?Z.MediumRadius:Z.LargeRadius,this.radius=this.targetRadius}applyUnderAllocationAreaRatio(){this.radius=this.targetRadius*this.model.underAllocationAreaRatio}targetArea(){return Math.PI*this.targetRadius*this.targetRadius}isPrimary(t){return-1==this.resultColor.redirectIndex||this.idx<t}}Z.SmallRadius=10,Z.MediumRadius=20,Z.LargeRadius=30;class Q extends j{constructor(t,e,i,s){super(t,e,s),this.visible=i,this.inputColors=[],this.desiredPosition=ot.zero(),this.layoutRadius=0,this.dirty=!0}invalidateView(){this.dirty=!0}primaryInputColor(){return this.inputColors.reduce((t,e)=>t.idx<e.idx?t:e)}removeInputColor(t){let e=this.inputColors.indexOf(t);if(e>=0){this.inputColors.length;this.inputColors.splice(e,1),t.outputColor=void 0}0==this.inputColors.length&&(this.visible=!1)}addInputColor(t){this.inputColors.length;this.inputColors.push(t),t.outputColor=this,0==this.visible&&(this.visible=!0)}truncateInputColors(){this.inputColors.length;this.inputColors.length=0,this.visible=!1}isLight(t){return t.a<.5||this.rgba.grayscale()>.25&&t.grayscale()>.25}lightDarkFilterUrl(t){return this.isLight(t)?`url(${n.App.SubApps.Palette.Editor.InnerColorShadowLight.css()})`:`url(${n.App.SubApps.Palette.Editor.InnerColorShadowDark.css()})`}setDesiredPosition(t){this.desiredPosition.set(t),this.set(t)}scale(t){const e=this.model.minWidthHeight()/6,i=this.model.minWidthHeight()/2.1,s=e+Math.max(0,Math.min(this.inputColors.length/10,1))*(i-e),o=Math.min(s,t*this.radius);t=o/this.radius,this.radius=o;for(let e of this.inputColors)e.x*=t,e.y*=t,e.radius*=t}ensureInternalLayout(){if(this.visible&&this.dirty){const t=Q.RadiusPadding*this.model.underAllocationAreaRatio;if(1==this.inputColors.length){const e=this.inputColors[0];e.setXy(0,0);const i=Math.max(0,.5*e.radius),s=Math.max(0,e.radius-i);e.radius=i,this.targetRadius=this.radius=i+.5*s+2*t}else if(2==this.inputColors.length){const e=this.inputColors[0],i=this.inputColors[1],s=i.pcaPoint().dup().minusEquals(e.pcaPoint()).normalize();0==s.length()&&(this.model.isHorizontal()?s.setXy(1,0):s.setXy(0,1));const o=.5*(2*e.radius+2*i.radius+3*t),r=o-t-e.radius,n=o-t-i.radius;e.setScaled(s,-r),i.setScaled(s,n),this.targetRadius=this.radius=o}else{const e=ot.zero();let i=0,s=0;for(let t of this.inputColors){const o=t.pcaPoint();e.plusEqualsXy(o.x,o.y),i++,s+=t.targetArea()}i>0&&e.timesEquals(1/i);const o=s/Q.PackingDensity,r=Math.sqrt(o/Math.PI);let n=0;for(let t of this.inputColors){const i=t.pcaPoint();t.x=i.x-e.x,t.y=i.y-e.y;const s=Math.sqrt(t.x*t.x+t.y*t.y);s>n&&(n=s)}const a=r/n;for(let t of this.inputColors)t.x*=a,t.y*=a;const h=d3.forceSimulation(this.inputColors).force("attract",d3.forceRadial(0,0,0).strength(.03)).force("collision",d3.forceCollide(e=>e.radius+.5*t).strength(1)).stop();for(let t=0;t<200;t++)h.tick();let l=0;for(let e of this.inputColors){const i=Math.sqrt(e.x*e.x+e.y*e.y);i+e.radius>l&&(l=i+e.radius+t)}this.targetRadius=this.radius=l}for(let t of this.inputColors)t.layoutPosition.set(t),t.layoutRadius=t.radius;this.layoutRadius=this.radius,this.dirty=!1}else{for(let t of this.inputColors)t.set(t.layoutPosition),t.radius=t.layoutRadius;this.targetRadius=this.radius=this.layoutRadius}}}Q.RadiusPadding=5,Q.PackingDensity=.5}(W||(W={})),function(t){const e="stickySettings";var i=null;t.initialize=function(){if(!(i=null))try{i=JSON.parse(window.localStorage[e])}catch(t){i={}}},t.splitView=function(t){return void 0===t?1==i.splitView:(i.splitView=t,function(){try{window.localStorage[e]=JSON.stringify(i)}catch(t){}}(),t)}}(U||(U={})),function(t){let e,i,s;!function(t){let e=!1;t.show=function(t,i,s){e||(e=!0,F.modal(n.App.Progress.Dialog,!1,!1)),F.progressBar(n.App.Progress.Upload,t),F.progressBar(n.App.Progress.Process,i),F.progressBar(n.App.Progress.Download,s)},t.hide=function(){e&&(e=!1,n.App.Progress.Dialog.$().modal("hide"))}}(e||(e={})),function(t){let e=!1;t.show=function(t,i){e||(e=!0,F.modal(n.App.Error.Dialog,!1,!1)),n.App.Error.Message.$().text(t),n.App.Error.RetryButton.$().toggle(!i)},t.hide=function(){e&&(e=!1,n.App.Error.Dialog.$().modal("hide"))}}(i||(i={})),function(t){t.update=function(t,e){e&&n.App.DownloadLink.$().attr({href:"/images/"+e.resultStart.spec.token})}}(s||(s={}));let o,a,h,l,c,d,p=!1,m=null,g=null;t.setCurrentModel=function(t){m&&m.removeListener(f),m=t,m.addListener(f),p||function(){p=!0;const t=new ht(1,1),e=new ht(1,1);t.element.id=n.App.ImageView.LeftCanvas.name(),e.element.id=n.App.ImageView.RightCanvas.name(),n.App.ImageView.CanvasContainer.$().append(t.element,e.element),N.MaxScaleFactor=32,o=new At(1,1,!0),a=new Tt,h=new _t(a),l=new Rt(o,h,t,u.s("Original Image")),c=new Dt(new Ot),d=new Rt(o,c,e),c.showVector(),l.topTextMargin=d.topTextMargin=80,h.otherView=d,c.otherView=l,n.App.ImageView.CanvasContainer.$().mouseleave(function(){h.lastMove=c.lastMove=c.lastLoupe=void 0}),n.$window.resize(()=>{b()}),setTimeout(function(){o.zoomToFit()},0);const i=50;new Ct(n.App.Toolbar.ZoomIn.$(),function(){o.zoomBy(N.zoomStep)},i,1),new Ct(n.App.Toolbar.ZoomOut.$(),function(){o.zoomBy(1/N.zoomStep)},i,1),n.App.Toolbar.ZoomToFit.$().click(function(){o.zoomToFit()}),n.App.Toolbar.Zoom1To1.$().click(function(){o.zoom1To1()}),n.App.Toolbar.ViewSingle.$().click(function(){w(!1)}),n.App.Toolbar.ViewSplit.$().click(function(){w(!0)}),n.App.Toolbar.ThumbsUp.$().click(function(){n.App.Feedback.DialogShare.$().modal("show")}),n.App.Toolbar.ThumbsDown.$().click(function(){n.App.Feedback.Dialog.$().modal("show"),n.App.Feedback.Message.$().focus()}),F.radioButton(n.App.Toolbar.ViewBitmap,S,A),n.App.Error.RetryButton.$().click(()=>{m.reset().trigger()}),n.App.Feedback.Submit.$().click(()=>{m.submitFeedback(n.App.Feedback.Message.$().val()),n.App.Feedback.Dialog.$().modal("hide"),b()}),n.$window.keydown(E),n.$window.keyup(R),$(".navbar").hide(),$(".footer").hide(),$(".container >").hide(),n.popup_drop_target_container.$().show(),n.App.App.$().show(),v(P())}(),W.setCurrentModel(t),d.bottomText=l.bottomText=m.label,a.setImageCanvas(m.img),c.vector.setImageCanvas(m.img),o.setImageSize(m.img.width(),m.img.height()),o.zoomToFit(),b()};let f=t=>{t.source==m&&b()};function b(){if(m){g!=m.result&&(g=m.result,c.vector.setResult(m.result),s.update(m.name,g));const t=m.isFree();n.App.DownloadLink.toggleClasses(t,n.isFree,n.viewer_green_button).toggleClasses(!t,n.isPaid,n.Viewer.blue_button),n.App.Toolbar.ThumbsUpDown.$().toggleClass("hidden",t||m.hasSubmittedFeedback);const o=n.App.ImageView.CanvasContainer.$().outerWidth(),r=n.App.ImageView.CanvasContainer.$().outerHeight();let a=function(t,e){function i(t){return Math.min(8e3,Math.max(100,0|t))}let s=i(e-88),o=i(t),r=o/2/s,n=o/(s/2),a=i(m.img.height()),h=i(m.img.width())/a,l=Math.abs(h-r),c=Math.abs(h-n);return l<=c}(o,r);if(m.result){g.processingOptions;let t=""+g.userPalette.length;n.App.Toolbar.PaletteNumColors.$().text(t)}switch(m.state){case 6:P()?(n.App.Toolbar.ViewSplit.$().addClass("active"),n.App.Toolbar.ViewSingle.$().removeClass("active"),l.show(),d.show(),a?(l.checkSetSize(Math.floor(o/2),r),d.checkSetSize(Math.ceil(o/2),r)):(l.checkSetSize(o,Math.floor(r/2)),d.checkSetSize(o,Math.ceil(r/2)))):(n.App.Toolbar.ViewSplit.$().removeClass("active"),n.App.Toolbar.ViewSingle.$().addClass("active"),l.hide(),d.show(),d.checkSetSize(o,r)),e.hide(),i.hide();break;case 7:l.show(),d.hide(),l.checkSetSize(o,r),e.hide(),i.show(m.errorMessageTr,m.unrecoverable);break;default:l.show(),d.hide(),l.checkSetSize(o,r),e.show(m.uploadProgress,m.processingProgress,m.downloadProgress),i.hide()}}}function w(t){U.splitView(t),v(t),b()}function v(t){h.lastMove=c.lastMove=c.lastLoupe=void 0,t?h.lastMoveListener=c.lastMoveListener=C:(h.lastMoveListener=void 0,c.lastMoveListener=x)}const C=t=>{h.lastMove=c.lastMove=t,h.invalidate(),c.invalidate()},x=t=>{c.lastLoupe=t,c.invalidate()};function y(t,e){n.App.Toolbar.ViewBitmap.$().toggleClass(r.active.name(),t)}function S(){c.showBitmap(),y(!0)}function A(){c.showVector(),y(!1)}function P(){return U.splitView()&&n.$window.innerWidth()>768}function M(){return n.App.Feedback.Dialog.$().is(":visible")}const k=30;function E(t){if(M())13==t.keyCode&&t.ctrlKey&&n.App.Feedback.Submit.$().click();else if(!W.keyDownHandler(t))switch(t.keyCode){case 49:w(!1);break;case 50:w(!0);break;case 66:S();break;case 80:W.show();break;case 36:o.zoomToFit();break;case 35:o.zoom1To1();break;case 33:o.zoomBy(1.2);break;case 34:o.zoomBy(1/1.2);break;case 37:o.translateBy(-k,0);break;case 39:o.translateBy(k,0);break;case 40:o.translateBy(0,k);break;case 38:o.translateBy(0,-k)}}function R(t){if(!M()&&!W.keyUpHandler(t)&&66===t.keyCode)A()}}(V||(V={})),function(t){let e=null;t.exitHref="/";let i=!0,s=!1;function o(){return location.href.split("#")[0]}function r(t){const i=t.originalEvent;if(i.state){const t=i.state;et.resumeUserImage(t)}else e!=o()&&(location.replace(location.href),location.href.indexOf("#")>=0&&location.reload());e=o()}t.initialize=function(){e=o(),n.$window.on("popstate",r)},t.goToPlaceholder=function(r){const n=location,a="/images/processing",h=0===n.pathname.lastIndexOf(a,0);document.title=r+" - Vectorizer.AI",h?i&&(t.exitHref=n.protocol+"//"+n.host):(i&&(t.exitHref=n.href),history.pushState(void 0,"",a),e=o()),i=!1,s=!0},t.goTo=function(r){const n=location,a=n.pathname,h="/images/"+r.token+"/edit",l=0===a.lastIndexOf(h,0);document.title=r.originalFilename+" - Vectorizer.AI",l?i&&(t.exitHref=n.protocol+"//"+n.host):(i&&(t.exitHref=n.href),s?history.replaceState(r,"",h):history.pushState(r,"",h),F.gaSetPageAndSendPageview("/images/edit"),e=o()),i=!1,s=!1},t.exit=function(){const e=o();location.href=t.exitHref,t.exitHref.indexOf("#")>=0&&F.startsWith(t.exitHref,e)&&location.reload()}}(H||(H={})),function(t){let e=null,i=[];function s(t){i.push(t),t.trigger(),function(t){e=t,V.setCurrentModel(t)}(t)}t.initialize=function(){},t.add=function(t,e,i){W.clearOnDropTwice();let r=gt.create(e,t,i);r.addListener(o),s(r),H.goToPlaceholder(t.name)},t.resume=function(t,e){s(gt.resume(e,t)),H.goTo(t)};const o=t=>{t.source.spec&&(H.goTo(t.source.spec),t.source.removeListener(o))}}(X||(X={})),function(t){t.fetchUrl=function(t){return"/api/fetchUrl?url="+encodeURIComponent(t)}}(Y||(Y={}));class Lt{constructor(t,e=null,i=null,s=null){this.name=t,this.scriptUrls=e,this.workerFunction=i,this.messageListener=s,this.myMessageListener=t=>this.messageListener?this.messageListener(t):void 0}static getBasics(){return Bt.toString()}ensureWorker(){if(!this.worker){let t="'use strict';\n";if(t+=Lt.getBasics()+";\n",this.scriptUrls&&this.scriptUrls.length>0){let e=this.scriptUrls.map(function(t){return t.length>1&&"/"==t[0]&&"/"==t[1]?"https:"+t:t.length>0&&"/"==t[0]?location.protocol+"//"+location.host+t:t});t+="importScripts(\n  '"+e.join("',\n  '")+"');\n"}this.workerFunction&&(t+="("+this.workerFunction.toString()+")();\n");let e=new Blob([t],{type:"text/javascript"}),i=URL.createObjectURL(e);this.worker=new Worker(i),this.worker.addEventListener("error",t=>{F.gaTrack("YoWorker","Error",t.filename+":"+t.lineno+":"+t.colno+", '"+t.message+"', '"+t.error+"'")}),this.worker.addEventListener("message",this.myMessageListener)}return this.worker}setMessageListener(t){this.messageListener=t}postMessage(t,e){try{try{this.ensureWorker().postMessage(t,e)}catch(e){this.worker.postMessage(t)}}catch(t){throw F.gaTrack("YoWorker","Exception",this.name+": '"+t+"', '"+t.stack+"'"),t}}terminate(){this.worker&&(this.worker.terminate(),this.worker=null)}}function $t(){class t{constructor(t,e,i,s,o){this.dataIn=t,this.wIn=e,this.hIn=i,this.wOut=s,this.hOut=o,this.dataOut=new Uint8ClampedArray(s*o*4),this.outToInX=this.wIn/this.wOut,this.outToInY=this.hIn/this.hOut;let r=t.length,n=!1;for(let e=3;e<r;e+=4){if(t[e]<255){n=!0;break}}this.hasTransparency=n,this.accumulate=this.hasTransparency?this.accumulateRgba:this.accumulateRgb}reset(){this.aSum=0,this.rSum=0,this.gSum=0,this.bSum=0,this.wSum=0}accumulateRgb(t,e,i){const s=4*(t+this.wIn*e);this.rSum+=this.dataIn[s+0]*i,this.gSum+=this.dataIn[s+1]*i,this.bSum+=this.dataIn[s+2]*i,this.wSum+=i}accumulateRgba(t,e,i){const s=4*(t+this.wIn*e);let o=(this.dataIn[s+3]/255+1e-12)*i;this.aSum+=o,this.rSum+=this.dataIn[s+0]*o,this.gSum+=this.dataIn[s+1]*o,this.bSum+=this.dataIn[s+2]*o,this.wSum+=i}populate(t,e){this.reset();const i=t*this.outToInX,s=e*this.outToInY,o=Math.min(i+this.outToInX,this.wIn),r=Math.min(s+this.outToInY,this.hIn),n=Math.floor(i),a=Math.floor(s),h=Math.ceil(o)-1,l=Math.ceil(r)-1,c=Math.ceil(i),u=Math.ceil(s),d=h,p=l,m=c-i,g=u-s,f=o-d,b=r-p;this.accumulate(n,a,m*g),this.accumulate(n,l,m*b);for(var w=c;w<d;w++)this.accumulate(w,a,g),this.accumulate(w,l,b);this.accumulate(h,a,f*g),this.accumulate(h,l,f*b);for(var v=u;v<p;v++){this.accumulate(n,v,m);for(w=c;w<d;w++)this.accumulate(w,v,1);this.accumulate(h,v,f)}const C=4*(t+e*this.wOut);this.hasTransparency?(this.dataOut[C+0]=this.rSum/this.aSum,this.dataOut[C+1]=this.gSum/this.aSum,this.dataOut[C+2]=this.bSum/this.aSum,this.dataOut[C+3]=this.aSum/this.wSum*255):(this.dataOut[C+0]=this.rSum/this.wSum,this.dataOut[C+1]=this.gSum/this.wSum,this.dataOut[C+2]=this.bSum/this.wSum,this.dataOut[C+3]=255)}shrink(){for(var t=0,e=0;t<this.hOut;t++)for(var i=0;i<this.wOut;i++,e++)this.populate(i,t);return this.dataOut}}var e=[];function i(i){e.push(Date.now());const s=(o=i.dataIn,r=i.wIn,n=i.hIn,a=i.wOut,h=i.hOut,new t(o,r,n,a,h).shrink());var o,r,n,a,h;return Date.now(),e.pop(),s}self.addEventListener("message",t=>{try{var e=t.data;const s=i(e);Bt({canvasId:e.canvasId,success:!0,wOut:e.wOut,hOut:e.hOut,dataOut:s},[s.buffer])}catch(t){Bt({canvasId:e.canvasId,success:!1,wOut:0,hOut:0,dataOut:null})}})}!function(t){let e=!0,i=0;const s=new xt;t.ThumbnailJpegQuality=.7;class o{constructor(t,e){if(this.canvasId=t,this.spec=e,this.failSafeTimeout=void 0,this.croppedCanvas=this.spec.inputCanvas,this.spec.crop){const t=this.spec.crop,e=t.right-t.left,i=t.bottom-t.top;if(0!=t.top||0!=t.left||e!=this.spec.inputCanvas.width()||i!=this.spec.inputCanvas.height()){const s=new ht(e,i);s.context().drawCanvasEx3(this.spec.inputCanvas,t.left,t.top,s.width(),s.height(),0,0,s.width(),s.height()),this.croppedCanvas=s,this.croppedCanvas.wasCropped=!0}}let i=this.croppedCanvas.width(),s=this.croppedCanvas.height();this.wOut=i,this.hOut=s;if(i*s>this.spec.maxNumPixels){const t=Math.sqrt(this.spec.maxNumPixels/(i*s));if(i<s){for(this.wOut=Math.max(1,0|Math.round(i*t)),this.hOut=0|Math.round(s*this.wOut/i);this.wOut*this.hOut>this.spec.maxNumPixels&&this.wOut>1;)this.wOut--,this.hOut=0|Math.round(s*this.wOut/i);1==this.wOut&&this.hOut>this.spec.maxNumPixels&&(this.hOut=this.spec.maxNumPixels)}else{for(this.hOut=Math.max(1,0|Math.round(s*t)),this.wOut=0|Math.round(i*this.hOut/s);this.wOut*this.hOut>this.spec.maxNumPixels&&this.hOut>1;)this.hOut--,this.wOut=0|Math.round(i*this.hOut/s);1==this.hOut&&this.wOut>this.spec.maxNumPixels&&(this.wOut=this.spec.maxNumPixels)}}}shrinkingNeeded(){return this.wOut!=this.croppedCanvas.width()||this.hOut!=this.croppedCanvas.height()}createOutputCanvas(){return new ht(this.wOut,this.hOut)}shrinkWithWorker(){try{const t=this.croppedCanvas.context().getImageData(0,0,this.croppedCanvas.width(),this.croppedCanvas.height()).data,e={canvasId:this.canvasId,wIn:this.croppedCanvas.width(),hIn:this.croppedCanvas.height(),dataIn:t,wOut:this.wOut,hOut:this.hOut};this.failSafeTimeout=setTimeout(()=>this.shrinkWithWorkerFailSafe("fail-safe timeout reached"),1e4),this.spec.worker.setMessageListener(r),this.spec.worker.postMessage(e,[t.buffer])}catch(t){this.shrinkWithWorkerFailSafe("exception in spawning worker or sending work message")}}shrinkWithWorkerResultHandler(t){if(t.success&&t.wOut==this.wOut&&t.hOut==this.hOut&&null!=t.dataOut&&t.dataOut.length>0){F.gaTrack("WebWorker","Downsample","Succeeded",1);const e=this.createOutputCanvas(),i=e.context().createImageData(e.width(),e.height());i.data.set(t.dataOut),e.context().putImageData(i,0,0),e.wasShrunk=!0,e.wasCropped=this.croppedCanvas.wasCropped,this.completed(e)}else this.shrinkWithWorkerFailSafe("Worker reports failure")}shrinkWithWorkerFailSafe(t){F.gaTrack("WebWorker","Downsample","Failed",0),e=!1,this.shrinkWithoutWorker()}shrinkWithoutWorker(){var t=this.createOutputCanvas();t.context().drawCanvasEx2(this.croppedCanvas,0,0,t.width(),t.height()),t.wasShrunk=!0,t.wasCropped=this.croppedCanvas.wasCropped,this.completed(t)}produceThumbnail(e){if(this.spec.thumbnailSize){const i=this.spec.thumbnailSize.w,s=this.spec.thumbnailSize.h,o=new ht(i,s);o.context().setFillStyle("rgb(255,255,255)"),o.context().fillRect(0,0,i,s);const r=Math.min(i/e.width(),s/e.height());return o.context().context.drawImage(e.element,(i-e.width()*r)/2,(s-e.height()*r)/2,e.width()*r,e.height()*r),o.toBlob("image/jpeg",t.ThumbnailJpegQuality)}return null}completed(t){clearTimeout(this.failSafeTimeout),this.failSafeTimeout=void 0,s.remove(this.canvasId),this.spec.completed(t,t.wasShrunk||t.wasCropped,()=>this.produceThumbnail(t))}process(){this.shrinkingNeeded()?e&&this.spec.worker?this.shrinkWithWorker():this.shrinkWithoutWorker():this.completed(this.croppedCanvas)}}function r(t){const e=t.data;s.contains(e.canvasId)&&s.get(e.canvasId).shrinkWithWorkerResultHandler(e)}t.process=function(t){const e=new o("cs_"+i++,t);s.put(e.canvasId,e),e.process()}}(q||(q={})),function(t){t.Mega=1048576;const e=10,i=100,s=20,o=18;t.initialized=!1;var r=null;t.lockAspectRatio=!1,t.maxNumMegapixels=4;var a=0,h=0;const l=ot.empty();var c=1,u=null,d=null,p=0,m=0,g=0,f=0;const b=nt.zero();var v=1,C=1,x=0,y=0;const S=ot.empty(),A=ot.empty(),P=ot.empty(),M=ot.empty();var k=!1;const E=ot.empty(),R=nt.zero(),T=nt.zero();class I{constructor(t,e){this.key=t,this.anchor=e,this.oppositeAnchor=w.opposite(this.anchor)}}var O=null;const _=new I("resize-top",w.Top),D=new I("resize-top-right",w.TopRight),B=new I("resize-right",w.Right),L=new I("resize-bottom-right",w.BottomRight),N=new I("resize-bottom",w.Bottom),z=new I("resize-bottom-left",w.BottomLeft),W=new I("resize-left",w.Left),U=new I("resize-top-left",w.TopLeft),V=new I("resize-move",w.Center);let H=!1;function X(e,i,s,o,n){s.$().text(e.toFixed(0)+" x "+i.toFixed(0)+" px"),o.$().text(F.formatAspectRatio(F.fuzzyAspectRatioEx({w:e,h:i},r.aspectRatios))),n.$().text((e*i/t.Mega).toFixed(1))}function Y(){n.PreCrop.Sidebar.MaxNumMegapixels.display.$().text(t.maxNumMegapixels+" megapixels"),X(Math.round(T.width()),Math.round(T.height()),n.PreCrop.Sidebar.cropped_image_size_display,n.PreCrop.Sidebar.cropped_image_aspect_ratio_display,n.PreCrop.Sidebar.cropped_image_megapixels_display),n.PreCrop.Sidebar.lock_aspect_ratio_button.$().prop("checked",t.lockAspectRatio);const e=T.width()*T.height()/t.Mega>t.maxNumMegapixels;n.PreCrop.Sidebar.cropped_image_warning.$().toggle(e),n.PreCrop.Sidebar.cropped_image_success.$().toggle(!e),n.PreCrop.Sidebar.cropped_image_megapixels_display.$().attr("style",e?"color:red;":"")}function q(){t.lockAspectRatio=!t.lockAspectRatio,ct(),Y()}function j(){t.maxNumMegapixels=Math.min(t.maxNumMegapixels+1,r.maxMaxNumMegapixels),Y()}function Z(){t.maxNumMegapixels=Math.max(1,t.maxNumMegapixels-1),Y()}function Q(){$(window).off("beforeunload"),location.reload()}function J(){const t=T.width(),e=T.height();t>0&&e>0&&null!=r.completed&&(r.completed(T),n.PreCrop.App.$().hide(),H||n.body.$().removeClass("modal-open"))}function K(t,e){if(null!=t&&null!=e){S.set(P),A.set(M);var i=$(d.element).offset();return P.setXy(t-i.left,e-i.top),s=P,M.setXy((s.x-b.left)*C,(s.y-b.top)*C),S.notEquals(P)||A.notEquals(M)}var s;return!1}function tt(){const t=20*C,e=Math.abs(M.x-T.left)<t,i=Math.abs(M.y-T.top)<t,s=Math.abs(M.x-T.right)<t,o=Math.abs(M.y-T.bottom)<t,r=T.center(),n=Math.abs(M.x-r.x)<t&&Math.abs(M.y-r.y)<t;var a=null;M.x>T.left-t&&M.x<T.right+t&&M.y>T.top-t&&M.y<T.bottom+t&&(e?a=i?U:o?z:W:s?a=i?D:o?L:B:i?a=_:o?a=N:n&&(a=V)),et(a)}function et(t){O=t,null==t?$(d.element).attr("class","canvas-view"):$(d.element).attr("class",O.key+"-tool canvas-view"),yt()}function it(t){const e=t.touches.item(0);lt(e.pageX,e.pageY),dt(e.pageX,e.pageY),t.preventDefault()}function st(t){const e=t.touches.item(0);lt(e.pageX,e.pageY),t.preventDefault()}function rt(t){mt(-1e5,-1e5),t.preventDefault()}function at(t){lt(t.pageX,t.pageY)}function lt(t,e){const s=K(t,e);if(k){if(null!=O&&s){T.setFrom(R),T.moveAnchor(O.anchor,M.minus(E)),T.normalize(),T.left=Math.max(T.left,0),T.top=Math.max(T.top,0),T.right=Math.min(T.right,a),T.bottom=Math.min(T.bottom,h),T.round();Math.round(Math.max(0,i-T.width())),Math.round(Math.max(0,i-T.height()));T.moveAnchorToMinSize(O.anchor,i,i),T.round(),ct(),Y(),yt()}}else tt()}function ct(){if(t.lockAspectRatio){var e=w.Center;if(null!=O&&(e=O.oppositeAnchor),T.forceAspectRatio(c,e),T.width()>a||T.height()>h)T.set(0,0,a,h);else{const t=Math.max(0,-T.left)+Math.min(0,a-T.right),e=Math.max(0,-T.top)+Math.min(0,h-T.bottom);T.translate(t,e)}T.round(),yt()}}function ut(t){dt(t.pageX,t.pageY),$(window).on("mouseup",pt),$(window).on("mousemove",at)}function dt(t,e){k=!0,E.set(M),R.setFrom(T),K(t,e)}function pt(t){mt(t.pageX,t.pageY),$(window).off("mouseup",pt),$(window).off("mousemove",at)}function mt(t,e){k=!1,$(window).off("mouseup",pt),$(window).off("mousemove",at),K(t,e),tt()}function gt(t){k||et(null)}function ft(t){k||(K(t.pageX,t.pageY),tt())}function bt(){null!=u&&null!=d&&(p=u.outerWidth(),m=u.outerHeight(),d.width()==p&&d.height()==m||d.setSize(p,m),(f=m-20)/(g=p-20)>h/a?(b.left=e,y=h/a*(x=g),b.top=e+.5*(f-y)):(b.top=e,x=a/h*(y=f),b.left=e+.5*(g-x)),b.right=b.left+x,b.bottom=b.top+y,C=1/(v=x/a)),Y(),yt()}function wt(t){return new ot(b.left+t.x*v,b.top+t.y*v)}function vt(t,e,i,r,n){const a=O==n,h=wt(e);t.setFillStyle("#ffffff"),t.fillRect(h.x+i,h.y+r,i*s,6*r),t.fillRect(h.x+i,h.y+r,6*i,r*s),t.setFillStyle(a?"#ff0000":"#000000"),t.fillRect(h.x+2*i,h.y+2*r,i*o,4*r),t.fillRect(h.x+2*i,h.y+2*r,4*i,r*o)}function Ct(t,e,i,r){const n=O==r,a=wt(e);t.setFillStyle("#ffffff"),t.fillRect(a.x+i,a.y-10,6*i,s),t.setFillStyle(n?"#ff0000":"#000000"),t.fillRect(a.x+2*i,a.y-9,4*i,o)}function xt(t,e,i,r){const n=O==r,a=wt(e);t.setFillStyle("#ffffff"),t.fillRect(a.x-10,a.y+i,s,6*i),t.setFillStyle(n?"#ff0000":"#000000"),t.fillRect(a.x-9,a.y+2*i,o,4*i)}function yt(){if(null!=r.inputCanvas&&null!=d&&0!=p&&0!=m){const i=d.context();i.clearRect(0,0,p,m),i.drawCanvasEx2(r.inputCanvas,b.left,b.top,x,y),i.setStrokeStyle("#000000"),i.setGlobalAlpha(.4),i.setLineWidth(1);const s=Math.round((e=T.left,b.left+e*v))+.5,o=Math.round((t=T.top,b.top+t*v))+.5,n=Math.round(T.width()*v)-1,a=Math.round(T.height()*v)-1;i.strokeRect(s,o,n,a),i.setGlobalAlpha(1),vt(i,T.topLeft(),1,1,U),vt(i,T.topRight(),-1,1,D),vt(i,T.bottomRight(),-1,-1,L),vt(i,T.bottomLeft(),1,-1,z),Ct(i,T.leftCenter(),1,W),Ct(i,T.rightCenter(),-1,B),xt(i,T.topCenter(),1,_),xt(i,T.bottomCenter(),-1,N),function(t,e,i){var s=17.5,o=O==i?"#ff0000":"#000000";const r=wt(e);t.beginPath(),t.triangle(r.x,r.y-s,-Math.PI/2,2,5),t.triangle(r.x,r.y+s,Math.PI/2,2,5),t.triangle(r.x-s,r.y,Math.PI,2,5),t.triangle(r.x+s,r.y,0,2,5),t.strokeEx(2,"#FFF"),t.fillEx(o),t.fillCircle(r.x,r.y,12,"#FFFFFF"),t.fillCircle(r.x,r.y,11,o)}(i,T.center(),V)}var t,e}t.show=function(e){a=(r=e).inputCanvas.width(),h=r.inputCanvas.height(),l.setXy(.5*a,.5*h),T.set(0,0,a,h),c=h/a,t.lockAspectRatio=!!r.lockAspectRatio,t.maxNumMegapixels=r.maxNumMegapixels,t.initialized||(t.initialized=!0,u=n.PreCrop.ViewContainer.$(),d=new ht(u.outerWidth(),u.outerHeight()),u.append(d.element),$(d.element).mousedown(ut).mouseup(pt).mousemove(at).hover(ft,gt),d.element.addEventListener("touchstart",it,G.AddEventListenerThirdArgForTouch),d.element.addEventListener("touchmove",st,G.AddEventListenerThirdArgForTouch),d.element.addEventListener("touchend",rt,G.AddEventListenerThirdArgForTouch),n.PreCrop.Sidebar.crop_button.$().click(J),n.PreCrop.Sidebar.cancel_button.$().click(Q),n.PreCrop.Sidebar.lock_aspect_ratio_button.$().click(q),r.maxMaxNumMegapixels?(n.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().click(Z),n.PreCrop.Sidebar.MaxNumMegapixels.increase.$().click(j)):(n.PreCrop.Sidebar.MaxNumMegapixels.decrease.$().hide(),n.PreCrop.Sidebar.MaxNumMegapixels.increase.$().hide()),$(window).resize(bt)),X(a,h,n.PreCrop.Sidebar.input_image_size_display,n.PreCrop.Sidebar.input_image_aspect_ratio_display,n.PreCrop.Sidebar.input_image_megapixels_display),Y(),n.PreCrop.App.$().show(),H=n.body.$().hasClass("modal-open"),H||n.body.$().addClass("modal-open"),setTimeout(bt,0)}}(j||(j={})),function(t){const e=new Lt("Downsampler",[],$t);t.loadImageShrinkAndThumbnail=function(i,s,o,r){t.loadCheckRotateImage(i,!1,s,(s,n)=>{let a=L.MaxMaxNumPixels;const h=s.width()*s.height(),l=h>a,c={w:s.width(),h:s.height(),sizePixels:h,sizeBytes:i.size,transparent:void 0,dpi:n.dpi()};function u(n){q.process({inputCanvas:s,crop:n,maxNumPixels:a,thumbnailSize:void 0,worker:r?e:void 0,completed:function(e,s,r){if(n&&(c.w=n.right-n.left,c.h=n.bottom-n.top),s||t.needsReencoding(i.type)){let s=t.recodeCanvasFile(i,e);o(c,s,e)}else o(c,i,e)}})}i=n.checkFixType(i),l?j.show({inputFile:i,inputCanvas:s,lockAspectRatio:void 0,maxNumMegapixels:L.MaxMaxNumMegapixels,maxMaxNumMegapixels:L.MaxMaxNumMegapixels,aspectRatios:[],completed:t=>{a=1024*j.maxNumMegapixels*1024,u(t)}}):u()})}}(Z||(Z={})),function(t){function e(t){return 0==t?"0.0%":100==t?"100.0%":t<.005||99.995<t?t.toFixed(4)+"%":t<.05||99.95<t?t.toFixed(3)+"%":t<.5||99.5<t?t.toFixed(2)+"%":t.toFixed(1)+"%"}function i(t){return t.toLocaleString("en-US")}t.init=function(){n.chart.$().each((t,s)=>{const o=JSON.parse(s.dataset.x),r=JSON.parse(s.dataset.ys),n=s.dataset.labels&&JSON.parse(s.dataset.labels),a=s.dataset.colors&&JSON.parse(s.dataset.colors),h=s.dataset.title,l=s.dataset.unit,c=r.map((t,e)=>{let i={data:t,fill:!1};return n&&n[e]&&(i.label=n[e]),a&&a[e]&&(i.borderColor=a[e],i.backgroundColor=a[e]),i});let u="%"==l?e:i;new Chart(s,{type:"line",data:{labels:o,datasets:c},options:{plugins:{legend:{display:!!n,position:"right",reverse:!0,labels:{boxWidth:12}},title:{display:!!h,text:h},tooltip:{callbacks:{label:function(t){let e=t.dataset.label||"";return e&&(e+=": "),null!==t.parsed.y&&(e+=u(t.parsed.y)),e}}}},elements:{point:{pointStyle:!1,hitRadius:7}},scales:{y:{suggestedMax:10,suggestedMin:0,ticks:{beginAtZero:!1,callback:(t,e,i)=>u(t)}}}}})})}}(Q||(Q={})),function(){let t;!function(t){t[t.paypal=0]="paypal",t[t.fake=1]="fake"}(t||(t={}));function e(t){let e=[];function i(t,i){e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}function s(t,e){if($.isArray(e))$.each(e,function(e,i){s(t+"["+e+"]",i)});else if("object"==$.type(e))for(let i in e)e.hasOwnProperty(i)&&s(t+"."+i,e[i]);else i(t,e)}i(GlobalsShared.localeQueryParameter,GlobalsShared.locale);for(let e in t)t.hasOwnProperty(e)&&s(e,t[e]);return e.join("&").replace(" ","+")}function i(t){return function(e,i,s){t({error:{message:o(e,i)}})}}function o(t,e){if(0===t.status)return u.s("Failed to connect to the server.")+"\n"+u.s("Please verify your network connection.")+"\n";{const s=(i=t.response,i?"object"==typeof i?JSON.stringify(i):i.toString():"null").substring(0,200);return t.status<200||299<t.status?t.statusText+" ["+t.status+"]\n"+s:"parsererror"===e?u.s("Failed to parse JSON response.")+" ["+e+"]\n"+s:"timeout"===e?u.s("Request time out.")+" ["+e+"]":"abort"===e?u.s("Request aborted by the server.")+" ["+e+"]":u.s("Unknown error.")+"\n"+s}var i}function r(){return merchantJs.settings.host+"/payments/v0/preapprovals/"+merchantJs.settings.wud+"/"}function a(t,s){let o=r()+"payment_method?"+e(t);$.ajax(o,{dataType:"jsonp",timeout:3e4,success:function(t){s(t)},error:i(s)})}let h,l,c,d;!function(s){let o=null,n=null;function h(){o&&(n&&(clearInterval(n),n=null),o.close(),o=null)}function l(s,n,a){h(),o=window.open("","_blank"),o.document.write("<h3>Loading...</h3>");var l=r()+t[s]+"?"+e(n);$.ajax(l,{dataType:"jsonp",timeout:3e4,success:function(t){a(t)},error:i(a)})}s.handler=function(t){return function(e,i,s){l(t,e,function(t){var e,r;!t||t.error?(h(),i(t)):(e=t.preapproval.processorToken.url,r=function(){s(),a(t.preapproval,i)},o&&(o.location.href=e,o.focus(),n=setInterval(function(){o.closed&&(clearInterval(n),n=null,r())},100)))})}}}(h||(h={})),function(t){t.initialize=function(){return!0},t.pay=function(t){t({error:{message:"Unavailable"}})},t.radioButton=function(){return new s("__unavailable_payment_processor__")},t.name=function(){return"unavailable"}}(l||(l={})),function(t){let e,i,s;t.initialize=function(){return"undefined"!=typeof Stripe&&(e=Stripe(merchantJs.settings.stripePublishableKey),i=e.elements({locale:GlobalsShared.locale}),s=i.create("card",{style:{base:{lineHeight:"1.429"}}}),s.mount(n.merchant.StripeCardElement.css()),s.on("change",function(t){t&&t.error?n.merchant.StripeCardErrors.$().text(t.error.message):n.merchant.StripeCardErrors.$().text("")}),s.on("focus",function(){n.merchant.StripeCardElement.$().addClass("focus")}),s.on("blur",function(){n.merchant.StripeCardElement.$().removeClass("focus")}),!0)},t.pay=function(t){g(),e.createToken(s,{name:n.merchant.StripeNameElement.$().val()}).then(function(e){if(e.error)t({error:{message:e.error.message}});else{w();const i=e.token;a({processor:"stripe",processorToken:{id:i.id,card:i.card},preapprovalSpec:merchantJs.preapprovalSpec},t)}})},t.radioButton=function(){return n.merchant.RadioStripe},t.name=function(){return"stripe"}}(c||(c={})),function(t){let e;t.initialize=function(){if("undefined"!=typeof braintree){let t=!0;return braintree.dropin.create({authorization:merchantJs.settings.braintreeTokenizationKey,container:n.merchant.BraintreeDropinContainer.css(),locale:GlobalsShared.locale.replace("-","_"),card:{cardholderName:!0},dataCollector:{kount:!0}}).then(function(t){if(e=t,"USD"!=merchantJs.preapprovalSpec.currency)for(let t of["american-express","jcb","discover"])$("div[data-braintree-id='"+t+"-card-icon']").addClass("braintree-hidden")}).catch(function(e){t=!1,g(),n.merchant.PaymentError.$().text(e.message).show()}),t}return!1},t.pay=function(t){g(),e.requestPaymentMethod(function(i,s){if(i)e.clearSelectedPaymentMethod(),t({error:i});else{w();a({processor:"braintree",processorToken:s,preapprovalSpec:merchantJs.preapprovalSpec},function(i){i.error&&e.clearSelectedPaymentMethod(),t(i)})}})},t.radioButton=function(){return n.merchant.RadioBraintree},t.name=function(){return"braintree"}}(d||(d={}));const p=h.handler(t.paypal),m=h.handler(t.fake);function g(){n.merchant.PaymentError.$().hide(),n.merchant.StripePaymentError.$().hide(),n.merchant.PaymentMethodFormSubmit.$().attr("disabled","disabled")}function f(){n.merchant.PaymentMethodFormSubmit.$().removeAttr("disabled")}function b(t){n.merchant.PaymentError.$().html("<p>"+t).show(),f()}function w(){n.merchant.ShowWhenMinibrowsing.$().modal("hide"),n.merchant.ShowWhenCreatingPm.$().modal("show")}function v(t){n.merchant.ShowWhenMinibrowsing.$().modal("hide"),n.merchant.ShowWhenCreatingPm.$().modal("hide"),null===t?b("Got a null response from the server"):t.error?b(t.error.message):(n.merchant.ShowWhenSubmitting.$().modal("show"),x({streamlexPaymentToken:t.paymentMethod.streamlexPaymentToken,defaultPaymentMethod:C}))}let C="stripe",x=null;$(function(){"undefined"!=typeof merchantJs&&(!function(t){x=t;let e=!1,i=!1;merchantJs.settings.braintreePrimary?merchantJs.settings.canBraintree?e=!0:merchantJs.settings.canStripe&&(i=!0):merchantJs.settings.canStripe?i=!0:merchantJs.settings.canBraintree&&(e=!0);const s=e?d:i?c:l,o=s.initialize(),r=o&&(merchantJs.settings.canBraintree||merchantJs.settings.canStripe||merchantJs.settings.canPaypal);C=s.name();const a=$("input[type=radio][name=paymentMethod]");let h=null,u=!1;a.change(function(){var t;n.merchant.CreditCardProcessorForm.$().toggle(s.radioButton().$().prop("checked")),h=$(this),n.merchant.RadioPaypal.$().prop("checked")&&n.merchant.CantPaypal.$().length>0?(n.merchant.CantPaypal.$().show(),g()):(n.merchant.CantPaypal.$().hide(),r&&f()),u=merchantJs.needZipCode&&("paypal"==(t=h.data("processor")||h.val())||"fake"==t),n.merchant.TaxSection.$().toggle(u)}),$("#paymentMethod_"+merchantJs.defaultPaymentMethod).prop("checked",!0).change(),n.merchant.AcceptTermsWrapper.$().removeClass(n.merchant.has_error.name()),n.merchant.InitializingIndicator.$().hide(),n.merchant.SubmitSection.$().show(),n.merchant.PaymentMethodForm.$().submit(function(){C=h&&h.val()||s.name();let e=!1;if(u){let t=/^\d{5}$/,i=(""+n.merchant.TaxPostalCode.$().val()).trim();t.test(i)?(n.merchant.TaxPostalCodeFormGroup.removeClass(n.merchant.has_error),n.merchant.TaxLocationPostalCode.$().val(i)):(n.merchant.TaxPostalCodeFormGroup.addClass(n.merchant.has_error),e=!0)}if(n.merchant.AcceptTerms.$().prop("checked")?n.merchant.AcceptTermsWrapper.removeClass(n.merchant.has_error):(n.merchant.AcceptTermsWrapper.addClass(n.merchant.has_error),e=!0),e)return!1;switch(g(),C){case"stripe":c.pay(v);break;case"braintree":d.pay(v);break;case"paypal":n.merchant.ShowWhenMinibrowsing.$().modal("show"),p(merchantJs.preapprovalSpec,v,w);break;case"fake":merchantJs.settings.isTesting&&(n.merchant.ShowWhenMinibrowsing.$().modal("show"),m(merchantJs.preapprovalSpec,v,w));break;default:n.merchant.ShowWhenSubmitting.$().modal("show"),t({streamlexPaymentToken:C,defaultPaymentMethod:C})}return!1}),r?f():(g(),o||n.merchant.FailedToLoadPaymentBackendJs.$().show())}(function(t){n.merchant.StreamlexPaymentToken.$().val(t.streamlexPaymentToken),n.merchant.DefaultPaymentMethod.$().val(t.defaultPaymentMethod),n.merchant.PaymentForm.$().submit()}),$(window).on("load",function(){(new Image).src="https://www.paypal.com/home"}))})}(J||(J={})),function(t){let e=!1,i=[];function s(){if(0==i.length)e=!1,n.$window.off(".SvgAnimation");else{const t=$(document).scrollTop(),e=n.$window.height(),s=t+e,o=t+.5*e;let a=[];for(let t of i){const e=t.Id.$().offset().top,i=e+t.Id.$().height();(o>e||s>i)&&a.push(t)}for(let t of a)i.splice(i.indexOf(t),1),r(t)}}t.register=function(t){t.Id.$().length>0&&(e||(e=!0,n.$window.on("resize.SvgAnimation scroll.SvgAnimation",s)),i.push(t),s())};const o=1.5;function r(t){const e=new TimelineLite,i=t.Id.$().data("zoom-rects"),s=i[F.randomInt(i.length)];let n=F.randomInt2(s.x0,s.x1),l=F.randomInt2(s.y0,s.y1);const c=+t.Id.$().data("zoom-to-scale")||1;e.delay(1).to(t.transformable.$(),o,{svgOrigin:n+" "+l,scale:c}).to(t.Outlines.$(),o,{attr:{x:"0%"}}).to(t.Shapes.$(),o,{attr:{x:"0%"}},"+=0.25").to(t.Outlines.$(),0,{attr:{x:"-100%"}}).to(t.Shapes.$(),.5*o,{attr:{x:"50%"}},"+=0.25").to(t.Line.$(),0,{display:"inline",attr:{x1:"50%",x2:"50%"}}).to(t.Labels.$(),0,{display:"block"}).eventCallback("onComplete",h,[t,!0]),function(t,e){t.Id.$().off("click").click(function(){h(t,!1),a(t,.5),TweenLite.to(t.Shapes.$(),0,{attr:{x:"100%"}}),e.seek(0),e.kill(),r(t)})}(t,e)}function a(t,e){let i=(100*e).toFixed(2)+"%";TweenLite.to(t.Shapes.$(),0,{attr:{x:i}}),TweenLite.to(t.Line.$(),0,{attr:{x1:i,x2:i}})}function h(t,e){e?t.Id.$().off("mousemove mouseleave").mousemove(function(e){let i=(e.pageX-t.Id.$().offset().left)/t.Id.$().width();a(t,i)}).mouseleave(function(){a(t,.5)}):t.Id.$().off("mousemove mouseleave")}}(K||(K={})),function(t){t.init=function(){n.downloadAll.$().click(function(){n.download.$().each(function(t,e){setTimeout(function(){$(e).get(0).dispatchEvent(new MouseEvent("click"))},200*t)})})}}(tt||(tt={})),function(t){let i={};try{i=window.localStorage||{}}catch(t){}let s=null,o=!1;const r=location;function h(){if(null==s){if(s=E.list(),s.length>0){let t="<h4>"+u.s("Unsupported Browser")+"</h4><p>"+u.s("Terribly sorry, but your browser appears to be missing key feature(s) required to use this website:")+"</p><ul>";for(let e=0;e<s.length;e++)t+="<li>"+s[e]+"</li>";t+="</ul>";let e=window.GlobalsEx.LocaleParameter.split("=")[1];t+="<div>"+u.s("Please try the latest version of one of these browsers instead: <b>{0}, {1}, {2}, {3}</b>.",'<a class="alert-link" href="'+L.BrowserChromeUrl+'">Chrome</a>','<a class="alert-link" href="'+L.BrowserFirefoxUrl.replace("en-US",e)+'">Firefox</a>','<a class="alert-link" href="'+L.BrowserSafariUrl+'">Safari</a>','<a class="alert-link" href="'+L.BrowserMicrosoftEdgeUrl.replace("en-us",e.toLowerCase())+'">Microsoft Edge</a>')+"</div>",n.App.ModernizrAlert.$().html(t).slideDown(500)}s.length>0&&(n.body.$().addClass(n.cannot_run_app.name()),n.App.starter.$().attr("disabled","disabled").addClass("disabled"),n.App.starter.anscestorOf(new e("button")).$().attr("disabled","disabled").addClass("disabled"))}else s.length>0&&(n.htmlBody.$().scrollTop(0),F.blink(n.App.ModernizrAlert));return 0==s.length&&n.App.App.$().length>0}const l=r.host.split(".").splice(-2).join(".");function c(){return n.$window.off("beforeunload"),H.exit(),!1}let d=t=>{if(!o)return;if(!T)return;let e=t.type.toLowerCase().split(";")[0];Z.loadImageShrinkAndThumbnail(t,i=>{F.gaTrack("image","loadFailed","Type: "+e+", Ext: "+F.getExtensionWithDot(t.name).toLowerCase()),F.fatalErrorStr(u.s('Failed to read image file with name: "{0}", and type: "{1}".',t.name,t.type))},(t,i,s)=>{i.size>L.MaxBytesPerImage?F.fatalErrorStr(u.s("Terribly sorry, but that file is too large to process. Please try another.")):(F.gaTrack("image","uploaded",e),X.add(i,s,t))},!0)};function p(t,e,i){if(!o)return;F.gaTrack("image","fromUrl",t),F.progress(!0);let s=null;A.download({url:t,displayUrl:i,progress:F.progressUpdate,error:F.fatalErrorStr,success:t=>{e&&(t.name=e),s=t,F.progress(!1),d(s)}})}function m(t){let e=t.keyCode;x.isCommandOrCtrl(e)?n.ctl_key.$().addClass(n.active_key.name()):86==e&&n.v_key.$().addClass(n.active_key.name())}function g(t){let e=n.v_key.$(),i=t.keyCode;x.isCommandOrCtrl(i)&&(n.ctl_key.$().removeClass(n.active_key.name()),e.removeClass(n.active_key.name())),86==i&&e.removeClass(n.active_key.name())}const f=function(t){let e=5381;for(let i=0;i<t.length;i++)e=33*e^t.charCodeAt(i);return e>>>0}(l);function b(){n.ctl_key.$().removeClass(n.active_key.name()),n.v_key.$().removeClass(n.active_key.name())}let w;function v(){k(String.fromCharCode(104,116,116,112,115,58,47,47,118,101,99,116,111,114,105,122,101,114,46,97,105))}function C(t){if(t){n.v_key.$().addClass(n.active_key.name());let t=n.ctl_key.$().parent();t.hasClass(n.pasted.name())||(t.addClass(n.pasted.name()),setTimeout(()=>{b(),t.removeClass(n.pasted.name())},3e3))}else n.paste_buttons.$().addClass(n.wrong_shake.name()),null!=w&&clearTimeout(w),w=setTimeout(()=>{n.paste_buttons.$().removeClass(n.wrong_shake.name()),b()},600)}function S(t){F.loadFileFromUrl(this.dataset.url,this.dataset.name,d)}t.afterPaste=C;const k=r.replace.bind(r);function R(){n.Options.container.anscestorOf(n.tag("input")).$().each((t,e)=>{let i=e,s=i.getAttribute("data-attribute-class");switch(i.type){case"checkbox":case"radio":n.Options.container.$().toggleClass(s,i.checked)}})}const T=4205620347==f||309636958==f;function I(t){if(!h())return;F.gaTrack("image","resumed"),F.progress(!0);let e=Date.now();A.download({url:t.originalUrl,progress:F.progressUpdate,error:F.fatalErrorStr,success:i=>{let s=F.blobToFile(i,t.originalFilename);Z.loadCheckRotateImage(s,!1,F.fatalError,i=>{F.gaTrack("StartupProgress","downloadedImageAndDrawCommandsResume",void 0,Date.now()-e),F.progress(!1),X.resume(t,i)})}})}function O(t,e,i,s,o){alert(`Error: event: '${t}', source: '${e}', lineno: '${i}', colno: '${s}', error: '${o}'`)}$(document).ready(function(){n.jsNotInitializedYet.removeClass(n.jsNotInitializedYet),o=h(),o&&(U.initialize(),n.App.cancel_upload.$().click(c),n.App.force_exit.$().click(c),n.App.exit_app.$().click(c),y.initialize({monitor_file_input:n.FileInput.Field,monitor_paste:n.FileInput.PasteTarget,monitor_drag:n.body,hover_class:n.drop_ready,error:t=>{alert(t)},drop:t=>{d(t[0])},pastedUrl:function(t){p(Y.fetchUrl(t),void 0,t)},afterPaste:C,dropOnce:!1}),P.initialize(n.FileInput.UploadFromWeb.show_dialog,function(t){p(Y.fetchUrl(t),void 0,t)}),n.App.new_from_url_link.$().click(function(t){if(0==t.button){let t=$(this);return p(t.data("url"),t.data("filename")),!1}return!0}),n.FileInput.click_to_upload.$().click(function(){let t=n.FileInput.Field.el();t.value=null,t.click()}),X.initialize(),n.$window.keydown(m),n.$window.keyup(g),K.register(n.Hurricane),n.BeforeAfter.try_this_btn.$().click(S),n.Options.container.anscestorOf(n.tag("input")).$().change(R),R(),H.initialize(),void 0!==window.ResumeImage&&I(window.ResumeImage),M.setFileReceiver(d)),a.checkInit(),Q.init(),tt.init(),n.tabLink.$().click(function(t){t.preventDefault(),$("."+$(this).data("tab")).each(function(t,e){$(e).tab("show")})}),"localhost"==location.hostname&&(window.onerror=O),T||(setTimeout(v,1),d=function(t){},o=!1)}),t.resumeUserImage=I}(et||(et={}))}("undefined"==typeof MainExport?MainExport={}:MainExport);